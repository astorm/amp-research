!function(){var Q="SDK_"+"6.6.0-r10939-201601190610".replace(/[^\w]/g,"_"),u="undefined"!=typeof window?window:"undefined"!=typeof GLOBAL?GLOBAL:this;return u.tv=u.tv||{},u.tv.freewheel=u.tv.freewheel||{},u.tv.freewheel[Q]=function(u){var a={version:"js-6.6.0-r10939-201601190610"};return"undefined"!=typeof window&&(window._fw_admanager=window._fw_admanager||{},window._fw_admanager.version=a.version),a.LOG_LEVEL_QUIET=0,a.LOG_LEVEL_INFO=1,a.LOG_LEVEL_DEBUG=2,a.setLogLevel=function(e){"undefined"!=typeof console&&e>a.LOG_LEVEL_QUIET?(a.log=function(){console.log(">FW "+(new Date).toTimeString().substr(3,6)+Array.prototype.slice.call(arguments).join(" "))},a.warn=function(){console.warn(">FW "+(new Date).toTimeString().substr(3,6)+Array.prototype.slice.call(arguments).join(" "))},a.debug=e>a.LOG_LEVEL_INFO?function(){console.log(">FW "+(new Date).toTimeString().substr(3,6)+Array.prototype.slice.call(arguments).join(" "))}:function(){}):a.warn=a.log=a.debug=function(){}},a.setLogLevel(a.LOG_LEVEL_INFO),a.log("FreeWheel Integration Runtime",a.version),function(){var e=navigator.userAgent.toLowerCase();a.PLATFORM_IS_WINDOWSPHONE=-1<e.search("windows phone os"),a.PLATFORM_IS_IPAD=-1<e.search("ipad"),a.PLATFORM_IS_IPHONE_IPOD=-1<e.search("iphone")||-1<e.search("ipod"),a.PLATFORM_IE_MOBILE_VERSION=function(){var t=e.search(/iemobile\/\d\.\d/);if(t>-1){var i=e.substr(t+9,1),t=e.substr(t+11,1);return 1*i+.1*t}return 0}(),a.PLATFORM_IOS_VERSION=function(){var t=e.search(/os \d_\d/);if(t>-1){var i=e.substr(t+3,1),t=e.substr(t+5,1);return 1*i+.1*t}return 0}(),a.PLATFORM_ANDROID_VERSION=function(){var t=e.search(/android \d\.\d/);if(t>-1){var i=e.substr(t+8,1),t=e.substr(t+10,1);return 1*i+.1*t}return-1<e.indexOf("transformer")?3.2:0}(),a.PLATFORM_IS_SAFARI=0<a.PLATFORM_IOS_VERSION&&-1<e.search("applewebkit")||0===a.PLATFORM_ANDROID_VERSION&&0>e.search("chrome")&&-1<e.search("safari"),a.PLATFORM_IS_MOBILE=0<a.PLATFORM_IOS_VERSION||0<a.PLATFORM_ANDROID_VERSION,a.PLATFORM_ID=a.PLATFORM_IS_MOBILE?0<a.PLATFORM_ANDROID_VERSION?"Android"+a.PLATFORM_ANDROID_VERSION:a.PLATFORM_IS_IPAD?"iPad"+a.PLATFORM_IOS_VERSION:a.PLATFORM_IS_IPHONE_IPOD?"iPhone"+a.PLATFORM_IOS_VERSION:"UnknownMobile":"Desktop",a.log("Device:",a.PLATFORM_ID,"PLATFORM_IS_SAFARI:",a.PLATFORM_IS_SAFARI)}(),a.PLATFORM_EVENT_CLICK=a.PLATFORM_IS_MOBILE?"touchend":"click",a.MOBILE_EVENT_DRAG="touchmove",a.PLATFORM_SEND_REQUEST_BY_FORM=!1,a.PLATFORM_HIDE_AND_SHOW_CONTENT_VIDEO_BY_MOVE_POSITION=3.1<=a.PLATFORM_ANDROID_VERSION,a.PLATFORM_HIDE_AND_SHOW_CONTENT_VIDEO_BY_SET_DISPLAY=!0,a.PLATFORM_SUPPORT_PLAY_MIDROLL_BY_CURRENT_VIDEO_ELEMENT=a.PLATFORM_IS_IPAD||a.PLATFORM_IS_IPHONE_IPOD,a.PLATFORM_AUTO_SEEK_AFTER_MIDROLL=a.PLATFORM_IS_IPAD,a.PLATFORM_NOT_SUPPORT_OVERLAY_AD=a.PLATFORM_IS_IPHONE_IPOD||0<a.PLATFORM_ANDROID_VERSION&&3.1>a.PLATFORM_ANDROID_VERSION||a.PLATFORM_IS_WINDOWSPHONE,a.PLATFORM_FILL_VIDEO_POOL_FOR_MIDROLL=4.2<=a.PLATFORM_IOS_VERSION,a.PLATFORM_NOT_SUPPORT_MIDROLL_AD=2.2<=a.PLATFORM_ANDROID_VERSION&&3>=a.PLATFORM_ANDROID_VERSION||9<=a.PLATFORM_IE_MOBILE_VERSION,a.PLATFORM_NOT_SUPPORT_VIDEO_AD=0<a.PLATFORM_ANDROID_VERSION&&2.1>=a.PLATFORM_ANDROID_VERSION,a.PLATFORM_DETECT_FULL_SCREEN_FOR_MIDROLL=a.PLATFORM_IS_IPAD&&4.2<=a.PLATFORM_IOS_VERSION,a.PLATFORM_NOT_SUPPORT_CLICK_FOR_VIDEO=a.PLATFORM_IS_IPHONE_IPOD||a.PLATFORM_IS_WINDOWSPHONE,a.PLATFORM_NOT_FIRE_CLICK_WHEN_AD_VIDEO_PAUSED=3.1<=a.PLATFORM_ANDROID_VERSION,a.PLATFORM_WAIT_WHEN_AD_VIDEO_TIMEOUT=0<a.PLATFORM_ANDROID_VERSION&&3>=a.PLATFORM_ANDROID_VERSION,a.PLATFORM_VIDEO_DOESNOT_SUPPORT_TIMEUPDATE=9<=a.PLATFORM_IE_MOBILE_VERSION,a.PLATFORM_PLAY_DUMMY_VIDEO_FOR_PREROLL=0<a.PLATFORM_IOS_VERSION&&4.2>a.PLATFORM_IOS_VERSION&&4<=a.PLATFORM_IOS_VERSION,a.PLATFORM_NOT_WAIT_FOR_ERROR_WHEN_PLAY_DUMMY_VIDEO_FOR_PREROLL=!1,a.PLATFORM_SUPPORT_VIDEO_START_DETECT_TIMEOUT=0===a.PLATFORM_IOS_VERSION||4<=a.PLATFORM_IOS_VERSION&&4.2>a.PLATFORM_IOS_VERSION,a.PLATFORM_NOT_SUPPORT_OVERLAY_CLICK_WHEN_CONTROLS_IS_TRUE=a.PLATFORM_IS_IPAD,a.RENDERER_STATE_INIT=1,a.RENDERER_STATE_STARTING=2,a.RENDERER_STATE_STARTED=3,a.RENDERER_STATE_COMPLETING=4,a.RENDERER_STATE_COMPLETED=5,a.RENDERER_STATE_FAILED=6,a.TRANSLATOR_STATE_INIT=a.RENDERER_STATE_INIT,a.TRANSLATOR_STATE_STARTING=a.RENDERER_STATE_STARTING,a.TRANSLATOR_STATE_STARTED=a.RENDERER_STATE_STARTED,a.TRANSLATOR_STATE_COMPLETING=a.RENDERER_STATE_COMPLETING,a.TRANSLATOR_STATE_COMPLETED=a.RENDERER_STATE_COMPLETED,a.TRANSLATOR_STATE_FAILED=a.RENDERER_STATE_FAILED,a.EVENT_AD="adEvent",a.EVENT_SLOT_IMPRESSION="slotImpression",a.EVENT_SLOT_END="slotEnd",a.EVENT_AD_IMPRESSION="defaultImpression",a.EVENT_AD_IMPRESSION_END="adEnd",a.EVENT_AD_QUARTILE="quartile",a.EVENT_AD_FIRST_QUARTILE="firstQuartile",a.EVENT_AD_MIDPOINT="midPoint",a.EVENT_AD_THIRD_QUARTILE="thirdQuartile",a.EVENT_AD_COMPLETE="complete",a.EVENT_AD_CLICK="defaultClick",a.EVENT_AD_MUTE="_mute",a.EVENT_AD_UNMUTE="_un-mute",a.EVENT_AD_COLLAPSE="_collapse",a.EVENT_AD_EXPAND="_expand",a.EVENT_AD_PAUSE="_pause",a.EVENT_AD_RESUME="_resume",a.EVENT_AD_REWIND="_rewind",a.EVENT_AD_ACCEPT_INVITATION="_accept-invitation",a.EVENT_AD_CLOSE="_close",a.EVENT_AD_MINIMIZE="_minimize",a.EVENT_ERROR="_e_unknown",a.EVENT_RESELLER_NO_AD="resellerNoAd",a.EVENT_AD_MEASUREMENT="concreteEvent",a.INFO_KEY_CUSTOM_ID="customId",a.INFO_KEY_MODULE_TYPE="moduleType",a.MODULE_TYPE_EXTENSION="extension",a.MODULE_TYPE_RENDERER="renderer",a.MODULE_TYPE_TRANSLATOR="translator",a.INFO_KEY_ERROR_CODE="errorCode",a.INFO_KEY_ERROR_INFO="errorInfo",a.INFO_KEY_ERROR_MODULE="errorModule",a.ERROR_IO="_e_io",a.ERROR_TIMEOUT="_e_timeout",a.ERROR_NULL_ASSET="_e_null-asset",a.ERROR_ADINSTANCE_UNAVAILABLE="_e_adinst-unavail",a.ERROR_UNKNOWN="_e_unknown",a.ERROR_MISSING_PARAMETER="_e_missing-param",a.ERROR_NO_AD_AVAILABLE="_e_no-ad",a.ERROR_PARSE="_e_parse",a.ERROR_INVALID_VALUE="_e_invalid-value",a.ERROR_INVALID_SLOT="_e_invalid-slot",a.ERROR_NO_RENDERER="_e_no-renderer",a.ERROR_DEVICE_LIMIT="_e_device-limit",a.ERROR_3P_COMPONENT="_e_3p-comp",a.ERROR_UNSUPPORTED_3P_FEATURE="_e_unsupp-3p-feature",a.ERROR_SECURITY="_e_security",a.ERROR_UNMATCHED_SLOT_SIZE="_e_slot-size-unmatch",a.INFO_KEY_URL="url",a.INFO_KEY_SHOW_BROWSER="showBrowser",a.INFO_KEY_CUSTOM_EVENT_NAME="customEventName",a.INFO_KEY_NEED_EMPTY_CT="needEmptyCT",a.INFO_KEY_CONCRETE_EVENT_ID="concreteEventId",a.EVENT_TYPE_CLICK_TRACKING="CLICKTRACKING",a.EVENT_TYPE_IMPRESSION="IMPRESSION",a.EVENT_TYPE_CLICK="CLICK",a.EVENT_TYPE_STANDARD="STANDARD",a.EVENT_TYPE_GENERIC="GENERIC",a.EVENT_TYPE_ERROR="ERROR",a.EVENT_VIDEO_VIEW="videoView",a.SHORT_EVENT_TYPE_IMPRESSION="i",a.SHORT_EVENT_TYPE_CLICK="c",a.SHORT_EVENT_TYPE_STANDARD="s",a.SHORT_EVENT_TYPE_ERROR="e",a.INIT_VALUE_ZERO="0",a.INIT_VALUE_ONE="1",a.INIT_VALUE_TWO="2",a.INFO_KEY_PARAMETERS="parameters",a.URL_PARAMETER_KEY_ET="et",a.URL_PARAMETER_KEY_CN="cn",a.URL_PARAMETER_KEY_INIT="init",a.URL_PARAMETER_KEY_CT="ct",a.URL_PARAMETER_KEY_METR="metr",a.URL_PARAMETER_KEY_CR="cr",a.URL_PARAMETER_KEY_KEY_VALUE="kv",a.URL_PARAMETER_KEY_ERROR_INFO="additional",a.URL_PARAMETER_KEY_ERROR_MODULE="renderer",a.URL_PARAMETER_KEY_CREATIVE_RENDITION_ID="reid",a.URL_PARAMETER_KEY_CONCRETE_EVENT_ID="creid",a.CAPABILITY_SLOT_TEMPLATE="sltp",a.CAPABILITY_DISPLAY_REFRESH="rfnt",a.CAPABILITY_MULTIPLE_CREATIVE_RENDITIONS="emcr",a.CAPABILITY_RECORD_VIDEO_VIEW="exvt",a.CAPABILITY_CHECK_COMPANION="cmpn",a.CAPABILITY_CHECK_TARGETING="targ",a.CAPABILITY_FALLBACK_UNKNOWN_ASSET="unka",a.CAPABILITY_FALLBACK_UNKNOWN_SITE_SECTION="unks",a.CAPABILITY_FALLBACK_ADS="fbad",a.CAPABILITY_SLOT_CALLBACK="slcb",a.CAPABILITY_NULL_CREATIVE="nucr",a.CAPABILITY_AUTO_EVENT_TRACKING="aeti",a.CAPABILITY_RENDERER_MANIFEST="rema",a.CAPABILITY_REQUIRE_VIDEO_CALLBACK="vicb",a.CAPABILITY_SKIP_AD_SELECTION="skas",a.SLOT_TYPE_TEMPORAL="temporal",a.SLOT_TYPE_VIDEOPLAYER_NONTEMPORAL="videoPlayerNonTemporal",a.SLOT_TYPE_SITESECTION_NONTEMPORAL="siteSectionNonTemporal",a.TIME_POSITION_CLASS_PREROLL="PREROLL",a.TIME_POSITION_CLASS_MIDROLL="MIDROLL",a.TIME_POSITION_CLASS_POSTROLL="POSTROLL",a.TIME_POSITION_CLASS_OVERLAY="OVERLAY",a.TIME_POSITION_CLASS_DISPLAY="DISPLAY",a.TIME_POSITION_CLASS_PAUSE_MIDROLL="PAUSE_MIDROLL",a.EVENT_REQUEST_COMPLETE="onRequestComplete",a.EVENT_SLOT_STARTED="onSlotStarted",a.EVENT_SLOT_ENDED="onSlotEnded",a.EVENT_CONTENT_VIDEO_PAUSE_REQUEST="contentVideoPauseRequest",a.EVENT_CONTENT_VIDEO_RESUME_REQUEST="contentVideoResumeRequest",a.CAPABILITY_STATUS_OFF=0,a.CAPABILITY_STATUS_ON=1,a.PARAMETER_LEVEL_PROFILE=0,a.PARAMETER_LEVEL_GLOBAL=1,a.PARAMETER_LEVEL_OVERRIDE=5,a.PARAMETER_ENABLE_FORM_TRANSPORT="sdk.enableFormTransport",a.PARAMETER_DESIRED_BITRATE="desiredBitrate",a.PARAMETER_VIDEO_POOL_SIZE="sdk.videoPoolSize",a.PARAMETER_PAGE_SLOT_CONTENT_TYPE="sdk.pageSlotContentType",a.PARAMETER_PLAY_MIDROLL_BY_CURRENT_VIDEO_ELEMENT="PARAMETER_PLAY_MIDROLL_BY_CURRENT_VIDEO_ELEMENT",a.PARAMETER_EXTENSION_AD_CONTROL_CLICK_ELEMENT="extension.ad.control.clickElement",a.PARAMETER_EXTENSION_CONTENT_VIDEO_ENABLED="extension.contentVideo.enabled",a.PARAMETER_EXTENSION_CONTENT_VIDEO_RESPOND_PAUSE_RESUME="extension.contentVideo.respondPauseResume",a.PARAMETER_EXTENSION_CONTENT_VIDEO_AUTO_SEEK_BACK="extension.contentVideo.autoSeekBack",a.PARAMETER_EXTENSION_CONTENT_VIDEO_AUTO_SOURCE_RESTORE="extension.contentVideo.autoSourceRestore",a.PARAMETER_EXTENSION_VIDEO_STATE_ENABLED="extension.videoState.enabled",a.PARAMETER_RENDERER_VIDEO_START_DETECT_TIMEOUT="renderer.video.startDetectTimeout",a.PARAMETER_RENDERER_VIDEO_PROGRESS_DETECT_TIMEOUT="renderer.video.progressDetectTimeout",a.PARAMETER_RENDERER_VIDEO_ANDROID_DELAY="renderer.video.android.delay",a.PARAMETER_RENDERER_VIDEO_DISPLAY_CONTROLS_WHEN_PAUSE="renderer.video.displayControlsWhenPause",a.PARAMETER_RENDERER_VIDEO_CLICK_DETECTION="renderer.video.clickDetection",a.PARAMETER_RENDERER_VIDEO_PLAY_AFTER_STALLED="renderer.video.playAfterStalled",a.PARAMETER_EXTENSION_SURVEY_ENABLED="extension.survey.enabled",a.PARAMETER_RENDERER_DISPLAY_COAD_SCRIPT_NAME="renderer.html.coadScriptName",a.PARAMETER_RENDERER_HTML_SHOULD_BACKGROUND_TRANSPARENT="renderer.html.isBackgroundTransparent",a.PARAMETER_RENDERER_HTML_SHOULD_END_AFTER_DURATION="renderer.html.shouldEndAfterDuration",a.PARAMETER_RENDERER_HTML_AD_LOAD_TIMEOUT="renderer.html.adLoadTimeout",a.PARAMETER_RENDERER_HTML_PLACEMENT_TYPE="renderer.html.placementType",a.PARAMETER_RENDERER_HTML_BOOTSTRAP="renderer.html.bootstrap",a.PARAMETER_RENDERER_HTML_PRIMARY_ANCHOR="renderer.html.primaryAnchor",a.PARAMETER_RENDERER_HTML_MARGIN_WIDTH="renderer.html.marginWidth",a.PARAMETER_RENDERER_HTML_MARGIN_HEIGHT="renderer.html.marginHeight",a.PARAMETER_VPAID_CREATIVE_TIMEOUT_DELAY="renderer.vpaid.creativeTimeoutDelay",a.PARAMETER_RENDERER_HTML_PLACEMENT_TYPE_INLINE="inline",a.PARAMETER_RENDERER_HTML_PLACEMENT_TYPE_INTERSTITIAL="interstitial",a.PARAMETER_RENDERER_HTML_BASEUNIT_INTERSTITIAL="app-interstitial",a.ID_TYPE_FW=1,a.ID_TYPE_CUSTOM=2,a.ID_TYPE_GROUP=3,a.VIDEO_STATE_PLAYING=1,a.VIDEO_STATE_PAUSED=2,a.VIDEO_STATE_STOPPED=3,a.VIDEO_STATE_COMPLETED=4,a.VIDEO_ASSET_AUTO_PLAY_TYPE_ATTENDED=1,a.VIDEO_ASSET_AUTO_PLAY_TYPE_UNATTENDED=2,a.VIDEO_ASSET_AUTO_PLAY_TYPE_NONE=3,a.VIDEO_ASSET_AUTO_PLAY_TYPE_NON_AUTO_PLAY=3,a.ADUNIT_PREROLL="preroll",a.ADUNIT_MIDROLL="midroll",a.ADUNIT_POSTROLL="postroll",a.ADUNIT_OVERLAY="overlay",a.SLOT_LOCATION_PLAYER="player",a.SLOT_LOCATION_EXTERNAL="external",a.SLOT_OPTION_INITIAL_AD_STAND_ALONE=0,a.SLOT_OPTION_INITIAL_AD_KEEP_ORIGINAL=1,a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_ONLY=2,a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_OR_STAND_ALONE=3,a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_THEN_STAND_ALONE=4,a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_OR_NO_STAND_ALONE=5,a.SLOT_OPTION_INITIAL_AD_NO_STAND_ALONE=6,a.SLOT_OPTION_INITIAL_AD_NO_STAND_ALONE_IF_TEMPORAL=7,a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_OR_NO_STAND_ALONE_IF_TEMPORAL=8,a.Util={canPlayVideoType:function(e){if(a.PLATFORM_IS_SAFARI&&("video/ogg"==e||"video/webm"==e))return!1;if(1<a.PLATFORM_ANDROID_VERSION&&"video/m4v"==e)return!0;if("video/3gp"==e&&(e="video/3gpp"),3<=a.PLATFORM_ANDROID_VERSION&&"video/3gpp"==e)return!0;var t=document.createElement("video");return t.canPlayType?!(!t.canPlayType(e)&&!t.canPlayType(e.replace("/","/x-"))):!1},str2bool:function(e){return e?(e=a.Util.trim(e).toLowerCase(),"true"==e||"yes"==e||"on"==e||"1"==e):!1},trim:function(e){return"string"!=typeof e?e.toString():e.replace(/^\s+|\s+$/g,"")},isBlank:function(e){return!e||""===a.Util.trim(e)},encodeToHex:function(e){for(var t="",i=0;i<e.length;i++){for(var n=e.charCodeAt(i).toString(16).toUpperCase();4>n.length;)n="0"+n;t+="\\u"+n.toUpperCase()}return t},forEachOnArray:function(e,t,i){var n;if(null==e)throw new TypeError(" array is null or not defined");var e=Object(e),a=e.length>>>0;if("[object Function]"!={}.toString.call(t))throw new TypeError(t+" is not a function");for(i&&(n=i),i=0;a>i;){var r;i in e&&(r=e[i],t.call(n,r,i,e)),i++}},mixin:function(e,t){var i,n={};for(i in t)"undefined"!=typeof n[i]&&n[i]==t[i]||(e[i]=t[i]);return e},copy:function(e){return a.Util.mixin({},e)},bind:function(e,t){var i=Array.prototype.slice.call(arguments);return i.shift(),t=i.shift(),function(){return t.apply(e,i.concat(Array.prototype.slice.call(arguments)))}},getObject:function(e,t,i){if(!e)return null;for(var n,e=e.split("."),t=t||window,a=0;t&&(n=e[a]);a++)t=n in t?t[n]:i?t[n]={}:void 0;return t},buildNode:function(b,c,d,f,g){a.debug("Util.buildNode"),d||(d=document);var h=null!=navigator.userAgent.match(/Firefox/);b.innerHTML=c||"";for(var b=b.getElementsByTagName("script"),i=d.getElementsByTagName("head")[0],c=0;c<b.length;++c)if(h||b[c].src){var k=d.createElement("script");b[c].charset&&(k.charset=b[c].charset),b[c].src&&(k.src=b[c].src),b[c].innerHTML&&(k.innerHTML=b[c].innerHTML),k.onload=k.onreadystatechange=function(){(!this.readyState||"loaded"==this.readyState||"complete"==this.readyState)&&i.removeChild(k)};try{i.appendChild(k)}catch(j){a.warn("load script err: "+j)}}else k=b[c].innerHTML,f&&(k=k.replace(/var fw_scope = document;/,"var fw_scope="+f+";")),g&&(k=k.replace(/var fw_scope_window = window;/,"var fw_scope_window="+g+";")),eval(k)},replacePageSlot:function(e,t,i){a.debug("Util.replacePageSlot("+Array.prototype.slice.call(arguments).join(",")+")");var n,r,s;try{n=document.getElementById(e)?document:parent.document.getElementById(e)?parent.document:null,r=document.getElementById(e)?"window":parent.document.getElementById(e)?"parent":null}catch(o){r=n=null}if(!n)for(var l=0;l<window.frames.length;l++)try{window.frames[l].document.getElementById(e)&&(n=window.frames[l].document,r="window.frames["+l+"]")}catch(d){a.warn(d)}if(r&&(s=r+".document"),a.log("replacing slot "+e+" in frame "+s),!n)throw"Slot element not found: "+e;l=i?n.getElementById(i):n.getElementById("_fw_container_"+e),a.Util.buildNode(l,t,n,s,r)},pingURLWithImage:function(e){new Image(1,1).src=e},pingURLWithForm:function(e,t,i){i=i?"_fw_request":"_fw_cb",null==t&&(t=Math.random());var n=document.createElement("iframe");n.name=i+"_iframe_"+t,n.id=i+"_iframe_"+t,n.style.position="absolute",n.style.left="-10000px",n.style.width="1px",n.style.visibility="hidden";var a=document.createElement("form");a.action=e,a.id=i+"_form_"+t,a.target=n.id,a.method="post",a.style.position="absolute",a.style.left="-10000px",a.style.width="1px",a.style.visibility="hidden",document.body&&(document.body.appendChild(n),document.body.appendChild(a),a.submit(),document.body.removeChild(a))},pingURLWithScript:function(e){var t=document.getElementsByTagName("head")[0],i=document.createElement("script");i.src=e,i.onload=i.onreadystatechange=function(){(!this.readyState||"loaded"==this.readyState||"complete"==this.readyState)&&t.removeChild(i)},t.appendChild(i)},pingURL:function(e){a.debug("send callback: "+e),e&&(a.PLATFORM_SEND_REQUEST_BY_FORM?a.Util.pingURLWithForm(e,null,!1):a.Util.pingURLWithImage(e))},pingURLs:function(e){for(var t=0;t<e.length;t++)a.Util.pingURL(e[t])},setParameterInURL:function(e,t,i){if(!e||!t||null==i)return null;var n,a,r=!1,e=e.split("?"),i=encodeURIComponent(i);if(e[1]){a=e[1].split("&");for(var s=0;s<a.length;++s)if(n=a[s].split("="),n[0]==t){a[s]=n[0]+"="+i,r=!0;break}n=a.join("&"),r||(n=t+"="+i+"&"+n)}else n=t+"="+i;return n=e[0]+"?"+n},getParameterInURL:function(e,t){if(!e||!t)return null;var i=e.split("?");if(i[1])for(var i=i[1].split("&"),n=0;n<i.length;++n){var r=i[n].split("=");if(r[0]==t&&!a.Util.isBlank(r[1]))return decodeURIComponent(r[1])}return null},isParameterInURL:function(e,t){if(!e||!t)return!1;var i=e.split("?");if(i[1])for(var i=i[1].split("&"),n=0;n<i.length;++n)if(i[n].split("=")[0]==t)return!0;return!1},flashVersion:function(){var e="0,0,0,0";if(null!=navigator.plugins&&0<navigator.plugins.length){if(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"])try{var t=navigator.plugins["Shockwave Flash"+(navigator.plugins["Shockwave Flash 2.0"]?" 2.0":"")].description.split(" "),i=t[2].split("."),n=i[0],r=i[1],s=t[3];""==s&&(s=t[4]),"d"==s[0]?s=s.substring(1):"r"==s[0]&&(s=s.substring(1),0<s.indexOf("d")&&(s=s.substring(0,s.indexOf("d")))),e=n+","+r+","+s+",0"}catch(o){a.warn("Flash detection failed on navigator method")}}else{var l;try{l=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");var d=l.GetVariable("$version").split(" ")[1].split(",");3==d.length?e=d.join(",")+",0":4==d.length&&(e=d.join(","))}catch(_){a.warn("Flash detection failed on ActiveX method")}}return e},xmlToJson:function(e){var t={};if(!e)return null;if(1===e.nodeType){if(0<e.attributes.length){t["@attributes"]={};for(var i=0;i<e.attributes.length;i++){var n=e.attributes.item(i);t["@attributes"][n.nodeName]=n.nodeValue}}}else 3===e.nodeType?t=e.nodeValue:4===e.nodeType&&(t=e.nodeValue);if(e.hasChildNodes()){for(i=0;i<e.childNodes.length;i++){var n=e.childNodes.item(i),r=n.nodeName;if("undefined"==typeof t[r])t[r]=a.Util.xmlToJson(n);else{if("undefined"==typeof t[r].length||"string"==typeof t[r]){var s=t[r];t[r]=[],t[r].push(s)}t[r].push(a.Util.xmlToJson(n))}}"undefined"!=typeof t["#cdata-section"]?t.value=t["#cdata-section"]:t["#text"]&&(t.value=t["#text"])}return t},lazyJavaScriptLoad:function(e,t){var i=document.getElementsByTagName("head")[0]||document.documentElement,n=document.createElement("script");n.type="text/javascript",n.src=e,t&&(n.attachEvent&&!window.opera?n.onreadystatechange=function(){"loaded"!=n.readyState&&"complete"!=n.readyState||(i.removeChild(n),n.onreadystatechange=null,t())}:n.addEventListener("load",function(){i.removeChild(n),t()},!1)),i.insertBefore(n,i.firstChild)},getViewport:function(){var e=0,t=0;return"undefined"!=typeof window.innerWidth?(e=window.innerWidth,t=window.innerHeight):"undefined"!=typeof document.documentElement&&"undefined"!=typeof document.documentElement.clientWidth&&0!==document.documentElement.clientWidth?(e=document.documentElement.clientWidth,t=document.documentElement.clientHeight):document.getElementsByTagName("body")&&document.getElementsByTagName("body")[0]&&(e=document.getElementsByTagName("body")[0].clientWidth,t=document.getElementsByTagName("body")[0].clientHeight),{width:e,height:t,offsetX:window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,offsetY:window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop}},getAbsoluteUrl:function(e,t){if(e=a.Util.trim(e),t=a.Util.trim(t),-1!==t.indexOf("://"))return t;var i=e.substring(0,e.indexOf("://")-1);if(0===t.indexOf("//"))return i+":"+t;var i=e.indexOf("/",e.indexOf("://")+5),n=e;return-1!==i&&(n=e.substring(0,i)),0==t.indexOf("/")?n+t:(i=e.lastIndexOf("#"),n=e,-1!==i&&(n=e.substring(0,i)),0==t.indexOf("#")?n+t:(n=e.indexOf("?"),i=e,-1!==n&&(i=e.substring(0,n)),0==t.indexOf("?")?i+t:(n=-1===n?e.lastIndexOf("/"):i.lastIndexOf("/"),i=-1!==n?e.substring(0,n+1):i+"/",i+t)))}},a.MediaState=function(){},a.MediaState.prototype={},a.MediaState.prototype.constructor=a.MediaState,a.Util.mixin(a.MediaState.prototype,{play:function(e){a.debug(this._name+" play("+e+")")},pause:function(e){a.debug(this._name+" pause("+e+")")},complete:function(e){a.debug(this._name+" complete("+e+")")}}),a.MediaInitState=function(){this._name="MediaInitState"},a.MediaInitState.prototype=new a.MediaState,a.MediaInitState.prototype.constructor=a.MediaInitState,a.Util.mixin(a.MediaInitState.prototype,{play:function(e){a.debug(this._name+" play("+e+")"),e.setMediaState(a.MediaPlayingState.instance),"function"==typeof e.onStartPlaying&&e.onStartPlaying()}}),a.MediaInitState.instance=new a.MediaInitState,a.MediaPlayingState=function(){this._name="MediaPlayingState"},a.MediaPlayingState.prototype=new a.MediaState,a.MediaPlayingState.prototype.constructor=a.MediaPlayingState,a.Util.mixin(a.MediaPlayingState.prototype,{pause:function(e){a.debug(this._name+" pause("+e+")"),e.setMediaState(a.MediaPausedState.instance),"function"==typeof e.onPausePlaying&&e.onPausePlaying()},complete:function(e){a.debug(this._name+" complete("+e+")"),e.setMediaState(a.MediaEndState.instance),"function"==typeof e.onCompletePlaying&&e.onCompletePlaying()}}),a.MediaPlayingState.instance=new a.MediaPlayingState,a.MediaPausedState=function(){this._name="MediaPausedState"},a.MediaPausedState.prototype=new a.MediaState,a.MediaPausedState.prototype.constructor=a.MediaPausedState,a.Util.mixin(a.MediaPausedState.prototype,{play:function(e){a.debug(this._name+" play("+e+")"),e.setMediaState(a.MediaPlayingState.instance),"function"==typeof e.onResumePlaying&&e.onResumePlaying()},complete:function(e){a.debug(this._name+" complete("+e+")"),e.setMediaState(a.MediaEndState.instance),"function"==typeof e.onCompletePlaying&&e.onCompletePlaying()}}),a.MediaPausedState.instance=new a.MediaPausedState,a.MediaReplayingState=function(){this._name="MediaReplayingState"},a.MediaReplayingState.prototype=new a.MediaState,a.MediaReplayingState.prototype.constructor=a.MediaReplayingState,a.Util.mixin(a.MediaReplayingState.prototype,{pause:function(e){a.debug(this._name+" pause("+e+")"),e.setMediaState(a.MediaReplayPausedState.instance),"function"==typeof e.onPausePlaying&&e.onPausePlaying()},complete:function(e){a.debug(this._name+" complete("+e+")"),e.setMediaState(a.MediaEndState.instance),"function"==typeof e.onCompleteReplaying&&e.onCompleteReplaying()}}),a.MediaReplayingState.instance=new a.MediaReplayingState,a.MediaReplayPausedState=function(){this._name="MediaReplayPausedState"},a.MediaReplayPausedState.prototype=new a.MediaState,a.MediaReplayPausedState.prototype.constructor=a.MediaReplayPausedState,a.Util.mixin(a.MediaReplayPausedState.prototype,{play:function(e){a.debug(this._name+" play("+e+")"),e.setMediaState(a.MediaReplayingState.instance),"function"==typeof e.onResumePlaying&&e.onResumePlaying()},complete:function(e){a.debug(this._name+" complete("+e+")"),e.setMediaState(a.MediaEndState.instance),"function"==typeof e.onCompleteReplaying&&e.onCompleteReplaying()}}),a.MediaReplayPausedState.instance=new a.MediaReplayingState,a.MediaEndState=function(){this._name="MediaEndState"},a.MediaEndState.prototype=new a.MediaState,a.MediaEndState.prototype.constructor=a.MediaEndState,a.Util.mixin(a.MediaEndState.prototype,{play:function(e){a.debug(this._name+" play("+e+")"),e.setMediaState(a.MediaReplayingState.instance),"function"==typeof e.onStartReplaying&&e.onStartReplaying()}}),a.MediaEndState.instance=new a.MediaEndState,a.RendererState=function(){},a.RendererState.prototype={},a.RendererState.prototype.constructor=a.RendererState,a.Util.mixin(a.RendererState.prototype,{start:function(){a.debug(this._name+" start()")},notifyStarted:function(){a.debug(this._name+" notifyStarted()")},stop:function(){a.debug(this._name+" stop()")},complete:function(){a.debug(this._name+" complete()")},notifyCompleted:function(){a.debug(this._name+" notifyCompleted()")},fail:function(e){a.debug(this._name+" fail()"),e.setRendererState(a.RendererFailedState.instance),e.getAdInstance().complete()}}),a.RendererInitState=function(){this._name="RendererInitState"},a.RendererInitState.prototype=new a.RendererState,a.RendererInitState.prototype.constructor=a.RendererInitState,a.RendererInitState.instance=new a.RendererInitState,a.Util.mixin(a.RendererInitState.prototype,{start:function(e){a.debug(this._name+" start()"),e.setRendererState(a.RendererStartingState.instance),e.getRenderer().start(e)},stop:function(e){a.debug(this._name+" stop()"),e.setRendererState(a.RendererCompletingState.instance),e.getRendererState().notifyCompleted()}}),a.RendererStartingState=function(){this._name="RendererStartingState"},a.RendererStartingState.prototype=new a.RendererState,a.RendererStartingState.prototype.constructor=a.RendererStartingState,a.RendererStartingState.instance=new a.RendererStartingState,a.Util.mixin(a.RendererStartingState.prototype,{notifyStarted:function(e){a.debug(this._name+" notifyStarted()"),e.setRendererState(a.RendererStartedState.instance),e.getAdInstance().play()},stop:function(e){a.debug(this._name+" stop()"),"function"==typeof e.getRenderer().stop&&(e.setRendererState(a.RendererCompletingState.instance),e.getRenderer().stop())}}),a.RendererStartedState=function(){this._name="RendererStartedState"},a.RendererStartedState.prototype=new a.RendererState,a.RendererStartedState.prototype.constructor=a.RendererStartedState,a.RendererStartedState.instance=new a.RendererStartedState,a.Util.mixin(a.RendererStartedState.prototype,{complete:function(e){a.debug(this._name+" complete()"),e.setRendererState(a.RendererCompletingState.instance)},stop:function(e){a.debug(this._name+" stop()"),"function"==typeof e.getRenderer().stop&&(e.setRendererState(a.RendererCompletingState.instance),!1===e.getRenderer().stop()&&e.getAdInstance().fakeComplete())}}),a.RendererCompletingState=function(){this._name="RendererCompletingState"},a.RendererCompletingState.prototype=new a.RendererState,a.RendererCompletingState.prototype.constructor=a.RendererCompletingState,a.RendererCompletingState.instance=new a.RendererCompletingState,a.Util.mixin(a.RendererCompletingState.prototype,{notifyCompleted:function(e){a.debug(this._name+" notifyCompleted()"),e.setRendererState(a.RendererCompletedState.instance),e.getAdInstance().complete()}}),a.RendererCompletedState=function(){this._name="RendererCompletedState"},a.RendererCompletedState.prototype=new a.RendererState,a.RendererCompletedState.prototype.constructor=a.RendererCompletedState,a.RendererCompletedState.instance=new a.RendererCompletedState,a.RendererFailedState=function(){this._name="RendererFailedState"},a.RendererFailedState.prototype=new a.RendererState,a.RendererFailedState.prototype.constructor=a.RendererFailedState,a.RendererFailedState.instance=new a.RendererFailedState,a.HTMLRenderer=function(){},a.HTMLRenderer.prototype={start:function(e){this.rendererController=e,e.getAdInstance().getSlot().getBase()?this._setupParameters()&&(this._render(),e.handleStateTransition(a.RENDERER_STATE_STARTED)):e.handleStateTransition(a.RENDERER_STATE_FAILED,{errorModule:"HTMLRenderer",errorCode:a.ERROR_INVALID_SLOT,errorInfo:"slot base is empty"})},pause:function(){this.log("pause")},resume:function(){this.log("resume")},stop:function(){return this.log("stop isMRAIDAd:"+this.isMRAIDAd+" tpc:"+this._tpc+" interstitial:"+this.shouldKeepInterstitial),this.isMRAIDAd||this._tpc!=a.TIME_POSITION_CLASS_DISPLAY||this.shouldKeepInterstitial?(this._cleanup(),void this.rendererController.handleStateTransition(a.RENDERER_STATE_COMPLETED)):!1},_cleanup:function(){if(this.log("_cleanup"),this.timer&&(this.timer.stop(),this.timer=null),this.adLoadTimeoutTimer&&(this.adLoadTimeoutTimer.stop(),this.adLoadTimeoutTimer=null),window.removeEventListener?(document.removeEventListener("touchmove",this.touchMoveDisabler,!1),window.removeEventListener("message",this.messageHandlerFunc,!1),window.removeEventListener("resize",this.viewportChangeFunc,!1),window.removeEventListener("scroll",this.viewportChangeFunc,!1)):window.detachEvent&&(window.detachEvent("onmessage",this.messageHandlerFunc),window.detachEvent("onresize",this.viewportChangeFunc),window.detachEvent("onscroll",this.viewportChangeFunc)),this.isMRAIDAd&&(this.mraid.inExpandedState()&&(this.log("stopping with expanded state, invoke close()"),this._mraidClose()),this.mraid.inDefaultState()))return this.log("stopping with default state, invoke close()"),void this._mraidClose();var e;if(this.expandedAdElement&&(e=this.expandedAdElement.parentNode,this.expandedAdElement._fw_closeButton&&e.removeChild(this.expandedAdElement._fw_closeButton),e.removeChild(this.expandedAdElement),this.expandedAdElement===this.defaultAdElement&&(this.defaultAdElementContainer===this.defaultAdElement&&(this.defaultAdElementContainer=null),this.defaultAdElement=null),this.expandedAdElement=null),this.expandedLightbox&&(e=this.expandedLightbox.parentNode,e.removeChild(this.expandedLightbox),this.expandedLightbox=null),this.rendererController.getAdInstance().getSlot().getTimePositionClass(),this.defaultAdElement){e=this.defaultAdElement.parentNode;var t=this.defaultAdElement;t.style.display="none",e!==this.rendererController.getAdInstance().getSlot().getBase()&&window.setTimeout(function(){for(var i=e&&e.childNodes||[],n=0;n<i.length;n++){var a=i[n];a===t&&e.removeChild(a)}},200),this.defaultAdElementContainer===this.defaultAdElement&&(this.defaultAdElementContainer=null),this.defaultAdElement=null}this.defaultAdElementContainer&&(e=this.defaultAdElementContainer.parentNode,e.removeChild(this.defaultAdElementContainer),this.defaultAdElementContainer=null),this.shouldPauseContentWhenStart&&this.rendererController.requestContentStateChange(!1)},_setupParameters:function(){var e=this.rendererController,t=e.getAdInstance(),i=t.getSlot().getTimePositionClass();this._tpc=i;var n,r=t.getActiveCreativeRendition(),t=r.getBaseUnit(),r=r.getCreativeApi();if(a.PLATFORM_NOT_SUPPORT_OVERLAY_AD&&i===a.TIME_POSITION_CLASS_OVERLAY)return e.handleStateTransition(a.RENDERER_STATE_FAILED,{errorModule:"HTMLRenderer",errorCode:a.ERROR_DEVICE_LIMIT,errorInfo:"Overlay not supported on this device."}),!1;if(a.PLATFORM_NOT_SUPPORT_MIDROLL_AD&&(i===a.TIME_POSITION_CLASS_MIDROLL||i===a.TIME_POSITION_CLASS_PAUSE_MIDROLL))return e.handleStateTransition(a.RENDERER_STATE_FAILED,{errorModule:"HTMLRenderer",errorCode:a.ERROR_DEVICE_LIMIT,errorInfo:"Midroll, pause_midroll not supported on this device."}),!1;if(a.PLATFORM_IS_IPHONE_IPOD)switch(i){case a.TIME_POSITION_CLASS_MIDROLL:case a.TIME_POSITION_CLASS_PAUSE_MIDROLL:case a.TIME_POSITION_CLASS_OVERLAY:return e.handleStateTransition(a.RENDERER_STATE_FAILED,{errorModule:"HTMLRenderer",errorCode:a.ERROR_DEVICE_LIMIT,errorInfo:"Midroll, pause_midroll and overlay ads are not supported on iPod, iPhone."}),!1;case a.TIME_POSITION_CLASS_PREROLL:case a.TIME_POSITION_CLASS_POSTROLL:e.setCapability(a.EVENT_AD_CLICK,a.CAPABILITY_STATUS_OFF)}if(this.adLoadTimeout=5,(n=e.getParameter(a.PARAMETER_RENDERER_HTML_AD_LOAD_TIMEOUT))&&(this.adLoadTimeout=0<Number(n)?Number(n):this.adLoadTimeout),this.shouldKeepInterstitial=!1,(n=e.getParameter(a.PARAMETER_RENDERER_HTML_PLACEMENT_TYPE))?this.shouldKeepInterstitial=n===a.PARAMETER_RENDERER_HTML_PLACEMENT_TYPE_INTERSTITIAL:"string"==typeof t&&(this.shouldKeepInterstitial=t.toLowerCase()===a.PARAMETER_RENDERER_HTML_BASEUNIT_INTERSTITIAL),this.isInterstitialNow=this.shouldKeepInterstitial,this.shouldPauseContentWhenStart=!1,this.shouldPauseContentWhenExpandOrClick=!this.shouldKeepInterstitial&&(i===a.TIME_POSITION_CLASS_DISPLAY||i===a.TIME_POSITION_CLASS_OVERLAY),this.shouldBackgroundTransparent=!1,n=e.getParameter(a.PARAMETER_RENDERER_HTML_SHOULD_BACKGROUND_TRANSPARENT),"undefined"!=typeof n&&null!==n&&(this.shouldBackgroundTransparent=a.Util.str2bool(n)),this.shouldEndAfterDuration=i!==a.TIME_POSITION_CLASS_DISPLAY,n=e.getParameter(a.PARAMETER_RENDERER_HTML_SHOULD_END_AFTER_DURATION),"undefined"!=typeof n&&null!==n&&(this.shouldEndAfterDuration=a.Util.str2bool(n)),this.coadScriptName=e.getParameter(a.PARAMETER_RENDERER_DISPLAY_COAD_SCRIPT_NAME),
    this.coadScriptName||(this.coadScriptName=e.getParameter("coad_script_name")),this.primaryAnchor=e.getParameter(a.PARAMETER_RENDERER_HTML_PRIMARY_ANCHOR)||"bc",this.marginWidth=e.getParameter(a.PARAMETER_RENDERER_HTML_MARGIN_WIDTH)||0,this.marginHeight=e.getParameter(a.PARAMETER_RENDERER_HTML_MARGIN_HEIGHT)||0,this.bootstrap=e.getParameter(a.PARAMETER_RENDERER_HTML_BOOTSTRAP),t=a.Util.getViewport(),this.defaultExpandWidth=t.width,this.defaultExpandHeight=t.height,this.isMRAIDAd="MRAID-1.0"===r,this.mraid=new function(e){this.STATELOADING="loading",this.STATEDEFAULT="default",this.STATEEXPANDED="expanded",this.STATEHIDDEN="hidden",this._renderer=e,this._state=this.STATELOADING,this._useCustomClose=!1,this.viewable=this.expandIsModal=!0,this._baseUrlExpanded=this._baseUrlDefault="",e=Object.defineProperty||function(e,t,i){i.get&&e.__defineGetter__(t,i.get),i.set&&e.__defineSetter__(t,i.set)},e(this,"baseUrl",{get:function(){return this.inExpandedState()?this._baseUrlExpanded||this._baseUrlDefault:this._baseUrlDefault},set:function(e){this.inExpandedState()?this._baseUrlExpanded=e:(this._baseUrlDefault=e,this._baseUrlExpanded="")}}),e(this,"useCustomClose",{get:function(){return this._useCustomClose},set:function(e){this._useCustomClose===!e&&(this._useCustomClose=!!e,this.pushData())}}),e(this,"placementType",{get:function(){return this._renderer.shouldKeepInterstitial?"interstitial":"inline"}}),e(this,"expandWidth",{get:function(){return this._renderer.requestedExpandWidth&&this._renderer.requestedExpandWidth<this._renderer.defaultExpandWidth?this._renderer.requestedExpandWidth:this._renderer.defaultExpandWidth}}),e(this,"expandHeight",{get:function(){return this._renderer.requestedExpandHeight&&this._renderer.requestedExpandHeight<this._renderer.defaultExpandHeight?this._renderer.requestedExpandHeight:this._renderer.defaultExpandHeight}}),e(this,"state",{get:function(){return this._state},set:function(e){this.log("mraid.state change "+this.state+" => "+e),this.state!==e&&(this._renderer.shouldPauseContentWhenExpandOrClick&&(e===this.STATEEXPANDED?this._renderer.rendererController.requestContentStateChange(!0):this.inExpandedState()&&this._renderer.rendererController.requestContentStateChange(!1)),e===this.STATEEXPANDED?(this._renderer.expandedAdElement?this._renderer.rendererController.processEvent({name:a.EVENT_AD_ACCEPT_INVITATION}):(this._renderer.expandedAdElement=this._renderer.defaultAdElement,this._renderer.rendererController.processEvent({name:a.EVENT_AD_EXPAND})),this._renderer.presentInterstitial(),this._renderer.shouldEndAfterDuration&&this._renderer.timer.pause()):e===this.STATEDEFAULT&&(this._renderer.shouldKeepInterstitial?(this._renderer.expandedAdElement=this._renderer.defaultAdElement,this._renderer.presentInterstitial()):(this.inExpandedState()&&(this._renderer.expandedAdElement!==this._renderer.defaultAdElement?this._renderer.rendererController.processEvent({name:a.EVENT_AD_CLOSE}):this._renderer.rendererController.processEvent({name:a.EVENT_AD_COLLAPSE})),this._renderer.expandedAdElement=null,this._renderer.presentInline()),this._renderer.shouldEndAfterDuration&&this._renderer.timer.start()),this._state=e,this.pushData(),e===this.STATEHIDDEN&&this._renderer.stop())}}),this.inLoadingState=function(){return this.state===this.STATELOADING},this.inDefaultState=function(){return this.state===this.STATEDEFAULT},this.inExpandedState=function(){return this.state===this.STATEEXPANDED},this.inHiddenState=function(){return this.state===this.STATEHIDDEN},this.pushData=function(){var e='mraid._Update("'+this.state+'", '+this.viewable+', "'+this.placementType+'", '+this.expandWidth+", "+this.expandHeight+", "+this.useCustomClose+", "+this.expandIsModal+")";this.log("mraid.pushData: going to invoke on iframe with "+e),this._renderer.defaultAdElement?(this._renderer.defaultAdElement.contentWindow.postMessage("fwsdk-bounce:"+e,"*"),this._renderer.expandedAdElement&&this._renderer.expandedAdElement!==this._renderer.defaultAdElement&&this._renderer.expandedAdElement.contentWindow.postMessage("fwsdk-bounce:"+e,"*")):this.warn("_mraidPushData: no iframe suitable to send "+e)},this.log=function(e){this._renderer.log(e)},this.warn=function(e){this._renderer.warn(e)}}(this),this.onLoadFunc=a.Util.bind(this,function(){this.adLoadTimeoutTimer&&(this.adLoadTimeoutTimer.stop(),this.adLoadTimeoutTimer=null),this.timer&&this.shouldEndAfterDuration&&this.timer.start()}),this.touchMoveDisabler=function(e){e.preventDefault()},this.log("setting parameters, adLoadTimeout: "+this.adLoadTimeout+", isMRAIDAd: "+this.isMRAIDAd+", shouldKeepInterstitial: "+this.shouldKeepInterstitial+", shouldEndAfterDuration: "+this.shouldEndAfterDuration+", shouldPauseContentWhenStart: "+this.shouldPauseContentWhenStart+", shouldPauseContentWhenExpandOrClick: "+this.shouldPauseContentWhenExpandOrClick+", shouldBackgroundTransparent: "+this.shouldBackgroundTransparent+", defaultExpandWidth: "+this.defaultExpandWidth+", defaultExpandHeight: "+this.defaultExpandHeight+", coadScriptName: "+this.coadScriptName+", primaryAnchor: "+this.primaryAnchor+", marginWidth: "+this.marginWidth+", marginHeight: "+this.marginHeight+", bootstrap: "+this.bootstrap),this.shouldKeepInterstitial){if(i===a.TIME_POSITION_CLASS_OVERLAY)return e.handleStateTransition(a.RENDERER_STATE_FAILED,{errorModule:"HTMLRenderer",errorCode:a.ERROR_INVALID_SLOT,errorInfo:"Interstitial ad is not supported on overlay slot."}),!1}else!this.isMRAIDAd||a.PLATFORM_IS_IPHONE_IPOD&&i!==a.TIME_POSITION_CLASS_DISPLAY||(e.setCapability(a.EVENT_AD_ACCEPT_INVITATION,a.CAPABILITY_STATUS_ON),e.setCapability(a.EVENT_AD_CLOSE,a.CAPABILITY_STATUS_ON),e.setCapability(a.EVENT_AD_COLLAPSE,a.CAPABILITY_STATUS_ON),e.setCapability(a.EVENT_AD_EXPAND,a.CAPABILITY_STATUS_ON));return!0},_render:function(){this.log("_render");var b=this.rendererController,c=b.getAdInstance(),d=c.getSlot(),f=d.getTimePositionClass(),g=d.getBase(),h=c.getActiveCreativeRendition(),i=h.getDuration(),k=h.getPrimaryCreativeRenditionAsset(),c=k.getUrl(),j=k.getContent();if(f===a.TIME_POSITION_CLASS_DISPLAY&&(g.innerHTML=""),this.timer=new a.Timer(i,a.Util.bind(this,this.stop)),this.coadScriptName&&"function"==typeof window[this.coadScriptName])this.defaultAdElement=window[this.coadScriptName](j,c,h.getHeight(),h.getWidth(),k.getMimeType(),d.getCustomId()),this.timer&&this.shouldEndAfterDuration&&this.timer.start();else{if(i=document.createElement("span"),i.id="_fw_ad_container_html_"+d.getCustomId()+"_",i.style.position="relative"===g.style.position?"absolute":"relative",i.style.display="inline-block",i.style.margin="0px",i.style.padding="0px",i.style.width=g.style.width||"100%",i.style.height=g.style.height||"100%",i.style.top=i.style.left="0px",g.appendChild(i),this.defaultAdElementContainer=i,!c&&!j)return b.handleStateTransition(a.RENDERER_STATE_FAILED,{errorModule:"HTMLRenderer",errorCode:a.ERROR_NULL_ASSET}),void this.stop();if("text/html_lit_nowrapper"==h.getContentType()||"text/html_lit_js_wc_nw"==h.getContentType()){if(this.isMRAIDAd||this.isInterstitialNow)return b.handleStateTransition(a.RENDERER_STATE_FAILED,{errorModule:"HTMLRenderer",errorCode:a.ERROR_INVALID_VALUE}),void this.stop();if(!j)return b.handleStateTransition(a.RENDERER_STATE_FAILED,{errorModule:"HTMLRenderer",errorCode:a.ERROR_NULL_ASSET}),void this.stop();this.defaultAdElement=i,this.defaultAdElement.innerHTML=j;for(var d=this.defaultAdElement.getElementsByTagName("script"),m=document.getElementsByTagName("head")[0],g=0;g<d.length;++g)if(d[g].src){var l=document.createElement("script");d[g].charset&&(l.charset=d[g].charset),d[g].src&&(l.src=d[g].src),d[g].innerHTML&&(l.innerHTML=d[g].innerHTML),l.onload=l.onreadystatechange=function(){(!this.readyState||"loaded"==this.readyState||"complete"==this.readyState)&&m.removeChild(l)},m.appendChild(l)}else l=d[g].innerHTML,eval(l);return this.presentInline(),void this.onLoadFunc()}h=document.createElement("iframe"),h.id="_fw_ad_container_iframe_"+d.getCustomId()+"_"+Math.random(),h.attachEvent?h.attachEvent("onload",this.onLoadFunc):h.onload=this.onLoadFunc,this.defaultAdElement=h,this.defaultAdElementContainer.appendChild(h),this._fillAdNode(h,c,j),this.isMRAIDAd&&(this.adLoadTimeoutTimer=new a.Timer(this.adLoadTimeout,a.Util.bind(this,function(){b.handleStateTransition(a.RENDERER_STATE_FAILED,{errorCode:a.ERROR_TIMEOUT,errorModule:"HTMLRenderer",errorInfo:"Loading element timeout"}),f!==a.TIME_POSITION_CLASS_DISPLAY&&this.isMRAIDAd&&!this.mraid.inLoadingState()?this._mraidClose():this.stop()})),this.adLoadTimeoutTimer.start())}!this.defaultAdElement&&(d=g.getElementsByTagName("iframe"))&&0<d.length&&(this.defaultAdElement=d[d.length-1]),this.defaultAdElement?(this.defaultAdElement.frameBorder="0",this.shouldBackgroundTransparent&&(this.defaultAdElement.allowTransparency="true",this.defaultAdElement.style["background-color"]="rgba(255,255,255,0)"),this.isInterstitialNow?(this.expandedAdElement=this.defaultAdElement,this.presentInterstitial()):this.presentInline(),this.messageHandlerFunc=a.Util.bind(this,this._onWindowMessageReceived),this.viewportChangeFunc=a.Util.bind(this,function(){this.viewportChangeFuncTimer&&window.clearTimeout(this.viewportChangeFuncTimer),this.viewportChangeFuncTimer=window.setTimeout(a.Util.bind(this,this._onViewportResizeScroll),200)}),window.addEventListener?(window.addEventListener("message",this.messageHandlerFunc,!1),window.addEventListener("resize",this.viewportChangeFunc,!1),window.addEventListener("scroll",this.viewportChangeFunc,!1)):window.attachEvent&&(window.attachEvent("onmessage",this.messageHandlerFunc),window.attachEvent("onresize",this.viewportChangeFunc),window.attachEvent("onscroll",this.viewportChangeFunc))):this.isMRAIDAd&&(b.handleStateTransition(a.RENDERER_STATE_FAILED,{errorCode:a.ERROR_UNKNOWN,errorModule:"HTMLRenderer",errorInfo:"Failed to find iframe in slotBase for MRAID ad"}),this.stop())},_layoutOverlayAd:function(e){this.log("_layoutOverlayAd");var t=this.rendererController.getAdInstance(),i=t.getSlot(),n=i.getVideoDisplaySize().width,i=i.getVideoDisplaySize().height,a=t.getActiveCreativeRendition(),t=a.getWidth()||240,a=a.getHeight()||50;switch(e.style.width=Math.min(t,n)+"px",e.style.height=Math.min(a,i)+"px",e.style.left=e.style.top=e.style.right=e.style.bottom="",this.primaryAnchor){case"tl":case"lt":e.style.top=this.marginHeight+"px",e.style.left=this.marginWidth+"px";break;case"tr":case"rt":e.style.top=this.marginHeight+"px",e.style.right=this.marginWidth+"px";break;case"bl":case"lb":e.style.bottom=this.marginHeight+"px",e.style.left=this.marginWidth+"px";break;case"br":case"rb":e.style.bottom=this.marginHeight+"px",e.style.right=this.marginWidth+"px";break;case"tc":case"ct":e.style.top=this.marginHeight+"px",e.style.left=.5*Math.max(0,n-t)+"px";break;case"lm":case"ml":e.style.left=this.marginWidth+"px",e.style.top=.5*Math.max(0,i-a)+"px";break;case"rm":case"mr":e.style.right=this.marginWidth+"px",e.style.top=.5*Math.max(0,i-a)+"px";break;case"mc":case"cm":case"c":case"m":e.style.left=.5*Math.max(0,n-t)+"px",e.style.top=.5*Math.max(0,i-a)+"px";break;default:case"bc":case"cb":e.style.bottom=this.marginHeight+"px",e.style.left=.5*Math.max(0,n-t)+"px"}},_fillAdNode:function(e,t,i){this.log("_fillAdNode, url:"+t+", content:"+(i?"<omited>":"<empty>"));var n=this.rendererController;if(t)e.src=t;else{if(!i)return n.handleStateTransition(a.RENDERER_STATE_FAILED,{errorModule:"HTMLRenderer",errorCode:a.ERROR_NULL_ASSET}),!1;e=e.contentWindow?e.contentWindow.document:e.contentDocument.document?e.contentDocument.document:e.contentDocument,e.open(),e.write(i),e.close()}return!0},presentInline:function(){this.log("presentInline"),this.isInterstitialNow=!1;var e=this.defaultAdElement;if(e){var t=this.rendererController.getAdInstance(),i=t.getSlot(),n=i.getTimePositionClass(),r=i.getWidth(),s=i.getHeight(),o=i.getVideoDisplaySize().width,i=i.getVideoDisplaySize().height,l=t.getActiveCreativeRendition(),t=l.getWidth(),l=l.getHeight();switch(e.scrolling="no",e.style.overflow="hidden",n){case a.TIME_POSITION_CLASS_DISPLAY:e.style.position="",e.style.background=this.shouldBackgroundTransparent?"transparent":"",e.style.left="0px",e.style.top="0px",e.style.width=(r?r:t)+"px",e.style.height=(s?s:l)+"px";break;case a.TIME_POSITION_CLASS_OVERLAY:e.style.position="absolute",e.style.background=this.shouldBackgroundTransparent?"transparent":"white",this._layoutOverlayAd(e);break;default:e.style.position="absolute",e.style.background=this.shouldBackgroundTransparent?"transparent":"white",e.style.left="0px",e.style.top="0px",e.style.width=o+"px",e.style.height=i+"px"}}},presentInterstitial:function(){if(this.log("presentInterstitial, defaultExpandWidth: "+this.defaultExpandWidth+", defaultExpandHeight: "+this.defaultExpandHeight+", this.mraid.expandWidth: "+this.mraid.expandWidth+", this.mraid.expandHeight: "+this.mraid.expandHeight+", (Math.max(0, this.defaultExpandWidth - this.mraid.expandWidth) / 2) = "+Math.max(0,this.defaultExpandWidth-this.mraid.expandWidth)/2+", (Math.max(0, this.defaultExpandHeight - this.mraid.expandHeight) / 2) = "+Math.max(0,this.defaultExpandHeight-this.mraid.expandHeight)/2),this.expandedAdElement){this.isInterstitialNow=!0,document.addEventListener&&(document.removeEventListener("touchmove",this.touchMoveDisabler,!1),document.addEventListener("touchmove",this.touchMoveDisabler,!1));var e=this.expandedAdElement.parentNode;if(this.expandedLightbox||(this.expandedLightbox=document.createElement("div"),this.expandedLightbox.style.background="black",this.expandedLightbox.style.opacity=.8,this.expandedLightbox.style.position="fixed",this.expandedLightbox.style.top="0px",this.expandedLightbox.style.left="0px",this.expandedLightbox.style.zIndex=this.expandedLightbox.style["z-index"]=9999,e.appendChild(this.expandedLightbox)),this.expandedLightbox.style.width=this.defaultExpandWidth+"px",this.expandedLightbox.style.height=this.defaultExpandHeight+"px",this.expandedAdElement.frameBorder="0",this.expandedAdElement.scrolling="no",this.expandedAdElement.style.position="fixed",this.expandedAdElement.style.overflow="hidden",this.expandedAdElement.style.top=this.expandedAdElement.top=Math.max(0,this.defaultExpandHeight-this.mraid.expandHeight)/2+"px",this.expandedAdElement.style.left=this.expandedAdElement.left=Math.max(0,this.defaultExpandWidth-this.mraid.expandWidth)/2+"px",this.expandedAdElement.style.width=this.expandedAdElement.width=this.mraid.expandWidth+"px",this.expandedAdElement.style.height=this.expandedAdElement.height=this.mraid.expandHeight+"px",this.expandedAdElement.style.zIndex=this.expandedAdElement.style["z-index"]=1e4,this.log("presentInterstitial, expanded ad element size: (top, left, width, height) = ("+this.expandedAdElement.top+", "+this.expandedAdElement.left+", "+this.expandedAdElement.width+", "+this.expandedAdElement.height+")"),this.isMRAIDAd){var t=this.expandedAdElement._fw_closeButton;t||(t=document.createElement("div"),t.addEventListener?t.addEventListener("click",a.Util.bind(this,function(){this._mraidClose()})):t.attachEvent&&t.attachEvent("onclick",a.Util.bind(this,function(){this._mraidClose()})),t.style.position="fixed",t.style.margin="0px",t.style.padding="0px",t.style.width="25px",t.style.height="25px",t.style.zIndex=t.style["z-index"]=10001,e.appendChild(t),this.expandedAdElement._fw_closeButton=t),t.style.top=this.expandedAdElement.style.top,t.style.left=Math.max(0,this.defaultExpandWidth-this.mraid.expandWidth)/2+this.mraid.expandWidth-25+"px",t.innerHTML=this.mraid.useCustomClose?0<a.PLATFORM_ANDROID_VERSION?"   ":"":0<a.PLATFORM_ANDROID_VERSION&&3>=a.PLATFORM_ANDROID_VERSION?'<img style="width:25px; height:25px; border:0" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA4xJREFUeNrMmjFv2kAUxw/IUAZUw4AqJjIxMAQJ9sIHgDYLUqfSBTowJBudAmOnNCNeAitLyVgxxNlBgk+QTKgb6UQHhr7nniNj8PmM3zk86XQZOPt+ee/e+9+dI4zQms1mGTpsb6EVXH42h/YHmqHrukH17kjAiWvQfYT2gfeH2BjaHfYA9hwqCABkobvik9eI/qkIMYB2A0BPSkG4By44hErrQfvhx0MRn/F/Cy3LwjH0yhfZdRSThOhyCI2FZ/iuRrFYjMxmMyMwCEDc8nB6LSsDTBZg7g4GAYj7ANmI0gpeMDEPTxwDhBRMzAXiGrqv7PgMYTSA+eWZtQACvfCTHbedQzYbu4LwOvHolp3q9TorlUpsuVyyfr/P1us16ezi8TirVqtmP5lMzPcIiuepvc5EHT+4doPIZDImhPV3q9UyX0hl+MxOp2O+I5/Ps1qt5pWat4py1CE7Gm4jnf99Sph9z5Lw9gWf845HhLJjtVqx0WhEDuMGgaElYVdbWYuTDbxGYcwiELreskQiwXK5HFssFmyz2ZBA4PoTrA9nFhtCFnu2PCJdL6bTKYlnCCCYfe4WyGc/I4PCEEK8zD3Cw+rxkPjGDIMp2Rl+otRMDGHZaZRvTQ8yv55RBGEKSwQ5C/IEWRiFEGhnMVj1naCbJa9slk6nVUKg/T2h2iyhZywZ4/RCMplUCWFW+hPBsQ0ZjFMhEEOY9SRKLUv3rRnFEHtFI4nhRPelX1xH2FQYOYjf9EsJ8qQSQqVqth8dkYGI6oQK1awExKvYUQlNL5CFSghq1exiCwQxVEOEAGPEYFPyG2QKniS+CWNTRL05w7DSdf2blX7HYe7siD0ztteRm7B3doQww5c9Ow+vspcKRvHXbrfJBCBBmOH13XdnZe95jcKzJmoVK/KMhPV2JAq/UDG8TgJVCEA3GAlvGG5a61JGpmM4UKtYJ4zEs7fmuu8Qu8vU3xEK12EqlXJV0FZIgTe6QhAOcx/kUEKxYUhVZGX8Oft/sX9sNudz2zHXW13wCm6B71m4F6AiwyuECnhj7mtjxQdUKPcrQdStCELoEZtnNO6ZwiuGU8Xr4wE/HwzgJVDY19T49cOlzA9jsk/EC0iQMQ/cM+9C8MIngOjLDjj0o5oGrzVZBWsBa8TA78Cgnznh3QQe6we9j0cpPnTe1IYG4kgIZR5273mvCdIohg6G6TzI5O32T4ABAPsBS28k7apdAAAAAElFTkSuQmCC">':'<img style="width:25px; height:25px; border:0" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwIiB5PSIwIiB3aWR0aD0iNDAwcHgiIGhlaWdodD0iNDAwcHgiIHZpZXdCb3g9IjAgMCA0MDAgNDAwIiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCA0MDAgNDAwIiB4bWw6c3BhY2U9InByZXNlcnZlIj48Y2lyY2xlIGZpbGw9IiM2NjY2NjYiIGN4PSIyMDAuMTM5IiBjeT0iMTk5Ljg2IiByPSIxOTcuODYiLz48cGF0aCBmaWxsPSIjRjBGMEYwIiBzdHJva2U9IiNGMEYwRjAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTTExNC44NjUsMzAzLjY0NGMtNi4yMjYsNi4yMjctMTUuMzYzLDcuMTg2LTIwLjQwNywyLjE0NGwtMC41MjItMC41MjJjLTUuMDQzLTUuMDQzLTQuMDgzLTE0LjE4LDIuMTQ0LTIwLjQwN0wyODQuODYsOTYuMDc4YzYuMjI2LTYuMjI3LDE1LjM2Mi03LjE4NiwyMC40MDUtMi4xNDRsMC41MjIsMC41MjFjNS4wNDMsNS4wNDIsNC4wODMsMTQuMTc5LTIuMTQ0LDIwLjQwOEwxMTQuODY1LDMwMy42NDR6Ii8+PHBhdGggZmlsbD0iI0YwRjBGMCIgc3Ryb2tlPSIjRjBGMEYwIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGQ9Ik0zMDcuODE5LDI4OC42NjZjNS4xNTMsNS4xNTgsNS4wNDgsMTMuNjI0LTAuMjQxLDE4LjkxMWwwLDBjLTUuMjg4LDUuMjg5LTEzLjc1Miw1LjM5My0xOC45MDksMC4yNEw5MS45MDYsMTExLjA1NWMtNS4xNTYtNS4xNTYtNS4wNDgtMTMuNjIzLDAuMjQtMTguOTFsMCwwYzUuMjktNS4yODksMTMuNzU1LTUuMzk2LDE4LjkxMS0wLjI0MUwzMDcuODE5LDI4OC42NjZ6Ii8+PC9zdmc+">'}}},_onWindowMessageReceived:function(e){if(this.defaultAdElement&&(e.source===this.defaultAdElement.contentWindow||(this.expandedAdElement?e.source===this.expandedAdElement.contentWindow:!1))){this.log("_onWindowMessageReceived, event.data:"+e.data+", event.origin:"+e.origin);var t=e.data.toString().split(":");if(t&&2<=t.length&&"fwsdk-invoke"===t[0]){var i=t[1];if((t=t.slice(2))&&0<t.length){for(var n=0;n<t.length;n++)t[n]=decodeURIComponent(t[n]);1===t.length&&(t=t[0])}else t=null;"iframe_ready"===i?(this.onLoadFunc&&e.source===this.defaultAdElement.contentWindow&&this.defaultAdElement!==this.expandedAdElement&&this.onLoadFunc(),t&&(t=a.Util.trim(t))&&this.isMRAIDAd&&(this.mraid.baseUrl=t),this.bootstrap&&e.source.postMessage("fwsdk-bounce:"+this.bootstrap,e.origin),e.source.postMessage('fwsdk-bounce:mraid._messagingModel = "postMessage"',e.origin),this.isMRAIDAd&&(e.source===this.defaultAdElement.contentWindow&&this.shouldPauseContentWhenStart&&this.rendererController.requestContentStateChange(!0),this.mraid.inLoadingState()?this.mraid.state=this.mraid.STATEDEFAULT:this.expandedAdElement&&e.source===this.expandedAdElement.contentWindow&&this.mraid.pushData())):this.isMRAIDAd?this._mraidMethods(i,t):"close"===i&&this.stop()}}},_mraidMethods:function(e,t){if(e&&this.isMRAIDAd)switch(this.log("_mraidMethods("+e+", "+t+")"),e){case"open":"string"==typeof t?this._mraidOpen(t):2<=t.length&&this._mraidOpen(t[0],a.Util.str2bool(t[1]));break;case"close":this._mraidClose();break;case"expand":this._mraidExpand(t);break;case"useCustomClose":t&&0<t.length?this.mraid.useCustomClose=a.Util.str2bool(t):this.warn("Invalid parameter to useCustomClose");break;case"setExpandProperties":if(!t)break;this.requestedExpandWidth=Number(t[0]),this.requestedExpandHeight=Number(t[1]),this.requestedExpandWidth&&this.requestedExpandHeight&&(this.requestedExpandWidth!==this.defaultExpandWidth||this.requestedExpandHeight!==this.defaultExpandHeight)||(this.requestedExpandHeight=this.requestedExpandWidth=0),this.mraid.useCustomClose=a.Util.str2bool(t[2]),(this.requestedExpandWidth!==this.mraid.expandWidth||this.requestedExpandHeight!==this.mraid.expandHeight)&&this.mraid.pushData();break;case"log":this.log("MRAID log:"+t);break;default:this.warn("Unknown MRAID function call: "+e+" with param:"+t)}},_mraidOpen:function(e,t){this.log("_mraidOpen("+e+"), baseUrl:"+this.mraid.baseUrl+", absolute Url"+(e=a.Util.getAbsoluteUrl(this.mraid.baseUrl,e)));var i=this.rendererController;i.getAdInstance(),e&&"string"==typeof e&&0<e.length?((t||"undefined"==typeof t)&&window.open(e),i.processEvent({name:a.EVENT_AD_CLICK,info:{showBrowser:!1,url:e}})):this.warn("_mraidOpen: url required for open")},_mraidClose:function(){if(this.log("_mraidClose, current state: "+this.mraid.state),this.mraid.inExpandedState()){window.removeEventListener&&document.removeEventListener("touchmove",this.touchMoveDisabler,!1);var e=this.expandedAdElement,t=this.expandedAdElement._fw_closeButton;this.expandedAdElement._fw_closeButton=null;var i=this.expandedAdElement.parentNode;this.mraid.state=this.mraid.STATEDEFAULT,this.expandedLightbox&&(i.removeChild(this.expandedLightbox),this.expandedLightbox=null),e!==this.defaultAdElement&&(e.style.display="hidden",window.setTimeout(function(){i.removeChild(e)},50)),i.removeChild(t)}else this.mraid.inDefaultState()?this.mraid.state=this.mraid.STATEHIDDEN:this.warn("_mraidClose: close() is only valid when in expanded/default state")},_mraidExpand:function(e){if(this.log("_mraidExpand, current state: "+this.mraid.state),this.mraid.inDefaultState())if(this.shouldKeepInterstitial)this.warn("_mraidExpand: expand() is only valid for inline ad");else{if(e){var t=document.createElement("iframe");this.shouldBackgroundTransparent&&(t.allowTransparency="true",t.style["background-color"]="rgba(255,255,255,0)"),(this.defaultAdElementContainer||this.defaultAdElement.parentNode).appendChild(t),this.expandedAdElement=t,this.log("_mraidExpand("+e+"), baseUrl:"+this.mraid.baseUrl+", absolute Url"+(e=a.Util.getAbsoluteUrl(this.mraid.baseUrl,e))),this._fillAdNode(t,e,null)}this.mraid.state=this.mraid.STATEEXPANDED,this.isInterstitialNow=!0,this._onViewportResizeScroll()}else this.warn("_mraidExpand: expand() is only valid when in default state")},_onViewportResizeScroll:function(){var e=a.Util.getViewport();this.defaultExpandWidth=e.width,this.defaultExpandHeight=e.height,this.isInterstitialNow&&this.presentInterstitial()},log:function(e){var t=this.rendererController.getAdInstance().getSlot();a.log("HTMLRenderer["+t+"]	"+e)},warn:function(e){var t=this.rendererController.getAdInstance().getSlot();a.warn("HTMLRenderer["+t+"]	"+e)},info:function(){return{moduleType:a.MODULE_TYPE_RENDERER}},getPlayheadTime:function(){return this.timer?this.timer.getPlayheadTime():-1},getDuration:function(){return this.timer?this.timer.getDuration():-1}},a.HTMLRenderer.prototype.constructor=a.HTMLRenderer,a.Ad=function(){var e=null,t=[],i=!1,n=null,r=!1;return{isRequiredToShow:function(){return r},parse:function(s){if(s){e=s.adId||null,i=s.noLoad,n=s.adUnit,s.hasOwnProperty("required")&&(r=s.required);for(var o=0,s=s.creatives||[];o<s.length;o++){var l=s[o],d=new a.Creative;d.parse(l),t.push(d)}}},getSoAdUnit:function(){return n},getId:function(){return e},getNoLoad:function(){return i},getCreative:function(e){for(var i=0;i<t.length;i++)if(t[i].getId()===e)return t[i];return null},addCreativeRendition:function(){var e=new a.Creative;return t.push(e),e}}},a.Creative=function(){var e=null,t=null,i=null,n={},r=[];return{getId:function(){return e},getBaseUnit:function(){return t},getDuration:function(){return i},getParameter:function(e){return n[e]},setParameter:function(e,t){null==t?delete n[e]:n[e]=t},parse:function(s){if(s){e=s.creativeId||null,t=s.baseUnit||null,i=1*s.duration;var o;if(s.parameters)if(s.parameters.constructor===Array)for(var l=0,d=s.parameters||[];l<d.length;l++)o=d[l],n[o.name]=o.value;else"object"==typeof s.parameters&&(n=a.Util.copy(s.parameters));for(l=0,d=s.creativeRenditions||[];l<d.length;l++)o=d[l],s=new a.CreativeRendition,s.parse(o),s.setDuration(i),s.setBaseUnit(t),r.push(s)}},getAllCreativeRenditions:function(){return r},cloneForTranslation:function(){var r=new a.Creative;return r.parse({creativeId:e,baseUnit:t,duration:i,parameters:a.Util.copy(n)}),r}}},a.CreativeRendition=function(){var e=null,t="None",i=null,n=null,r=null,s=null,o=null,l=null,d=null,_=null,c={},h=null,E=[],u=null;return{getId:function(){return e},getCreativeApi:function(){return t},setCreativeApi:function(e){t=e||"None"},getReplicaId:function(){return n},getContentType:function(){return r?r:h&&h.getContentType()?h.getContentType():null},setContentType:function(e){r=e},getWrapperType:function(){return s},setWrapperType:function(e){s=e},getWrapperUrl:function(){return o},setWrapperUrl:function(e){o=e},getBaseUnit:function(){return i},setBaseUnit:function(e){i=e},getPreference:function(){return l},setPreference:function(e){l=e},getWidth:function(){return d},setWidth:function(e){d=e},getHeight:function(){return _},setHeight:function(e){_=e},getDuration:function(){return u},setDuration:function(e){u=e},getParameter:function(e){return c[e]},setParameter:function(e,t){null==t?delete c[e]:c[e]=t},getPrimaryCreativeRenditionAsset:function(){return h},getOtherCreativeRenditionAssets:function(){return E.slice()},addCreativeRenditionAsset:function(e,t){var i=new a.CreativeRenditionAsset;return i.setName(e),t?h=i:E.push(i),i},parse:function(i){if(i){e=i.creativeRenditionId||null,t=i.creativeApi||"None",n=i.hasOwnProperty("adReplicaId")?1*i.adReplicaId:-1,r=i.contentType||null,s=i.wrapperType||null,o=i.wrapperUrl||null,l=1*i.preference,d=1*i.width,_=1*i.height;for(var u,p=0,T=i.parameters||[];p<T.length;p++)u=T[p],c[u.name]=u.value;for(h=new a.CreativeRenditionAsset,h.parse(i.asset),p=0,T=i.otherAssets||[];p<T.length;p++)u=T[p],i=new a.CreativeRenditionAsset,i.parse(u),E.push(i)}}}},a.CreativeRenditionAsset=function(){var e=null,t=null,i=null,n=null,a=null,r=null;return{getName:function(){return e},setName:function(t){e=t},getUrl:function(){return t},setUrl:function(e){t=e},getContent:function(){return i},setContent:function(e){i=e},getContentType:function(){return n},setContentType:function(e){n=e},getMimeType:function(){return a},setMimeType:function(e){a=e},getBytes:function(){return r},setBytes:function(e){r=e},parse:function(s){s&&(e=s.name||null,t=s.url||null,i=s.content||null,n=s.contentType||null,a=s.mimeType||null,r=1*s.bytes)}}},a.AdControlExtension=function(e){this._context=e,this._currentSlot=this._dragEvent=this._clickEvent=this._targetElement=null,this._dragging=!1},a.AdControlExtension.prototype={start:function(){this._clickEvent||(this._clickEvent=a.PLATFORM_EVENT_CLICK,this._dragEvent=a.MOBILE_EVENT_DRAG),this._onAdClicked=a.Util.bind(this,function(){a.log("AdControlExtension","clicked on target element: "+this._targetElement.id);var e=this._currentSlot?this._currentSlot.getCurrentAdInstance():null;e&&"VPAID"==e.getActiveCreativeRendition().getCreativeApi()||(this._dragging?this._dragging=!1:this._currentSlot&&this._currentSlot.getCurrentAdInstance()&&this._currentSlot.getCurrentAdInstance().getRendererController().processEvent({name:a.EVENT_AD_CLICK}))}),this._onAdDragged=a.Util.bind(this,function(){a.log("AdControlExtension","dragging target element: "+this._targetElement.id),this._dragging=!0}),this._onSlotStarted=a.Util.bind(this,function(e){e.slot&&this._isTargetSlot(e.slot)&&(this._clearListener(),this._attachListener(e.slot))}),this._onSlotEnded=a.Util.bind(this,function(e){e.slot&&this._isTargetSlot(e.slot)&&(this._targetElement&&(this._targetElement.style.visibility="hidden"),this._clearListener())}),this._onAdStarted=a.Util.bind(this,function(e){(e=e.adInstance)&&this._isTargetSlot(e.getSlot())&&this._targetElement&&"VPAID"!=e.getActiveCreativeRendition().getCreativeApi()&&(this._targetElement.style.visibility=0<e.getEventCallbackUrls(a.EVENT_AD_CLICK,a.EVENT_TYPE_CLICK).length?"":"hidden")}),this._context.addEventListener(a.EVENT_SLOT_ENDED,this._onSlotEnded),this._context.addEventListener(a.EVENT_SLOT_STARTED,this._onSlotStarted),this._context.addEventListener(a.EVENT_AD_IMPRESSION,this._onAdStarted),this._targetElement&&(this._targetElement.style.visibility="hidden")},_onAdClicked:function(){},_onSlotStarted:function(){},_onSlotEnded:function(){},_attachListener:function(e){a.debug("AdControlExtension._attachListener");var t=this._context.getParameter(a.PARAMETER_EXTENSION_AD_CONTROL_CLICK_ELEMENT);t&&((this._targetElement=document.getElementById(t))?(this._currentSlot=e,this._targetElement.addEventListener(this._clickEvent,this._onAdClicked,!1),this._targetElement.addEventListener(this._dragEvent,this._onAdDragged,!1)):a.warn("Attempted to process click/tap via PARAMETER_EXTENSION_AD_CONTROL_CLICK_ELEMENT specified html element: '"+t+"'. The specified element is not available on the current HTML page."))},_clearListener:function(){this._targetElement&&(this._targetElement.removeEventListener(this._clickEvent,this._onAdClicked,!1),this._targetElement.removeEventListener(this._dragEvent,this._onAdDragged,!1),this._targetElement=null),this._currentSlot=null},_isTargetSlot:function(e){return e.getType()===a.SLOT_TYPE_TEMPORAL&&e.getTimePositionClass()!==a.TIME_POSITION_CLASS_OVERLAY},dispose:function(){a.log("AdControlExtension.dispose()"),this._clearListener(),this._onAdClicked=null,this._context.removeEventListener(a.EVENT_SLOT_ENDED,this._onSlotEnded),this._context.removeEventListener(a.EVENT_SLOT_STARTED,this._onSlotStarted),this._context.removeEventListener(a.EVENT_AD_IMPRESSION,this._onAdStarted),this._onAdStarted=this._onSlotEnded=this._onSlotStarted=null}},a.AdControlExtension.prototype.constructor=a.AdControlExtension,a.AdInstance=function(e){this._context=e,this._primaryCreativeRendition=this._creative=this._replicaId=this._creativeRenditionId=this._creativeId=this._soAdUnit=this._adId=this._slot=null,this._creativeRenditions=[],this._noLoad=!1,this._companionAdInstances=[],this._eventCallbacks=[],this._externalEventCallbackUrlsDictionary={},this._rendererController=new a.RendererController(e,this),this._timer=new a.Timer,this._metr=0,this._state=a.MediaInitState.instance,this._isStartSuccessfully=this._translated=this._isImpressionSent=!1,this._lastDurationFromRenderer=-1,this._slotCustomId=this._parentAdInstancesGroup=null},a.AdInstance.prototype={},a.AdInstance.prototype.constructor=a.AdInstance,a.METR_MASK_QUARTILE=0,a.METR_MASK_MIDPOINT=1,a.METR_MASK_COMPLETE=2,a.METR_MASK_VOLUME=3,a.METR_MASK_SIZE=4,a.METR_MASK_CONTROL=5,a.METR_MASK_REWIND=6,a.METR_MASK_ACCEPT_INVITATION=7,a.METR_MASK_CLOSE=8,a.METR_MASK_MINIMIZE=9,a.METR_MASK_CLICK=10,a.AdInstance._metrDictionary={},a.AdInstance._metrDictionary[a.EVENT_AD_FIRST_QUARTILE]=a.AdInstance._metrDictionary[a.EVENT_AD_THIRD_QUARTILE]=a.AdInstance._metrDictionary[a.EVENT_AD_QUARTILE]=1<<a.METR_MASK_QUARTILE|1<<a.METR_MASK_MIDPOINT|1<<a.METR_MASK_COMPLETE,a.AdInstance._metrDictionary[a.EVENT_AD_MIDPOINT]=1<<a.METR_MASK_MIDPOINT|1<<a.METR_MASK_COMPLETE,a.AdInstance._metrDictionary[a.EVENT_AD_COMPLETE]=1<<a.METR_MASK_COMPLETE,a.AdInstance._metrDictionary[a.EVENT_AD_MUTE]=1<<a.METR_MASK_VOLUME,a.AdInstance._metrDictionary[a.EVENT_AD_UNMUTE]=1<<a.METR_MASK_VOLUME,a.AdInstance._metrDictionary[a.EVENT_AD_COLLAPSE]=1<<a.METR_MASK_SIZE,a.AdInstance._metrDictionary[a.EVENT_AD_EXPAND]=1<<a.METR_MASK_SIZE,a.AdInstance._metrDictionary[a.EVENT_AD_PAUSE]=1<<a.METR_MASK_CONTROL,a.AdInstance._metrDictionary[a.EVENT_AD_RESUME]=1<<a.METR_MASK_CONTROL,
    a.AdInstance._metrDictionary[a.EVENT_AD_REWIND]=1<<a.METR_MASK_REWIND,a.AdInstance._metrDictionary[a.EVENT_AD_ACCEPT_INVITATION]=1<<a.METR_MASK_ACCEPT_INVITATION,a.AdInstance._metrDictionary[a.EVENT_AD_CLOSE]=1<<a.METR_MASK_CLOSE,a.AdInstance._metrDictionary[a.EVENT_AD_MINIMIZE]=1<<a.METR_MASK_MINIMIZE,a.AdInstance._metrDictionary[a.EVENT_AD_CLICK]=1<<a.METR_MASK_CLICK,a.Util.mixin(a.AdInstance.prototype,{getAdId:function(){return this._adId},getSoAdUnit:function(){return this._soAdUnit},getEventCallbackUrls:function(e,t){var i=[],n=t===a.EVENT_TYPE_CLICK,r=t===a.EVENT_TYPE_CLICK_TRACKING,s=a.EventCallback.getEventCallback(this._eventCallbacks,e,r?a.EVENT_TYPE_CLICK:t);if(!s)return i;var o={};return o[a.INFO_KEY_NEED_EMPTY_CT]=!0,n?s._showBrowser&&i.push(s.getUrl(o)):r?s._showBrowser||i.push(s.getUrl(o)):i.push(s.getUrl(o)),n||(i=i.concat(s.getTrackingUrls())),i},addEventCallbackUrls:function(e,t,i){i&&this._isValidEventNameAndType(e,t)&&(this._externalEventCallbackUrlsDictionary[t+"-"+e]=this.getExternalEventCallbackUrls(e,t).concat(i||[]))},setClickThroughUrl:function(e,t){if(t&&this._isValidEventNameAndType(e,a.EVENT_TYPE_CLICK)){var i=this.getEventCallback(e,a.EVENT_TYPE_CLICK);i&&(a.Util.isParameterInURL(i._url,a.URL_PARAMETER_KEY_CR)||(i._url=i._url+"&"+a.URL_PARAMETER_KEY_CR+"="),i._url=a.Util.setParameterInURL(i._url,a.URL_PARAMETER_KEY_CR,t),i._showBrowser=!0)}},addCreativeRendition:function(){var e=new a.CreativeRendition;return e.parse({creativeRenditionId:this._creativeRenditionId,preference:0}),e.setBaseUnit(this._creative.getBaseUnit()),e.setDuration(this._creative.getDuration()),this._creativeRenditions.push(e),this.isPlaceholder()&&(this._noLoad=!1),e},getRendererController:function(){return this._rendererController},getSlot:function(){return this._slot||(this._slot=this._context._adResponse.getSlotByCustomId(this._slotCustomId)),this._slot},getCompanionSlots:function(){for(var e=[],t=0;t<this._companionAdInstances.length;t++)e.push(this._companionAdInstances[t]._slot);return e},getCreativeRendition:function(e,t){for(var i=null,n=0,a=this._creativeRenditions||[];n<a.length;n++)if(a[n].getId()===e){if(a[n].getReplicaId()===t)return a[n];(!i||a[n].getReplicaId()<i.getReplicaId())&&(i=a[n])}return i},getActiveCreativeRendition:function(){return this._primaryCreativeRendition},setActiveCreativeRendition:function(e){e?(-1==this._creativeRenditions.indexOf(e)&&this._creativeRenditions.push(cr),this._primaryCreativeRendition=e,this._creativeRenditionId=e.getId()):a.warn("AdInstance.setActiveCreativeRendition","rendition is null")},getAllCreativeRenditions:function(){var e=this._creativeRenditions.slice();e.sort(function(e,t){return t.getPreference()-e.getPreference()});var t=e.indexOf(this._primaryCreativeRendition);return t>-1&&(e.splice(t,1),e.unshift(this._primaryCreativeRendition)),e},getRenderableCreativeRenditions:function(){var e=this._creativeRenditions.slice().sort(function(e,t){return t.getPreference()-e.getPreference()}).filter(function(e){return this._rendererController.rendererMatch(e)},this),t=e.indexOf(this._primaryCreativeRendition);return t>-1&&(e.splice(t,1),e.unshift(this._primaryCreativeRendition)),e},getPlayheadTime:function(){var e=-1;if(this._rendererController.getRenderer()&&"function"==typeof this._rendererController.getRenderer().getPlayheadTime)try{e=this._rendererController.getRenderer().getPlayheadTime()}catch(t){a.warn("AdInstance.getPlayheadTime",t.description)}return e},getDuration:function(){var e=-1;return this._rendererController.getRenderer()&&"function"==typeof this._rendererController.getRenderer().getDuration&&(this._lastDurationFromRenderer=e=this._rendererController.getRenderer().getDuration()),-1===e&&(e=-1<this._lastDurationFromRenderer?this._lastDurationFromRenderer:this.getActiveCreativeRendition().getDuration()),e},parse:function(e){if(e){this._adId=e.adId,this._creativeId=e.creativeId,this._creativeRenditionId=e.creativeRenditionId,this._replicaId=e.hasOwnProperty("replicaId")?1*e.replicaId:-1,this._noLoad=this._context._adResponse.getAd(this._adId).getNoLoad(),this._soAdUnit=this._context._adResponse.getAd(this._adId).getSoAdUnit(),this._creative=this._context._adResponse.getCreative(this._adId,this._creativeId),this._creativeRenditions=this._creative.getAllCreativeRenditions();for(var t,i=0,n=e.eventCallbacks||[];i<n.length;i++){t=n[i];var r=a.EventCallback.newEventCallback(this._context,t.name,t.type);r&&(r._adInstance=this,r.parse(t),this._eventCallbacks.push(r))}for(i=0,n=e.companionAds||[];i<n.length;++i)(t=n[i])&&t.adSlotCustomId&&(r=new a.AdInstance(this._context),r._slotCustomId=t.adSlotCustomId,r.parse(t),this._companionAdInstances.push(r));for(i=0,n=e.fallbackAds||[];i<n.length;++i)t=n[i],r=new a.AdInstance(this._context),this._parentAdInstancesGroup.push(r),r._slot=this._slot,r._parentAdInstancesGroup=this._parentAdInstancesGroup,r.parse(t);this._primaryCreativeRendition=this.getCreativeRendition(this._creativeRenditionId,this._replicaId)}},play:function(){if(a.log("AdInstance.play "+this._slotCustomId),this._timer.tick(),this.processEvent(a.EVENT_AD_IMPRESSION,a.EVENT_TYPE_IMPRESSION),this._isStartSuccessfully||(a.MODULE_TYPE_RENDERER===this._rendererController.getRenderer().info()[a.INFO_KEY_MODULE_TYPE]&&this._context.dispatchEvent(a.EVENT_AD_IMPRESSION,{adInstance:this,slotCustomId:this._slotCustomId}),this._isStartSuccessfully=!0),this._state.play(this),this._rendererController.getRenderer().info()[a.INFO_KEY_MODULE_TYPE]===a.MODULE_TYPE_RENDERER)for(var e=0;e<this._companionAdInstances.length;e++)this._companionAdInstances[e].isPlaceholder()||this._companionAdInstances[e].getSlot().playCompanionAds(this._companionAdInstances[e])},stop:function(){a.log("AdInstance.stop"),this._rendererController.stop()},fakeComplete:function(){this._slot.getTimePositionClass()===a.TIME_POSITION_CLASS_DISPLAY&&(this._isStartSuccessfully=!1,this._slot.playNextAdInstance())},complete:function(){this._isStartSuccessfully&&(this.processEvent(a.EVENT_AD_IMPRESSION_END,a.EVENT_TYPE_IMPRESSION),a.MODULE_TYPE_RENDERER===this._rendererController.getRenderer().info()[a.INFO_KEY_MODULE_TYPE]&&this._context.dispatchEvent(a.EVENT_AD_IMPRESSION_END,{adInstance:this})),this._state.complete(this),this._rendererController._restorePlaceholdersForHybrid(),this._rendererController.setRenderer(null),this._isStartSuccessfully=!1,this._slot.playNextAdInstance()},isStarted:function(){return this._isStartSuccessfully},onStartPlaying:function(){a.MODULE_TYPE_RENDERER===this._rendererController.getRenderer().info()[a.INFO_KEY_MODULE_TYPE]?this._isImpressionSent=!0:this._translated=!0},onCompletePlaying:function(){},onStartReplaying:function(){},onCompleteReplaying:function(){},getEventCallback:function(e,t){return a.EventCallback.getEventCallback(this._eventCallbacks,e,t)},processEvent:function(e,t,i){var n=!0,t=this.getEventCallback(e,t);return e===a.EVENT_AD_IMPRESSION&&this._isStartSuccessfully&&(t=this.getEventCallback(a.EVENT_ERROR,a.EVENT_TYPE_ERROR),i={errorInfo:"Trying to send defaultImpression multiple times"},n=!1),t?t.process(i):n=!1,e===a.EVENT_AD_CLICK&&this._context.dispatchEvent(a.EVENT_AD_CLICK,{adInstance:this}),(e!=a.EVENT_AD_IMPRESSION&&e!=a.EVENT_AD_IMPRESSION_END||a.MODULE_TYPE_RENDERER===this._rendererController.getRenderer().info()[a.INFO_KEY_MODULE_TYPE])&&this._context.dispatchEvent(a.EVENT_AD,{subType:e,adInstance:this,slot:this._slot}),n},setMetr:function(e,t){var i=a.AdInstance._metrDictionary[e];i&&(e===a.EVENT_AD_CLICK&&(t=!t),this._metr=t===a.CAPABILITY_STATUS_ON||!0===t?this._metr|i:this._metr&~i)},getExternalEventCallbackUrls:function(e,t){return(this._externalEventCallbackUrlsDictionary[t+"-"+e]||[]).slice()},reset:function(){this._rendererController.reset();for(var e=0;e<this._companionAdInstances.length;e++){var t=this._companionAdInstances[e];(t._state===a.MediaPlayingState.instance||t._state===a.MediaReplayingState.instance)&&t.stop(),t._rendererController.reset()}},cloneForTranslation:function(){var e=new a.AdInstance(this._context);e._parent=this,e._adId=this._adId,e._creativeId=this._creativeId,e._creative=this._creative.cloneForTranslation(),e._creativeRenditionId=this._creativeRenditionId,e._noLoad=this._noLoad,e._slot=this.getSlot(),e._soAdUnit=this.getSoAdUnit();for(var t=0;t<this._eventCallbacks.length;t++){var i=this._eventCallbacks[t].copy();i._adInstance=e,e._eventCallbacks.push(i)}for(e._externalEventCallbackUrlsDictionary=a.Util.copy(this._externalEventCallbackUrlsDictionary),t=0;t<this._companionAdInstances.length;t++)this._companionAdInstances[t].isPlaceholder()?e._companionAdInstances.push(this._companionAdInstances[t].cloneForTranslation()):e._companionAdInstances.push(this._companionAdInstances[t]);return e},isPlaceholder:function(){return this._noLoad},setMediaState:function(e){this._state=e},_isValidEventNameAndType:function(e,t){return a.Util.isBlank(e)||a.Util.isBlank(t)?!1:t===a.EVENT_TYPE_CLICK||t===a.EVENT_TYPE_CLICK_TRACKING||t===a.EVENT_TYPE_IMPRESSION&&(e===a.EVENT_AD_IMPRESSION||e===a.EVENT_AD_FIRST_QUARTILE||e===a.EVENT_AD_MIDPOINT||e===a.EVENT_AD_THIRD_QUARTILE||e===a.EVENT_AD_COMPLETE)||t===a.EVENT_TYPE_STANDARD&&(e===a.EVENT_AD_PAUSE||e===a.EVENT_AD_RESUME||e===a.EVENT_AD_REWIND||e===a.EVENT_AD_MUTE||e===a.EVENT_AD_UNMUTE||e===a.EVENT_AD_COLLAPSE||e===a.EVENT_AD_EXPAND||e===a.EVENT_AD_MINIMIZE||e===a.EVENT_AD_CLOSE||e===a.EVENT_AD_ACCEPT_INVITATION)||t===a.EVENT_TYPE_ERROR&&e===a.EVENT_ERROR},isPlayable:function(){var e;return(e=!(this._rendererController.getRendererState()==a.RendererFailedState.instance&&!this._isImpressionSent))?((e=e&&!this._translated)||a.debug("AdInstance.isPlayable returning false translated:",this._translated),e):(a.debug("AdInstance.isPlayable returning false isImpressionSent:",this._isImpressionSent),e)},toString:function(){return"[AdInstance "+this._adId+"]"},getCompanionAdInstances:function(){for(var e=[],t=0;t<this._companionAdInstances.length;++t)this._companionAdInstances[t].isPlaceholder()||e.push(this._companionAdInstances[t]);return e},isRequiredToShow:function(){return this._context._adResponse.getAd(this._adId).isRequiredToShow()}}),a.AdManager=function(){var e=this;this._context=this.newContext(),this._context.addEventListener(a.EVENT_REQUEST_COMPLETE,function(t){e.onRequestComplete(t)}),this._networkId=this._serverURL="",this._onRequestComplete=this._location=null},a.AdManager.prototype={getVersion:function(){if(a.version){var e=a.version.match(/^js-(\d)\.(\d)\.(\d).(\d)/)||a.version.match(/^js-(\d)\.(\d)\.(\d)/)||a.version.match(/^js-(\d)\.(\d)/);if(0<e.length)return(e[1]<<24)+(e[2]<<16)+(e[3]<<8)+e[4];if(0===a.versions.indexOf("js-trunk"))return 4294967295}return 0},setNetwork:function(e){if(a.debug("AdManager.setNetwork("+Array.prototype.slice.call(arguments).join(",")+")"),1*e>0){this._networkId=1*e;for(var t in a._instanceQueue)if(a._instanceQueue.hasOwnProperty(t)){var i=a._instanceQueue[t];i&&i._videoAsset._videoPlayPending&&i._videoAsset.play()}}else a.warn("AdManager.setNetwork","valid networkId required")},setServerURL:function(e){a.debug("AdManager.setServerURL("+Array.prototype.slice.call(arguments).join(",")+")"),a.warn("AdManager.setServerURL method is DEPRECATED, use AdManager.setServer instead."),this.setServer(e)},setServer:function(e){if(a.debug("AdManager.setServer("+Array.prototype.slice.call(arguments).join(",")+")"),e&&"string"==typeof e){this._serverURL=e;for(var t in a._instanceQueue)if(a._instanceQueue.hasOwnProperty(t)){var i=a._instanceQueue[t];i&&i._videoAsset._videoPlayPending&&i._videoAsset.play()}}else a.warn("AdManager.setServer","server url required")},setLocation:function(e){a.debug("AdManager.setLocation("+Array.prototype.slice.call(arguments).join(",")+")"),this._location=e},newContext:function(){return a.debug("AdManager.newContext("+Array.prototype.slice.call(arguments).join(",")+")"),new a.Context(this)},setParameter:function(e,t,i){a.debug("AdManager.setParameter("+Array.prototype.slice.call(arguments).join(",")+")"),this._context.setParameter(e,t,i)},getParameter:function(e){return this._context.getParameter(e)},submitRequest:function(e,t){a.debug("AdManager.submitRequest()"),e&&"function"==typeof e?this._onRequestComplete=e:a.warn("AdManager.submitRequest(): callback function required"),this._context.submitRequest(t/1e3)},onRequestComplete:function(e){a.debug("AdManager.onRequestComplete("+Array.prototype.slice.call(arguments).join(",")+")"),this._onRequestComplete&&(this._onRequestComplete({success:e.success,response:e.response}),this._onRequestComplete=null)},registerVideoDisplayBase:function(e){a.debug("AdManager.registerVideoDisplayBase("+Array.prototype.slice.call(arguments).join(",")+")"),this._context.registerVideoDisplayBase(e)},setVideoAsset:function(e,t){a.debug("AdManager.setVideoAsset("+Array.prototype.slice.call(arguments).join(",")+")"),this._context.setVideoAsset(e,t)},setSiteSection:function(e){a.debug("AdManager.setSiteSection("+Array.prototype.slice.call(arguments).join(",")+")"),this._context.setSiteSection(e)},addKeyValue:function(e,t){a.debug("AdManager.addKeyValue("+Array.prototype.slice.call(arguments).join(",")+")"),this._context.addKeyValue(e,t)},setVideoDisplayCompatibleSizes:function(e){a.debug("AdManager.setVideoDisplayCompatibleSizes("+Array.prototype.slice.call(arguments).join(",")+")"),this._context.setVideoDisplayCompatibleSizes(e)},playSlots:function(e,t){a.warn("AdManager.playSlots() has DEPRECATED, use tv.freewheel.SDK.Slot.Play() instead"),a.debug("AdManager.playSlots("+e+")"),"string"==typeof e&&(e=e.toUpperCase()),this._playSlots(e,t)},_playSlots:function(e,t){if("function"!=typeof t&&(t=function(){}),this._context._adResponse){for(var i=[],n=this._context.getTemporalSlots(),r=0;r<n.length;++r){var s=n[r];(.1>Math.abs(s.getTimePosition()-e)||e===s.getTimePositionClass())&&i.push(s)}if(0===i.length)a.warn("AdManager.playSlots","no slot matches",e),t();else if(e===a.TIME_POSITION_CLASS_OVERLAY)for(r=0;r<i.length;r++)(function(e){if(!e._onContentVideoTimeUpdate){var t=this._context.getContentVideoElement(),i=e._onContentVideoTimeUpdate=function(){!t.paused&&!0!==t._fw_videoAdPlaying&&0<=t.currentTime-e.getTimePosition()&&1>t.currentTime-e.getTimePosition()&&(t.removeEventListener("timeupdate",i,!1),e._play(function(){var n=setInterval(function(){!t.paused&&2<Math.abs(t.currentTime-e.getTimePosition())&&(t.addEventListener("timeupdate",i,!1),clearInterval(n))},1e3)}))};t.addEventListener("timeupdate",i,!1)}})(i[r]);else(function(){var e=i.shift();e?e._play(arguments.callee):t()})()}else a.warn("AdManager._playSlots","request is not completed"),t()},dispose:function(){a.debug("AdManager.dispose()"),this._context.dispose(),this._onRequestComplete=null},cloneContext:function(e){var t,i=this.newContext(),n=e._adRequest._capabilities._capabilities;for(t in n)n.hasOwnProperty(t)&&i.setCapability(t,n[t]);return i.setProfile(e._adRequest._playerProfile),i.setSiteSection(e._ss_id,e._ss_networkId,e._ss_pageViewRandom,e._ss_idType,e._ss_fallbackId),i.setVideoAsset(e._va_id,e._va_duration,e._va_networkId,e._va_location,e._va_autoPlayType,e._va_viewRandom,e._va_idType,e._va_fallbackId),i.setVisitor(e._adRequest._visitorCustomId),i}},a.AdManager.prototype.constructor=a.AdManager,a.AdRequest=function(e){this._context=e,this._capabilities=new a.Capabilities,this._keyValues=[],this._playerProfile="",this._compatibleDimensions=null,this._temporalSlots=[],this._siteSectionId=this._siteSectionCustomId="",this._siteSectionViewRandom=this._siteSectionFallbackId=this._siteSectionNetworkId=0,this._visitorCustomId="",this._subsessionToken=0,this._slotScanner=new a.PageSlotScanner(e),this._urlParams={},this._urlKeyValues=[],this._customInfo=""},a.AdRequest.prototype={setCapability:function(e,t){this._capabilities.setCapability(e,t)},addKeyValue:function(e,t){if("string"!=typeof e||"string"!=typeof t||0===e.length)a.warn("AdRequest.addKeyValue:","key and value required");else{var i=encodeURIComponent(e)+"="+encodeURIComponent(t);0>this._keyValues.indexOf(i)&&this._keyValues.push(i)}},setProfile:function(e){"string"!=typeof e?a.warn("AdRequest.setProfile:","player profile required"):this._playerProfile=e},setVideoDisplayCompatibleSizes:function(e){if(e&&e.length){for(var t=[],i={},n=0;n<e.length;++n)if(a.debug("dimension is:",e[n].width,"X",e[n].height),0<e[n].width&&0<e[n].height){var r=e[n].width+","+e[n].height;null==i[r]&&(i[r]="",t.push(r))}0<t.length&&(this._compatibleDimensions=t.join("|"))}else a.warn("AdRequest.setVideoDisplayCompatibleSizes:","compatible dimensions required")},setSiteSection:function(e,t,i,n,r){if(e){switch(n){case a.ID_TYPE_FW:this._siteSectionId=e;break;case a.ID_TYPE_GROUP:this._siteSectionId="g"+e;break;default:this._siteSectionCustomId=e}1*t>0&&(this._siteSectionNetworkId=1*t),1*i>0&&(this._siteSectionViewRandom=1*i),1*r>0&&(this._siteSectionFallbackId=1*r)}else a.warn("AdRequest.setSiteSection: id required")},setVisitor:function(e){"string"!=typeof e?a.warn("AdRequest.setVisitor:","customId required"):this._visitorCustomId=e},addTemporalSlot:function(e,t,i,n,r){if(a.Util.isBlank(e)||a.Util.isBlank(t)||0>i)a.warn("AdRequest.addTemporalSlot:","invalid parameters");else{for(var s=0;s<this._temporalSlots.length;s++)if(this._temporalSlots[s].getCustomId()===e)return void a.warn("AdRequest.addTemporalSlot:","slot is already existed, ignored");s=new a.Slot(this._context),s.setCustomId(e),s.setAdUnit(t),s.setTimePosition(i),s.setSlotProfile(n),s.setCuepointSequence(1*r),this._temporalSlots.push(s)}},setSubsessionToken:function(e){this._subsessionToken=e},scanPageSlots:function(){this._slotScanner.scanPageSlots()},generateTypeBRequestUrl:function(){var e=this._context._adManager._serverURL.split("?"),t=e[0],i=[/fwmrm\.net$/,/fwmrm\.net\/$/,/fwmrm\.net\/ad$/,/fwmrm\.net\/ad\/$/,/fwmrm\.net\/ad\/g$/,/fwmrm\.net\/ad\/g\/$/,/fwmrm\.net\/ad\/g\/1$/];if(0===t.indexOf("http://")||0===t.indexOf("https://"))for(var n=0;n<i.length;++n)if(t.match(i[n])){t=t.slice(0,t.indexOf("fwmrm.net")+9)+"/ad/g/1";break}return this.parseQueryStr(e.slice(1).join("?")),e=this.generateGlobalParametersQueryStr()+";"+this.generateKeyValuesStr()+";",this._capabilities.getCapability(a.CAPABILITY_SKIP_AD_SELECTION)&&1==this._capabilities.getCapability(a.CAPABILITY_SKIP_AD_SELECTION)||(e+=this.generateSlotsTypeBStr()),a.Util.isBlank(this._customInfo)||(e+=";"+this._customInfo),t+"?"+e},generateVideoViewRequestUrlWithDummyContextInstanceId:function(e){this._context.setCapability(a.CAPABILITY_REQUIRE_VIDEO_CALLBACK,a.CAPABILITY_STATUS_ON),this._context.setCapability(a.CAPABILITY_SKIP_AD_SELECTION,a.CAPABILITY_STATUS_ON);var t=this.generateTypeBRequestUrl(),t=a.Util.setParameterInURL(t,"cbfn","tv.freewheel.SDK._instanceQueue['Context_"+e+"']._videoAsset.requestComplete");return a.debug("generateVideoViewRequestUrlWithDummyContextInstanceId():"+t),this._context.setCapability(a.CAPABILITY_REQUIRE_VIDEO_CALLBACK,a.CAPABILITY_STATUS_UNSET),this._context.setCapability(a.CAPABILITY_SKIP_AD_SELECTION,a.CAPABILITY_STATUS_UNSET),t},parseQueryStr:function(e){if(a.debug("AdRequest.parseQueryStr("+Array.prototype.slice.call(arguments).join(",")+")"),this._urlParams={},this._urlKeyValues=[],this._customInfo="",e){";"===e.charAt(e.length-1)&&(e=e.substring(0,e.length-1));var t,i,n=e.split(";");if(n[0])for(t=n[0].split("&"),i=0;i<t.length;++i){var r=t[i].split("=");2===r.length&&(this._urlParams[r[0]]=r[1])}if(n[1])for(t=n[1].split("&"),i=0;i<t.length;++i)this._urlKeyValues.push(t[i]);n[2]&&(this._customInfo=n.slice(2).join(";"))}},generateGlobalParametersQueryStr:function(){a.debug("AdRequest.generateGlobalParametersQueryStr");for(var e=this._context.getParameter("wrapperVersion"),e=[["prof",this._playerProfile,"string"],["nw",this._context._adManager._networkId,"number"],["caid",this._context._videoAsset._customId,"string"],["asid",this._context._videoAsset._id,"string"],["vdur",this._context._videoAsset._duration,"number"],["asnw",this._context._videoAsset._networkId,"number"],["asml",this._context._videoAsset._location,"string"],["vprn",this._context._videoAsset._viewRandom,"number"],["afid",this._context._videoAsset._fallbackId,"number"],["csid",this._siteSectionCustomId,"string"],["ssid",this._siteSectionId,"string"],["ssnw",this._siteSectionNetworkId,"number"],["pvrn",this._siteSectionViewRandom,"number"],["sfid",this._siteSectionFallbackId,"number"],["vcid",this._visitorCustomId,"string"],["ssto",this._subsessionToken,"number"],["cd",this._compatibleDimensions||this.detectScreenDimension(),"string"],["vclr",a.version+(e?","+e:""),"string"],["resp",a.PLATFORM_SEND_REQUEST_BY_FORM?"json2":"json","string"],["orig",window.location.protocol+"//"+window.location.host,"string"],["cbfn","tv.freewheel.SDK._instanceQueue['Context_"+this._context._instanceId+"'].requestComplete","string"]],t=0;t<e.length;t++){var i=e[t];switch(i[2]){case"string":a.Util.isBlank(i[1])||(this._urlParams[i[0]]=encodeURIComponent(i[1]));break;case"number":0<i[1]&&(this._urlParams[i[0]]=i[1])}}var n,e="";for(n in this._urlParams)this._urlParams.hasOwnProperty(n)&&(e+=n+"="+this._urlParams[n]+"&");switch(e=e.substring(0,e.length-1),0<this._slotScanner._candidateAds.length&&(null==this._capabilities._capabilities[a.CAPABILITY_CHECK_COMPANION]&&this._capabilities.setCapability(a.CAPABILITY_CHECK_COMPANION,a.CAPABILITY_STATUS_ON),null==this._capabilities._capabilities[a.CAPABILITY_CHECK_TARGETING]&&this._capabilities.setCapability(a.CAPABILITY_CHECK_TARGETING,a.CAPABILITY_STATUS_OFF)),!this._context._videoAsset._eventCallback&&!this._context._videoAsset._requestedVideoViewUrl&&(this._context._videoAsset._id||this._context._videoAsset._customId)&&this._context.setCapability(a.CAPABILITY_REQUIRE_VIDEO_CALLBACK,a.CAPABILITY_STATUS_ON),this._capabilities._capabilities[a.CAPABILITY_DISPLAY_REFRESH]&&this._context.setCapability(a.CAPABILITY_REQUIRE_VIDEO_CALLBACK,a.CAPABILITY_STATUS_OFF),e=this._capabilities.parseCapabilities(e),this._context.setCapability(a.CAPABILITY_REQUIRE_VIDEO_CALLBACK,a.CAPABILITY_STATUS_UNSET),n="",this._context._videoAsset._autoPlayType){case a.VIDEO_ASSET_AUTO_PLAY_TYPE_UNATTENDED:n="+play+uapl";break;case a.VIDEO_ASSET_AUTO_PLAY_TYPE_NONE:n="-play";break;default:n="+play-uapl"}return e=e.replace(/flag=/,"flag="+encodeURIComponent(n))},generateKeyValuesStr:function(){a.debug("AdRequest.generateKeyValuesStr");for(var e=a.Util.flashVersion(),e=this._keyValues.concat(["_fw_h_x_flash_version="+encodeURIComponent(e),"_fw_dpr="+(void 0===window.devicePixelRatio?"1":window.devicePixelRatio.toFixed(2).toString())]),t=0;t<this._urlKeyValues.length;t++){var i=this._urlKeyValues[t];0>e.indexOf(i)&&e.push(i)}return(t=this._context._adManager._location)&&e.push("ltlg="+encodeURIComponent(Math.round(1e4*t.coords.latitude)/1e4+","+Math.round(1e4*t.coords.longitude)/1e4)),e.join("&")},generateSlotsTypeBStr:function(){a.debug("AdRequest.generateSlotsTypeBStr");for(var e="",t=[],i=0;i<this._temporalSlots.length;i++){for(var n=this._temporalSlots[i],n=[["slid",n.getCustomId(),"string"],["slau",n.getAdUnit(),"string"],["ptgt","a","string"],["tpos",n.getTimePosition(),"number"],["cpsq",n.getCuepointSequence(),"number"],["envp",n.getSlotProfile(),"string"]],r=[],s=0;s<n.length;s++){var o=n[s];switch(o[2]){case"string":a.Util.isBlank(o[1])||r.push(o[0]+"="+encodeURIComponent(o[1]));break;case"number":"cpsq"===o[0]?0<o[1]&&r.push(o[0]+"="+o[1]):0<=o[1]&&r.push(o[0]+"="+o[1])}}t.push(r.join("&"))}return 0<t.length&&(e=t.join(";")+";"),e+=this._slotScanner.slotsToTypeBStr()},detectScreenDimension:function(){return a.debug("AdRequest.detectScreenDimension:",screen.width+","+screen.height),screen.width+","+screen.height}},a.AdResponse=function(e){this._context=e},a.AdResponse.prototype={},a.AdResponse.prototype.constructor=a.AdResponse,a.Util.mixin(a.AdResponse.prototype,{parse:function(e,t){this._data=e,this._temporalSlots=[],this._videoPlayerNonTemporalSlots=[],this._siteSectionNonTemporalSlots=[],this._profileParameters={},this._ads=[],this._siteSectionCustomId=a.Util.getObject("siteSection.customId",e)||"",this._adRenderers=[];var i,n,r;for(n=a.Util.getObject("parameters",e)||[],i=0;i<n.length;++i)r=n[i],this._profileParameters[r.name]=r.value;for(this._adRenderers=a.Util.getObject("rendererManifest.adRenderers.adRenderer",e)||[],i=0;i<this._adRenderers.length;i++)"undefined"!=typeof this._adRenderers[i].adUnit&&(this._adRenderers[i].baseUnit=this._adRenderers[i].adUnit,delete this._adRenderers[i].adUnit);for(n=a.Util.getObject("ads.ads",e)||[],i=0;i<n.length;++i)r=new a.Ad(this._context),r.parse(n[i]),this._ads.push(r);for(n=a.Util.getObject("siteSection.videoPlayer.videoAsset.adSlots",e)||[],i=0;i<n.length;++i)r=new a.Slot(this._context),r.setType(a.SLOT_TYPE_TEMPORAL),r.setBase(t),r.parse(n[i]),this._temporalSlots.push(r);for(n=a.Util.getObject("siteSection.videoPlayer.adSlots",e)||[],i=0;i<n.length;++i)r=new a.Slot(this._context),r.setType(a.SLOT_TYPE_VIDEOPLAYER_NONTEMPORAL),r.setTimePositionClass(a.TIME_POSITION_CLASS_DISPLAY),r.parse(n[i]),this._initSlotData(r),this._videoPlayerNonTemporalSlots.push(r);for(n=a.Util.getObject("siteSection.adSlots",e)||[],i=0;i<n.length;++i)r=new a.Slot(this._context),r.setType(a.SLOT_TYPE_SITESECTION_NONTEMPORAL),r.setTimePositionClass(a.TIME_POSITION_CLASS_DISPLAY),r.parse(n[i]),this._initSlotData(r),this._siteSectionNonTemporalSlots.push(r);this._context._videoAsset.parse(a.Util.getObject("siteSection.videoPlayer.videoAsset",e)||{})},getCreativeRendition:function(e,t,i,n){return(e=this.getCreative(e,t))?e.getCreativeRendition(i,n):null},getCreative:function(e,t){var i=this.getAd(e);return i?i.getCreative(t):null},getAd:function(e){for(var t=0;t<this._ads.length;t++){var i=this._ads[t];if(i.getId()===e)return i}return null},getTemporalSlots:function(){return this._temporalSlots},getSiteSectionNonTemporalSlots:function(){return this._siteSectionNonTemporalSlots},getVideoPlayerNonTemporalSlots:function(){return this._videoPlayerNonTemporalSlots},getSiteSectionCustomId:function(){return this._siteSectionCustomId},getSlotByCustomId:function(e){for(var t=0;t<this._temporalSlots.length;++t)if(this._temporalSlots[t].getCustomId()===e)return this._temporalSlots[t];for(t=0;t<this._videoPlayerNonTemporalSlots.length;++t)if(this._videoPlayerNonTemporalSlots[t].getCustomId()===e)return this._videoPlayerNonTemporalSlots[t];for(t=0;t<this._siteSectionNonTemporalSlots.length;++t)if(this._siteSectionNonTemporalSlots[t].getCustomId()===e)return this._siteSectionNonTemporalSlots[t];return a.warn("getSlotByCustomId(): not found",e),null},_initSlotData:function(e){for(var t=!1,i=0;i<this._context._adRequest._slotScanner._knownSlots.length;i++){var n=this._context._adRequest._slotScanner._knownSlots[i];if(e.getCustomId()===n.id&&n.element){e.setWidth(n.width),e.setHeight(n.height),e.setBase(n.element),e.setAcceptCompanion(n.acceptCompanion),e.setInitialAdOption(n.initialAdOption),t=!0;break}}return t||a.warn("Failed to init slot "+e.getCustomId()),t}}),a.Capabilities=function(){this._capabilities={},this.init()},a.Capabilities.prototype={init:function(){for(var e=[a.CAPABILITY_SLOT_TEMPLATE,a.CAPABILITY_MULTIPLE_CREATIVE_RENDITIONS,a.CAPABILITY_FALLBACK_UNKNOWN_ASSET,a.CAPABILITY_FALLBACK_UNKNOWN_SITE_SECTION,a.CAPABILITY_FALLBACK_ADS,a.CAPABILITY_SLOT_CALLBACK,a.CAPABILITY_NULL_CREATIVE,a.CAPABILITY_AUTO_EVENT_TRACKING,a.CAPABILITY_RENDERER_MANIFEST],t=0;t<e.length;t++)this._capabilities[e[t]]=a.CAPABILITY_STATUS_ON},setCapability:function(e,t){this._capabilities[e]=t},getCapability:function(e){return this._capabilities[e]},parseCapabilities:function(e){var t,i="";for(t in this._capabilities)if(this._capabilities.hasOwnProperty(t)){switch(this._capabilities[t]){case a.CAPABILITY_STATUS_ON:i+="+"+t;break;case a.CAPABILITY_STATUS_OFF:i+="-"+t}e=e.replace(RegExp("(%2B|-|\\+)"+t,"g"),"")}return i=encodeURIComponent(i),e=-1<e.indexOf("flag=")?e.replace(/flag=/,"flag="+i):e+("&flag="+i)}},a.ContentVideoExtension=function(e){function t(){a.debug("ContentVideoExtension: EVENT_CONTENT_VIDEO_PAUSE_REQUEST pausing content video",_.src),c=_.currentTime,_.pause()}function i(){if(a.debug("ContentVideoExtension: EVENT_CONTENT_VIDEO_RESUME_REQUEST resume content video",_.src),!d._videoAsset||null!=d._videoAsset._state&&d._videoAsset._state!==a.VIDEO_STATE_COMPLETED){if(a.log("ContentVideoExtension: resume content video"),_.play(),a.PLATFORM_AUTO_SEEK_AFTER_MIDROLL){var e=d.getParameter(a.PARAMETER_EXTENSION_CONTENT_VIDEO_AUTO_SEEK_BACK);null==e&&(e="true"),!1!==a.Util.str2bool(e)&&(h&&(_.removeEventListener("timeupdate",h,!1),h=null),h=function(){if(!(0>=_.currentTime||0>=_.seekable.length)&&(_.removeEventListener("timeupdate",h,!1),h=null,0<_.currentTime&&1>_.currentTime&&c>1)){a.log("ContentVideoExtension: seeking to original time",c);try{_.currentTime=c}catch(e){a.warn("ContentVideoExtension: seek error")}}},_.addEventListener("timeupdate",h,!1))}}else a.warn("ContentVideoExtension: video state is uninitialized or completed, skip resume.")}function n(e){switch(e.slot.getTimePositionClass()){case a.TIME_POSITION_CLASS_PREROLL:case a.TIME_POSITION_CLASS_POSTROLL:a.debug("ContentVideoExtension: store current content video src",_.src),E=_.src,u=_.controls,_.paused||_.pause()}}function r(e){switch(e=e.slot.getTimePositionClass()){case a.TIME_POSITION_CLASS_PREROLL:case a.TIME_POSITION_CLASS_POSTROLL:a.debug("ContentVideoExtension: restore content video src to",E),_.src!==E&&(_.src=E),_.controls=u,e===a.TIME_POSITION_CLASS_PREROLL&&_.load()}}function s(e,t){var i=d.getParameter(e);return null==i&&(i=t),a.Util.str2bool(i)}var o=!0,l=!0,d=e,_=e.getContentVideoElement(),c=0,h=null,E=null,u=null;return{start:function(){a.debug("ContentVideoExtension.start()"),o=s(a.PARAMETER_EXTENSION_CONTENT_VIDEO_RESPOND_PAUSE_RESUME,!0),l=s(a.PARAMETER_EXTENSION_CONTENT_VIDEO_AUTO_SOURCE_RESTORE,!0),o&&(a.debug("ContentVideoExtension: enabling content video pause resume request handling."),d.addEventListener(a.EVENT_CONTENT_VIDEO_PAUSE_REQUEST,t),d.addEventListener(a.EVENT_CONTENT_VIDEO_RESUME_REQUEST,i)),l&&(a.debug("ContentVideoExtension: enabling content video source management."),d.addEventListener(a.EVENT_SLOT_STARTED,n),d.addEventListener(a.EVENT_SLOT_ENDED,r))},dispose:function(){a.debug("ContentVideoExtension.dispose()"),d&&(d.removeEventListener(a.EVENT_CONTENT_VIDEO_PAUSE_REQUEST,t),d.removeEventListener(a.EVENT_CONTENT_VIDEO_RESUME_REQUEST,i),d.removeEventListener(a.EVENT_SLOT_STARTED,n),d.removeEventListener(a.EVENT_SLOT_ENDED,r),_&&h&&(_.removeEventListener("timeupdate",h,!1),h=null),d=null),_=null}}},a._instanceCounter=0,a._instanceQueue={},a.Context=function(e){this._adManager=e,this._adRequest=new a.AdRequest(this),this._adResponse=null,this._videoAsset=new a.VideoAsset(this),this._temporalSlotBase=null,this._videoDisplaySize={},this._globalLevelParameterDictionary={},this._overrideLevelParameterDictionary={},this._rendererManifest={},this._overriddenAdRenderers=[],this._eventDispatcher=new a.EventDispatcher,this._requestState=0,this._adControlExtension=new a.AdControlExtension(this),this._surveyExtension=new a.SurveyExtension(this),this._videoStateExtension=new a.VideoStateExtension(this),this._displayRefreshExtension=new a.DisplayRefreshExtension(this),this._totalSetDisplaySizeCount=this._autoSetDisplaySizeCount=0,this._instanceId=a._instanceCounter,a._instanceQueue["Context_"+a._instanceCounter]=this,a._instanceCounter++,this._contentVideoAttached=!1,this._currentContentPlayheadTime=0,this._ss_id="",this._ss_networkId=this._ss_pageViewRandom=0,this._ss_idType=a.ID_TYPE_CUSTOM,this._ss_fallbackId=0,this._va_location=this._va_networkId=this._va_duration=this._va_id="",this._va_autoPlayType=a.VIDEO_ASSET_AUTO_PLAY_TYPE_ATTENDED,this._va_viewRandom=this._va_fallbackId=0,this._va_idType=a.ID_TYPE_CUSTOM,this._isRefreshRequest=!1,this._refreshSlots=[]},a.Context.prototype={addRenderer:function(e,t,i,n,a,r,s){this._overriddenAdRenderers.push({url:e,baseUnit:t,
        contentType:i,creativeApi:r,slotType:n,soAdUnit:a,parameter:s})},setCapability:function(e,t){a.debug("Context.setCapability",e,t),this._adRequest.setCapability(e,t)},addKeyValue:function(e,t){a.debug("Context.addKeyValue",e,t),this._adRequest.addKeyValue(e,t)},setParameter:function(e,t,i){a.debug("Context.setParameter",e,t,i);var n=null;if(i===a.PARAMETER_LEVEL_GLOBAL)n=this._globalLevelParameterDictionary;else{if(i!==a.PARAMETER_LEVEL_OVERRIDE)return;n=this._overrideLevelParameterDictionary}null==t?delete n[e]:n[e]=t},getParameter:function(e){return e?this._overrideLevelParameterDictionary.hasOwnProperty(e)?this._overrideLevelParameterDictionary[e]:this._adResponse&&this._adResponse._profileParameters.hasOwnProperty(e)?this._adResponse._profileParameters[e]:this._globalLevelParameterDictionary.hasOwnProperty(e)?this._globalLevelParameterDictionary[e]:null:null},setVideoState:function(e){a.debug("Context.setVideoState",e),this._videoAsset.setVideoState(e)},registerVideoDisplayBase:function(e){if(a.debug("Context.registerVideoDisplayBase",e),e&&"string"==typeof e)if(this._temporalSlotBase&&this._temporalSlotBase.id===e){a.debug("Context.registerVideoDisplayBase","register the same display base, will only change size");var t=this._temporalSlotBase.getElementsByTagName("video");this._setVideoDisplaySizeByContentVideo(t[0])}else(this._temporalSlotBase=document.getElementById(e))?(t=this._temporalSlotBase.getElementsByTagName("video"),0===t.length?(a.warn("Context.registerVideoDisplayBase","could not get video element from",e),this._temporalSlotBase=null):(this._temporalSlotBase["_fw_contentVideo_"+this._instanceId]=t[0],this._setVideoDisplaySizeByContentVideo(t[0]),this._startContentVideoExtension())):a.warn("Context.registerVideoDisplayBase","could not get element",e);else a.warn("Context.registerVideoDisplayBase","id required")},setContentVideoElement:function(e){a.debug("Context.setContentVideoElement()"),e&&e.parentNode?(this._temporalSlotBase=e.parentNode,this._temporalSlotBase["_fw_contentVideo_"+this._instanceId]===e?(a.debug("Context.setContentVideoElement","set the same video in same div, will only change size"),this._setVideoDisplaySizeByContentVideo(e)):(this._temporalSlotBase["_fw_contentVideo_"+this._instanceId]=e,this._setVideoDisplaySizeByContentVideo(e),this._startContentVideoExtension())):a.warn("Context.setContentVideoElement","contentVideo and contentVideo.parentNode is required")},getContentVideoElement:function(){return this._temporalSlotBase?this._temporalSlotBase["_fw_contentVideo_"+this._instanceId]:(a.warn("SlotBase is null"),null)},setVideoDisplaySize:function(e,t,i,n,r){a.debug("Context.setVideoDisplaySize("+Array.prototype.slice.call(arguments).join(",")+")"),this._totalSetDisplaySizeCount++,this._videoDisplaySize={left:e,top:t,width:i,height:n,position:r};for(var s=this.getTemporalSlots(),o=0;o<s.length;++o){var l=s[o];if(l.getState()===a.MediaPlayingState.instance||l.getState()===a.MediaReplayingState.instance){(s=l.getCurrentAdInstance())&&((s=s.getRendererController().getRenderer())&&s.resize?s.resize():a.debug("renderer do not support resize"));break}}},getVideoDisplaySize:function(){function e(e){return e=parseInt(e,10),isNaN(e)&&(e=0),e}return this._videoDisplaySize.left=e(this._videoDisplaySize.left),this._videoDisplaySize.right=e(this._videoDisplaySize.right),this._videoDisplaySize.width=e(this._videoDisplaySize.width),this._videoDisplaySize.height=e(this._videoDisplaySize.height),this._videoDisplaySize},setVideoDisplayCompatibleSizes:function(e){a.debug("Context.setVideoDisplayCompatibleSizes",e),this._adRequest.setVideoDisplayCompatibleSizes(e)},setProfile:function(e){a.debug("Context.setProfile",e),this._adRequest.setProfile(e)},setVideoAsset:function(e,t,i,n,r,s,o,l){a.debug("Context.setVideoAsset("+Array.prototype.slice.call(arguments).join(",")+")"),this._videoAsset.setVideoAsset(e,t,i,n,r,s,o,l),this._va_id=e,this._va_duration=t,this._va_networkId=i,this._va_location=n,this._va_autoPlayType=r,this._va_viewRandom=s,this._va_idType=o,this._va_fallbackId=l},setSiteSection:function(e,t,i,n,r){a.debug("Context.setSiteSection("+Array.prototype.slice.call(arguments).join(",")+")"),this._adRequest.setSiteSection(e,t,i,n,r),this._ss_id=e,this._ss_networkId=t,this._ss_pageViewRandom=i,this._ss_idType=n,this._ss_fallbackId=r},setVisitor:function(e){a.debug("Context.setVisitor("+Array.prototype.slice.call(arguments).join(",")+")"),this._adRequest.setVisitor(e)},startSubsession:function(e){a.debug("Context.startSubsession("+e+")"),this._adRequest.setSubsessionToken(e)},addTemporalSlot:function(e,t,i,n,r){a.debug("Context.addTemporalSlot("+Array.prototype.slice.call(arguments).join(",")+")"),this._adRequest.addTemporalSlot(e,t,i,n,r)},getTemporalSlots:function(){return this._adResponse?this._adResponse._temporalSlots.slice():[]},getSlotByCustomId:function(e){return this._adResponse?this._adResponse.getSlotByCustomId(e):null},getSlotsByTimePositionClass:function(e){var t=[];if(this._adResponse){for(var i=0;i<this._adResponse._temporalSlots.length;i++)this._adResponse._temporalSlots[i].getTimePositionClass()===e&&t.push(this._adResponse._temporalSlots[i]);for(i=0;i<this._adResponse._siteSectionNonTemporalSlots.length;i++)this._adResponse._siteSectionNonTemporalSlots[i].getTimePositionClass()===e&&t.push(this._adResponse._siteSectionNonTemporalSlots[i]);for(i=0;i<this._adResponse._videoPlayerNonTemporalSlots.length;i++)this._adResponse._videoPlayerNonTemporalSlots[i].getTimePositionClass()===e&&t.push(this._adResponse._videoPlayerNonTemporalSlots[i])}return t},submitRequest:function(e){if(a.debug("Context.submitRequest",e),this._requestState)a.warn("Context.submitRequest: request already submitted");else if(a.Util.isBlank(this._adManager._serverURL))a.warn("Context.submitRequest: serverURL is not set");else{if(this._requestState=1,this._adRequest.scanPageSlots(),this._isRefreshRequest){for(var t={},i=[],n=0;n<this._refreshSlots.length;n++){var r=this._refreshSlots[n];if(void 0!=this._adRequest._slotScanner._slots[r]){t[r]=this._adRequest._slotScanner._slots[r];for(var s=t[r].split("&"),o=0;o<s.length;o++)-1!==s[o].search("flag")&&(s[o]="flag=-cmpn");t[r]=s.join("&")}for(o=0;o<this._adRequest._slotScanner._knownSlots.length;o++)this._adRequest._slotScanner._knownSlots[o].id==r&&(s=this._adRequest._slotScanner._knownSlots[o],s.acceptCompanion=!1,s.initialAdOption=a.SLOT_OPTION_INITIAL_AD_STAND_ALONE,i.push(s))}this._adRequest._slotScanner._slots=t,this._adRequest._slotScanner._knownSlots=i}this.getParameter(a.PARAMETER_ENABLE_FORM_TRANSPORT)&&(a.debug("Context.submitRequest: enabling Safari transport mechanism globally"),a.PLATFORM_SEND_REQUEST_BY_FORM=!0),t=this._adManager._serverURL,".js"!==t.substring(t.length-3,t.length)&&(t=this._adRequest.generateTypeBRequestUrl());var l=this;("number"!=typeof e||0>=e||!e)&&(e=5),setTimeout(function(){1===l._requestState&&(a.warn("Context.submitRequest: request timeout"),l.requestComplete(null))},1e3*e),a.log("Context.submitRequest: sending request to",t,"timeout",e),a.PLATFORM_SEND_REQUEST_BY_FORM?(a.debug("Context.submitRequest:","use json2"),a.Util.pingURLWithForm(t,this._instanceId,!0),l._onMessagePosted=function(e){"object"==typeof e.data&&e.data.hasOwnProperty("cbfn")&&-1<e.data.cbfn.indexOf("['Context_"+l._instanceId+"']")&&l.requestComplete(e.data.response)},window.addEventListener("message",l._onMessagePosted,!1)):a.Util.pingURLWithScript(t)}},requestComplete:function(e){if(1!==this._requestState)a.warn("ad request complete after timeout"),this.dispatchEvent(a.EVENT_REQUEST_COMPLETE,{success:!1});else{if(this._requestState=2,a.debug("Context.requestComplete"),a.PLATFORM_SEND_REQUEST_BY_FORM){window.removeEventListener("message",this._onMessagePosted,!1);var t=document.getElementById("_fw_request_iframe_"+this._instanceId);document.body.removeChild(t)}if(null!==e){for(this._adControlExtension.start(),this._surveyExtension.start(),this._displayRefreshExtension.start(),a._instanceQueue["Context_"+this._instanceId]=null,this._adResponse=new a.AdResponse(this),this._adResponse.parse(e,this._temporalSlotBase),a.log("Ad request succeeded"),this._videoStateExtension.start(),this.dispatchEvent(a.EVENT_REQUEST_COMPLETE,{success:!0,response:e}),t=this._adResponse.getSiteSectionNonTemporalSlots(),e=0;e<t.length;++e)a.log("Auto play site section nonTemporal slots"),t[e].play();for(t=this._adResponse.getVideoPlayerNonTemporalSlots(),e=0;e<t.length;++e)a.log("Auto play video player nonTemporal slots"),t[e].play()}else a.warn("Ad request failed"),this.dispatchEvent(a.EVENT_REQUEST_COMPLETE,{success:!1})}},addEventListener:function(e,t){a.debug("Context.addEventListener",e),this._eventDispatcher.addEventListener(e,t)},removeEventListener:function(e,t){a.debug("Context.removeEventListener",e),this._eventDispatcher.removeEventListener(e,t)},dispatchEvent:function(e,t){if(a.log("Context.dispatchEvent",e),e===a.EVENT_SLOT_STARTED){var i=t.slot.getTimePositionClass();i!==a.TIME_POSITION_CLASS_PREROLL&&i!==a.TIME_POSITION_CLASS_MIDROLL&&i!==a.TIME_POSITION_CLASS_POSTROLL||(this._contentVideoAttached=!0,this._markCurrentContentPlayheadTime())}else e===a.EVENT_SLOT_ENDED&&(i=t.slot.getTimePositionClass(),i===a.TIME_POSITION_CLASS_PREROLL||i===a.TIME_POSITION_CLASS_MIDROLL||i===a.TIME_POSITION_CLASS_POSTROLL)&&(this._contentVideoAttached=!1);t=t||{},t.type=e,t.target=this,this._eventDispatcher.dispatchEvent(t)},dispose:function(){if(a.debug("Context.dispose"),this.setVideoState(a.VIDEO_STATE_STOPPED),this._adResponse){if(this._contentVideoExtension&&(this._contentVideoExtension.dispose(),this._contentVideoExtension=null),this._adControlExtension.dispose(),this._surveyExtension.dispose(),this._displayRefreshExtension.dispose(),this._videoStateExtension.dispose(),this._temporalSlotBase){for(var e=0,t=this._adResponse._temporalSlots||[];e<t.length;++e){var i=t[e];if(i._onContentVideoTimeUpdate){var n=this._temporalSlotBase["_fw_contentVideo_"+this._instanceId];n&&n.removeEventListener("timeupdate",i._onContentVideoTimeUpdate,!1),i._onContentVideoTimeUpdate=null}}this._temporalSlotBase["_fw_contentVideo_"+this._instanceId]=null}this._isRefreshRequest=!1,this._refreshSlots=[]}},_markCurrentContentPlayheadTime:function(){var e=this._temporalSlotBase["_fw_contentVideo_"+this._instanceId].currentTime;e>0&&(this._currentContentPlayheadTime=e)},_getContentPlayheadTime:function(){var e=-1;return this._contentVideoAttached||(e=this._temporalSlotBase["_fw_contentVideo_"+this._instanceId].currentTime),e>0?e:this._currentContentPlayheadTime},_setVideoDisplaySizeByContentVideo:function(e){if(this._autoSetDisplaySizeCount===this._totalSetDisplaySizeCount){var t=e.style.left,i=e.style.top,n=e.offsetWidth?e.offsetWidth:e.style.pixelWidth,a=e.offsetHeight?e.offsetHeight:e.style.pixelHeight,e=e.style.position;this._autoSetDisplaySizeCount++,this.setVideoDisplaySize(t,i,n,a,e)}},_startContentVideoExtension:function(){var e=this.getParameter(a.PARAMETER_EXTENSION_CONTENT_VIDEO_ENABLED);null==e&&(e="true"),!1===a.Util.str2bool(e)?a.log("Content Video Extension disabled"):this._temporalSlotBase?(this._contentVideoExtension&&this._contentVideoExtension.dispose(),this._contentVideoExtension=new a.ContentVideoExtension(this),this._contentVideoExtension.start()):a.warn("SlotBase is null")},_replacePageSlot:function(a,c){navigator.userAgent.match(/MSIE/);var d=null!=navigator.userAgent.match(/Firefox/),f=function(){window._fw_admanager&&1==window._fw_admanager.enableDebug&&window.console&&window.console.log&&(window.console.log.apply?window.console.log.apply(window.console,arguments):window.console.log(arguments[0],arguments[1],arguments[2],arguments[3]))};f("fw replace %s",a);var g,h,i;try{g=document.getElementById(a)?document:parent.document.getElementById(a)?parent.document:null,h=document.getElementById(a)?"window":parent.document.getElementById(a)?"parent":null}catch(k){h=g=null}if(!g)for(var j=0;j<window.frames.length;j++)try{window.frames[j].document.getElementById(a)&&(g=window.frames[j].document,h="window.frames["+j+"]")}catch(m){f(m)}if(h&&(i=h+".document"),f("fw replacing slot %s in frame %s",a,i),!g)throw"Slot element not found: "+a;j=g.getElementById("_fw_container_"+a),j.innerHTML=c;for(var j=j.getElementsByTagName("script"),l=g.getElementsByTagName("head")[0],o=0;o<j.length;++o)if(d||j[o].src){var n=g.createElement("script");j[o].charset&&(n.charset=j[o].charset),j[o].src&&(n.src=j[o].src),j[o].innerHTML&&(n.innerHTML=j[o].innerHTML),n.onload=n.onreadystatechange=function(){(!this.readyState||"loaded"==this.readyState||"complete"==this.readyState)&&l.removeChild(n)},f("fw append script for %s",a),l.appendChild(n)}else n=j[o].innerHTML,n=n.replace(/var fw_scope = document;/,"var fw_scope="+i+";"),n=n.replace(/var fw_scope_window = window;/,"var fw_scope_window="+h+";"),f("fw eval in %s for %s, %s",i,a,n),eval(n);f("fw finish replace %s",a)}},a.Context.prototype.constructor=a.Context,a.DisplayRefreshExtension=function(e){this.REFRESH_TYPE_NONE="refresh_none",this.REFRESH_TYPE_AD="refresh_ad",this.REFRESH_TYPE_TIME="refresh_time",this.REPLACE_TYPE_NONE="replace_none",this.REPLACE_TYPE_BLANK="replace_blank",this.REPLACE_TYPE_AD="replace_ad",this._context=e,this._subContext=null,this._displaySlots=[],this._companionSlots=[],this._keyValues=[],this._globalParameters=[],this._overrideParameters=[],this._refreshType=this.REFRESH_TYPE_NONE,this._replaceType=this.REPLACE_TYPE_NONE,this._refreshInterval=0,this._refreshTimer=null,this._firstTemporalAd=!0,this._REQUEST_TIME_OUT=5,this.init()},a.DisplayRefreshExtension.prototype={start:function(){a.debug("DisplayRefreshExtension.start()")},init:function(){a.debug("DisplayRefreshExtension.init()"),this._onRendererEvent=a.Util.bind(this,function(e){a.debug("DisplayRefreshExtension._onRendererEvent()"),e.subType===a.EVENT_AD_IMPRESSION&&this._onAdStarted(e)}),this._onSlotEnded=a.Util.bind(this,function(e){var t=e.slot.getTimePositionClass(),e=e.slot;if(a.debug("DisplayRefreshExtension._onSlotEnded()",e,t),null!=e&&t!=a.TIME_POSITION_CLASS_DISPLAY&&0!=e.getAdInstances().length)if(this._refreshType==this.REFRESH_TYPE_AD)this._resetSubContext(),this._refreshSlots(this._displaySlots);else if(this._refreshType==this.REFRESH_TYPE_TIME){this._resetSubContext(),this._refreshSlots(this._displaySlots);var i=this;this._refreshTimer=setInterval(function(){a.debug("DisplayRefreshExtension._onTimeout()"),i._resetSubContext(),i._refreshSlots(i._displaySlots)},1e3*this._refreshInterval)}}),this._onRequestComplete=a.Util.bind(this,function(e){if(a.debug("DisplayRefreshExtension._onRequestComplete()"),e.success){switch(this._context.getParameter("refreshType")){case"ad":this._refreshType=this.REFRESH_TYPE_AD;break;case"time":this._refreshInterval=this._context.getParameter("refreshInterval"),this._refreshType=0<this._refreshInterval?this.REFRESH_TYPE_TIME:this.REFRESH_TYPE_NONE;break;default:this._refreshType=this.REFRESH_TYPE_NONE}switch(this._context.getParameter("replaceMissingCompanion")){case"blank":this._replaceType=this.REPLACE_TYPE_BLANK;break;case"ad":this._replaceType=this.REPLACE_TYPE_AD;break;default:this._replaceType=this.REPLACE_TYPE_NONE}if(this._refreshType!=this.REFRESH_TYPE_NONE||this._replaceType!=this.REPLACE_TYPE_NONE){if(this._displaySlots=this._context.getSlotsByTimePositionClass(a.TIME_POSITION_CLASS_DISPLAY),this._companionSlots=this._displaySlots.filter(function(e){return e.getAcceptCompanion()}),this._keyValues=this._context._adRequest._keyValues,this._globalParameters=this._context._globalLevelParameterDictionary,this._overrideParameters=this._context._overrideLevelParameterDictionary,this._firstTemporalAd=!0,this._context.addEventListener(a.EVENT_AD,this._onRendererEvent),this._context.addEventListener(a.EVENT_SLOT_ENDED,this._onSlotEnded),this._refreshType==this.REFRESH_TYPE_TIME){var t=this;this._refreshTimer=setInterval(function(){a.debug("DisplayRefreshExtension._onTimeout()"),t._resetSubContext(),t._refreshSlots(t._displaySlots)},1e3*this._refreshInterval)}}else this._refreshTimer&&clearInterval(this._refreshTimer)}else a.debug("DisplayRefreshExtension: request complete failed")}),this._context.addEventListener(a.EVENT_REQUEST_COMPLETE,this._onRequestComplete)},_resetSubContext:function(){a.debug("DisplayRefreshExtension._resetSubContext()"),this._subContext=this._context._adManager.cloneContext(this._context),this._subContext._displayRefreshExtension.dispose(),this._subContext._videoStateExtension.dispose(),this._subContext.setCapability(a.CAPABILITY_SLOT_TEMPLATE,a.CAPABILITY_STATUS_OFF),this._subContext.setCapability(a.CAPABILITY_DISPLAY_REFRESH,a.CAPABILITY_STATUS_ON),this._playRefreshedSlots=a.Util.bind(this,function(e){if(a.debug("DisplayRefreshExtension._playRefreshedSlots()"),e.success)for(var e=this._subContext.getSlotsByTimePositionClass(a.TIME_POSITION_CLASS_DISPLAY),t=0;t<e.length;t++)e[t].play();else a.debug("DisplayRefreshExtension._playRefreshedSlots(): subContext refresh request error:",e)}),this._subContext.addEventListener(a.EVENT_REQUEST_COMPLETE,this._playRefreshedSlots);for(var e=this._subContext._adRequest._keyValues,t=0;t<this._keyValues.length;t++)0>e.indexOf(this._keyValues[t])&&e.push(this._keyValues[t]);for(var i in this._globalParameters)this._globalParameters.hasOwnProperty(i)&&this._subContext.setParameter(i,this._globalParameters[i],a.PARAMETER_LEVEL_GLOBAL);for(i in this._overrideParameters)this._overrideParameters.hasOwnProperty(i)&&this._subContext.setParameter(i,this._overrideParameters[i],a.PARAMETER_LEVEL_OVERRIDE)},_onAdStarted:function(e){a.debug("DisplayRefreshExtension._onAdStarted()");var t=e.adInstance.getSlot();if(a.debug("DisplayRefreshExtension._onAdStarted(): slot: ",t," | timePositionClass:",t.getTimePositionClass()),null!=t&&t.getTimePositionClass()!=a.TIME_POSITION_CLASS_DISPLAY&&(this._resetSubContext(),this._refreshTimer&&clearInterval(this._refreshTimer),this._replaceType!=this.REPLACE_TYPE_NONE))for(var e=e.adInstance,t=t.getAdInstances(),i=0;i<t.length;i++)e.getAdId()===t[i].getAdId()&&this._checkMissingCompanionForAd(e)},_checkMissingCompanionForAd:function(e){a.debug("DisplayRefreshExtension._checkMissingCompanionForAd()",e);for(var t=this._companionSlots.slice(),e=e.getCompanionAdInstances(),i=0;i<e.length;i++){var n=t.indexOf(e[i].getSlot());n>-1&&t.splice(n,1)}if(this._firstTemporalAd&&(this._firstTemporalAd=!1,t=t.filter(function(e){if(e.getInitialAdOption()!=a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_ONLY&&e.getInitialAdOption()!=a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_OR_STAND_ALONE&&e.getInitialAdOption()!=a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_THEN_STAND_ALONE&&e.getInitialAdOption()!=a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_OR_NO_STAND_ALONE&&e.getInitialAdOption()!=a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_OR_NO_STAND_ALONE_IF_TEMPORAL)return a.debug("DisplayRefreshExtension._checkMissingCompanionForAd(): firstCompanionAsInitial false in slot ",e.getCustomId()),!0;for(var t=e.getAdInstances(),i=0;i<t.length;i++)if(!t[i].isPlaceholder())return a.debug("DisplayRefreshExtension._checkMissingCompanionForAd(): first companion found in slot ",e.getCustomId()),!1;return a.debug("DisplayRefreshExtension._checkMissingCompanionForAd(): firstCompanionAsInitial true, no ad in slot ",e.getCustomId()),!0})),this._replaceType==this.REPLACE_TYPE_BLANK)for(i=0;i<t.length;i++)t[i].stop(),this._subContext._replacePageSlot(t[i].getCustomId(),"");else this._replaceType==this.REPLACE_TYPE_AD&&this._refreshSlots(t)},_refreshSlots:function(e){if(a.debug("DisplayRefreshExtension._refreshSlots()",e),null!=e&&0!=e.length){for(var t=0;t<e.length;t++)e[t].stop(),this._subContext._refreshSlots.push(e[t].getCustomId());this._subContext._isRefreshRequest=!0,this._subContext.submitRequest(this._REQUEST_TIME_OUT)}},dispose:function(){a.debug("DisplayRefreshExtension.dispose()"),this._context&&(this._context.removeEventListener(a.EVENT_REQUEST_COMPLETE,this._onRequestComplete),this._context.removeEventListener(a.EVENT_SLOT_ENDED,this._onSlotEnded),this._context.removeEventListener(a.EVENT_AD,this._onRendererEvent),this._context=null),this._subContext&&(this._subContext.removeEventListener(a.EVENT_REQUEST_COMPLETE,this._playRefreshedSlots),this._subContext=null),this._displaySlots=[],this._companionSlots=[],this._keyValues=[],this._globalParameters=[],this._overrideParameters=[],this._refreshType=this.REFRESH_TYPE_NONE,this._replaceType=this.REPLACE_TYPE_NONE,this._refreshInterval=0,this._refreshTimer&&clearInterval(this._refreshTimer),this._refreshTimer=null,this._firstTemporalAd=!0}},a.DisplayRefreshExtension.prototype.constructor=a.DisplayRefreshExtension,a.EventCallback=function(e){this._url=this._name=this._type=null,this._showBrowser=!1,this._trackingUrls=[],this._adInstance=this._slot=null,this._context=e},a.EventCallback.prototype={},a.EventCallback.prototype.constructor=a.EventCallback,a.EventCallback.getEventCallback=function(e,t,i){for(var n,r=0;r<e.length;r++)if(n=e[r],n._name===t&&n._type===i)return n;for(r=0;r<e.length;r++)if(n=e[r],n._type===a.EVENT_TYPE_GENERIC)return(t=a.EventCallback.newEventCallback(n._context,t,i))&&(t._url=n._url,t._slot=n._slot,t._adInstance=n._adInstance,e.push(t)),t;return null},a.EventCallback.newEventCallback=function(e,t,i){var n=null;if(i===a.EVENT_TYPE_GENERIC)n=new a.EventCallback(e);else if(i===a.EVENT_TYPE_ERROR)n=new a.ErrorEventCallback(e);else if(i===a.EVENT_TYPE_CLICK)n=new a.AdClickEventCallback(e);else if(i===a.EVENT_TYPE_STANDARD)n=new a.AdStandardEventCallback(e);else if(t===a.EVENT_SLOT_IMPRESSION||t===a.EVENT_SLOT_END)n=new a.SlotImpressionEventCallback(e);else if(t===a.EVENT_AD_IMPRESSION||t===a.EVENT_AD_IMPRESSION_END)n=new a.AdImpressionEventCallback(e);else if(t===a.EVENT_VIDEO_VIEW)n=new a.VideoViewEventCallback(e);else if(t===a.EVENT_RESELLER_NO_AD)n=new a.ResellerNoAdEventCallback(e);else{if(t!==a.EVENT_AD_FIRST_QUARTILE&&t!==a.EVENT_AD_MIDPOINT&&t!==a.EVENT_AD_THIRD_QUARTILE&&t!==a.EVENT_AD_COMPLETE)return null;n=new a.AdQuartileEventCallback(e)}return n._name=t,n._type=i,n},a.EventCallback.getShortType=function(e){var t="";switch(e){case a.EVENT_TYPE_IMPRESSION:t=a.SHORT_EVENT_TYPE_IMPRESSION;break;case a.EVENT_TYPE_CLICK:t=a.SHORT_EVENT_TYPE_CLICK;break;case a.EVENT_TYPE_STANDARD:t=a.SHORT_EVENT_TYPE_STANDARD;break;case a.EVENT_TYPE_ERROR:t=a.SHORT_EVENT_TYPE_ERROR}return t},a.Util.mixin(a.EventCallback.prototype,{parse:function(e){if(e){this._usage=e.use,this._type=e.type,this._name=e.name,this._url=e.url,this._showBrowser=e.showBrowser,this._trackingUrls=[];for(var t=0,e=e.trackingUrls||[];t<e.length;t++)this._trackingUrls.push(e[t].value)}},copy:function(){var e=new this.constructor(this._context);return e._type=this._type,e._name=this._name,e._url=this._url,e._showBrowser=this._showBrowser,e._trackingUrls=this._trackingUrls.slice(),e._slot=this._slot,e._adInstance=this._adInstance,e},getUrl:function(e){var t=this._replaceMacrosInUrl(this._url);return this._name===a.EVENT_AD_MEASUREMENT?(t=a.Util.setParameterInURL(t,a.URL_PARAMETER_KEY_ET,a.SHORT_EVENT_TYPE_IMPRESSION),t=a.Util.setParameterInURL(t,a.URL_PARAMETER_KEY_CONCRETE_EVENT_ID,e[a.INFO_KEY_CONCRETE_EVENT_ID])):t=a.Util.setParameterInURL(t,a.URL_PARAMETER_KEY_ET,a.EventCallback.getShortType(this._type)),t=a.Util.setParameterInURL(t,a.URL_PARAMETER_KEY_CN,this._name),this._adInstance&&0<this._adInstance._creativeRenditionId&&(t=a.Util.setParameterInURL(t,a.URL_PARAMETER_KEY_CREATIVE_RENDITION_ID,this._adInstance._creativeRenditionId)),t},getTrackingUrls:function(){var e=this._trackingUrls;if(this._adInstance){var t=this._type;t===a.EVENT_TYPE_CLICK&&(t=a.EVENT_TYPE_CLICK_TRACKING),e=e.concat(this._adInstance.getExternalEventCallbackUrls(this._name,t))}for(var t=[],i=0;i<e.length;i++){var n=a.Util.trim(this._replaceMacrosInUrl(e[i]));a.Util.isBlank(n)||t.push(n)}return t},process:function(e){e=e||{},this._processTrackingUrls(),a.Util.pingURL(this.getUrl(e))},_processTrackingUrls:function(){this._shouldSkipSendingTrackingAndExternalUrls()||a.Util.pingURLs(this.getTrackingUrls())},_shouldSkipSendingTrackingAndExternalUrls:function(){return!1},_needEmptyCT:function(e){var t=!1;return e&&!0===e[a.INFO_KEY_NEED_EMPTY_CT]&&(t=!0),t},_getAdPlayheadTime:function(){var e=-1;return this._adInstance&&(e=this._adInstance.getPlayheadTime()),e},_getCreativeAssetLocation:function(){var e=null;return this._adInstance&&this._adInstance.getActiveCreativeRendition()&&this._adInstance.getActiveCreativeRendition().getPrimaryCreativeRenditionAsset()&&(e=this._adInstance.getActiveCreativeRendition().getPrimaryCreativeRenditionAsset().getUrl()),e},_getParameter:function(e){var t=null;return t=this._adInstance?this._adInstance._rendererController.getParameter(e):this._slot?this._slot.getParameter(e):this._context.getParameter(e)},_replaceMacrosInUrl:function(e){if(a.Util.isBlank(e))return e;var e=e.replace(/#(ce?)\{([^\}]+)\}/g,a.Util.bind(this,function(e,t,i){switch(e="ce"===t,t=null,i){case"ad.playheadTime":i=this._getAdPlayheadTime(),t=i>=0?Math.round(i)+"":"";break;case"content.playheadTime":i=this._context._getContentPlayheadTime(),t=i>=0?Math.round(i)+"":"";break;case"creative.assetLocation":t=this._getCreativeAssetLocation();break;default:0===i.indexOf("parameter.")&&(t=this._getParameter(i.substr(10)))}return a.Util.isBlank(t)&&(t=""),e?encodeURIComponent(t):t})),t="";try{t=a.Util.getParameterInURL(e,a.URL_PARAMETER_KEY_CR)}catch(i){return a.warn(i),e}return a.Util.isBlank(t)||(e=a.Util.setParameterInURL(e,a.URL_PARAMETER_KEY_CR,this._replaceMacrosInUrl(t))),e}}),a.AdClickEventCallback=function(e){a.EventCallback.call(this,e)},a.AdClickEventCallback.prototype=new a.EventCallback,a.AdClickEventCallback.prototype.constructor=a.AdClickEventCallback,a.Util.mixin(a.AdClickEventCallback.prototype,{getUrl:function(e){var t=a.EventCallback.prototype.getUrl.call(this,e);return e[a.INFO_KEY_URL]&&(a.Util.isParameterInURL(t,a.URL_PARAMETER_KEY_CR)||(t=t+"&"+a.URL_PARAMETER_KEY_CR+"="),t=a.Util.setParameterInURL(t,a.URL_PARAMETER_KEY_CR,e[a.INFO_KEY_URL])),t},process:function(e){var e=e||{},t=this.getUrl(e),i=!0===this._showBrowser,i=e.hasOwnProperty(a.INFO_KEY_SHOW_BROWSER)?!0===e[a.INFO_KEY_SHOW_BROWSER]:i;e[a.INFO_KEY_URL]&&(i=!0),i&&!a.Util.isBlank(t)?(window.open(t),this._processTrackingUrls()):a.EventCallback.prototype.process.call(this,e)}}),a.AdImpressionEventCallback=function(e){a.EventCallback.call(this,e)},a.AdImpressionEventCallback.prototype=new a.EventCallback,a.AdImpressionEventCallback.prototype.constructor=a.AdImpressionEventCallback,a.Util.mixin(a.AdImpressionEventCallback.prototype,{_shouldSkipSendingTrackingAndExternalUrls:function(){return this._getInitValue()!==a.INIT_VALUE_ONE},_getInitValue:function(){return this._adInstance.getSlot().isPauseSlot()||!this._processed?a.INIT_VALUE_ONE:a.INIT_VALUE_TWO},getUrl:function(e){var t=a.EventCallback.prototype.getUrl.call(this,e),t=a.Util.setParameterInURL(t,a.URL_PARAMETER_KEY_METR,this._adInstance._metr);return this._name!==a.EVENT_AD_IMPRESSION&&(t=a.Util.setParameterInURL(t,a.URL_PARAMETER_KEY_CT,this._needEmptyCT(e)?"":this._adInstance._timer.tick())),t=a.Util.setParameterInURL(t,a.URL_PARAMETER_KEY_INIT,this._getInitValue())},process:function(e){a.MODULE_TYPE_TRANSLATOR!==this._adInstance.getRendererController().getRenderer().info()[a.INFO_KEY_MODULE_TYPE]&&(a.EventCallback.prototype.process.call(this,e),this._processed=!0)}}),a.AdQuartileEventCallback=function(e){a.EventCallback.call(this,e)},a.AdQuartileEventCallback.prototype=new a.EventCallback,a.AdQuartileEventCallback.prototype.constructor=a.AdQuartileEventCallback,a.Util.mixin(a.AdQuartileEventCallback.prototype,{getUrl:function(e){var t=a.EventCallback.prototype.getUrl.call(this,e),t=a.Util.setParameterInURL(t,a.URL_PARAMETER_KEY_METR,this._adInstance._metr);return t=a.Util.setParameterInURL(t,a.URL_PARAMETER_KEY_CT,this._needEmptyCT(e)?"":this._adInstance._timer.tick())},process:function(e){this._processed||(a.EventCallback.prototype.process.call(this,e),this._processed=!0)}}),a.AdStandardEventCallback=function(e){a.EventCallback.call(this,e)},a.AdStandardEventCallback.prototype=new a.EventCallback,a.AdStandardEventCallback.prototype.constructor=a.AdStandardEventCallback,a.ErrorEventCallback=function(e){a.EventCallback.call(this,e)},a.ErrorEventCallback.prototype=new a.EventCallback,a.ErrorEventCallback.prototype.constructor=a.ErrorEventCallback,a.Util.mixin(a.ErrorEventCallback.prototype,{getUrl:function(e){var t=a.EventCallback.prototype.getUrl.call(this,e),i=e[a.INFO_KEY_ERROR_CODE];i||(i=a.ERROR_UNKNOWN);var n=e[a.INFO_KEY_ERROR_INFO];return n||(n=""),(e=e[a.INFO_KEY_ERROR_MODULE])||(e=""),t=a.Util.setParameterInURL(t,a.URL_PARAMETER_KEY_CN,i),t=a.Util.setParameterInURL(t,a.URL_PARAMETER_KEY_KEY_VALUE,encodeURIComponent(a.URL_PARAMETER_KEY_ERROR_MODULE)+"="+encodeURIComponent(e)+"&"+encodeURIComponent(a.URL_PARAMETER_KEY_ERROR_INFO)+"="+a.PLATFORM_ID+"/"+encodeURIComponent(n))}}),a.ResellerNoAdEventCallback=function(e){a.EventCallback.call(this,e)},a.ResellerNoAdEventCallback.prototype=new a.EventCallback,a.ResellerNoAdEventCallback.prototype.constructor=a.ResellerNoAdEventCallback,a.Util.mixin(a.ResellerNoAdEventCallback.prototype,{}),a.SlotImpressionEventCallback=function(e){a.EventCallback.call(this,e)},a.SlotImpressionEventCallback.prototype=new a.EventCallback,a.SlotImpressionEventCallback.prototype.constructor=a.SlotImpressionEventCallback,a.Util.mixin(a.SlotImpressionEventCallback.prototype,{_shouldSkipSendingTrackingAndExternalUrls:function(){return this._getInitValue()!==a.INIT_VALUE_ONE},_getInitValue:function(){return this._slot.isPauseSlot()||!this._processed?a.INIT_VALUE_ONE:a.INIT_VALUE_TWO},getUrl:function(e){return e=a.EventCallback.prototype.getUrl.call(this,e),e=a.Util.setParameterInURL(e,a.URL_PARAMETER_KEY_INIT,this._getInitValue())},process:function(e){a.EventCallback.prototype.process.call(this,e),this._processed=!0}}),a.VideoViewEventCallback=function(e){a.EventCallback.call(this,e)},a.VideoViewEventCallback.prototype=new a.EventCallback,a.VideoViewEventCallback.prototype.constructor=a.VideoViewEventCallback,a.Util.mixin(a.VideoViewEventCallback.prototype,{_shouldSkipSendingTrackingAndExternalUrls:function(){return this._getInitValue()!==a.INIT_VALUE_ONE},_getInitValue:function(){return this._processed?a.INIT_VALUE_ZERO:a.INIT_VALUE_ONE},_getCTValue:function(){return this._context._videoAsset.getPlayheadTime()},getUrl:function(e){return e=a.EventCallback.prototype.getUrl.call(this,e),e=a.Util.setParameterInURL(e,a.URL_PARAMETER_KEY_INIT,this._getInitValue()),e=a.Util.setParameterInURL(e,a.URL_PARAMETER_KEY_CT,this._getCTValue())},_shouldSkipSendingTrackingAndExternalUrls:function(){return this._processed},process:function(e){a.EventCallback.prototype.process.call(this,e),this._processed=!0}}),a.EventDispatcher=function(){this._listeners={}},a.EventDispatcher.prototype={addEventListener:function(e,t){"undefined"==typeof this._listeners[e]&&(this._listeners[e]=[]),this._listeners[e].push(t)},dispatchEvent:function(e){if("string"==typeof e&&(e={type:e}),e.target||(e.target=this),e.type&&this._listeners[e.type]instanceof Array)for(var t=this._listeners[e.type],i=0,n=t.length;n>i;i++)try{t[i]&&t[i].call(this,e)}catch(r){a.warn("EventDispatcher.dispatchEvent",e.type,r)}},removeEventListener:function(e,t){if(this._listeners[e]instanceof Array){var i=this._listeners[e];if(null==t)this._listeners[e]=[];else for(var n=0,a=i.length;a>n;n++)if(i[n]===t){i.splice(n,1);break}}}},a.EventDispatcher.prototype.constructor=a.EventDispatcher,a.Hash=function(){this._keys=[],this._dictionary={}},a.Hash.prototype={},a.Hash.prototype.constructor=a.Hash,a.Util.mixin(a.Hash.prototype,{setKeyValue:function(e,t,i){e&&(this._dictionary.hasOwnProperty(e)||(0===i?this._keys.unshift(e):this._keys.push(e)),this._dictionary[e]=t)},move:function(e){for(var t=0;t<this._keys.length;t++){var i=this._keys[t];if(i===e){this._keys.splice(t,1),this._keys.push(i);
        break}}},getValue:function(e){return this._dictionary[e]}}),a.HTMLAdGenerator={log:function(e){a.log("HTMLAdGenerator	"+e)},getExtension:function(e){return e&&(e=e.match(/^[^?]+\/[^?.]*(\.\w+)+/))?e[e.length-1].slice(1):""},generateAd:function(e,t,i,n,r,s,o){a.HTMLAdGenerator.log("generatorAd("+[].slice.call(arguments,0).join(",")+")");var l=s,d=!1;switch(null==l&&(d=!0,l=a.HTMLAdGenerator.getExtension(e).toLowerCase()),l){case"jpeg":case"jpg":case"gif":case"png":case"image/jpeg":case"image/jpg":case"image/gif":case"image/png":case"image/bmp":l=a.HTMLAdGenerator.generateImageHTML(e,t);break;case"swf":case"application/x-shockwave-flash":l=a.HTMLAdGenerator.generateFlashHTML(e,t,i,n,r);break;case"script":case"js":case"text/javascript":case"text/js_ref":case"application/x-javascript":l=a.HTMLAdGenerator.generateScriptHTML(e,i,n,r);break;case"iframe":case"html":case"htm":case"text/html":case"text/html_doc_ref":case"text/html_lit_nowrapper":case"text/html_doc_lit_mobile":l=a.HTMLAdGenerator.generateIFrameHTML(e,t,i,n,r);break;default:l=d?a.HTMLAdGenerator.generateIFrameHTML(e,t,i,n,r):a.HTMLAdGenerator.generateAd(e,t,i,n,r,null,o)}return"text/html_doc_lit_mobile"===o?a.HTMLAdGenerator.htmlLitToHTMLDocLitMobile(l):l},generateImageHTML:function(e,t){a.HTMLAdGenerator.log("generateImageHTML");return t?'<a href="'+t+'" target="_blank"><img src="'+e+'" border="0" /></a>':'<img src="'+e+'" border="0" />'},generateFlashHTML:function(e,t,i,n,r){a.HTMLAdGenerator.log("generateFlashHTML");var s=e;return t&&0<t.length&&(s+=-1===e.indexOf("?")?"?":"&",s+="clickTag="+encodeURIComponent(t)),'<OBJECT classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"WIDTH="'+n+'" HEIGHT="'+r+'" id="'+i+'_external_ad">'+('<PARAM NAME=movie VALUE="'+s+'"/>')+'<PARAM NAME=quality VALUE=high/><PARAM NAME=bgcolor VALUE=#FFFFFF/><PARAM NAME="allowScriptAccess" VALUE="always"/><PARAM NAME="loop" VALUE="true"/>'+('<EMBED src="'+s+'" ')+('quality=high bgcolor=#FFFFFF WIDTH="'+n+'" HEIGHT="'+r+'"NAME="'+i+'_external_video" ALIGN="" TYPE="application/x-shockwave-flash"PLUGINSPAGE="http://www.macromedia.com/go/getflashplayer"></EMBED></OBJECT>')},generateIFrameHTML:function(e,t,i,n,r){return a.HTMLAdGenerator.log("generateIFrameHTML"),'<iframe height="'+r+'" width="'+n+'" frameborder="0" scrolling="no" allowtransparency="true" leftmargin="0" rightmargin="0" marginwidth="0" marginheight="0" src="'+e+'"></iframe>'},docLitToHTMLLit:function(e,t,i,n){return a.HTMLAdGenerator.log("docLitToHTMLLit"),'<iframe id="_fw_frame_'+t+'" width="'+i+'" height="'+n+'" marginwidth="0" marginheight="0" frameborder="0" scrolling="no"></iframe><script language="javascript" type="text/javascript" id="_fw_container_js_'+t+"\">if(!fw_targets) {var fw_targets = [];}var _fw_wr;var fw_scope = document;var fw_content = '"+a.Util.encodeToHex(e)+"';var trgtFrm = fw_scope.getElementById(\"_fw_frame_"+t+'");trgtFrm = (trgtFrm.contentWindow) ? trgtFrm.contentWindow : (trgtFrm.contentDocument.document) ? trgtFrm.contentDocument.document : trgtFrm.contentDocument;fw_targets["'+t+'"] = trgtFrm;if(navigator.userAgent.match(/\\bMSIE\\b/) || navigator.userAgent.match(/\\bOpera\\b/)){trgtFrm.document.open();trgtFrm.document.write(fw_content);setTimeout(function(){fw_close(fw_targets["'+t+'"])}, 7500);} else if (navigator.userAgent.match(/\\bFirefox\\b/)) {if(true && fw_content.length < 2000){var ec = escape(fw_content);var fw_iframe_url = "http://m2.feiwei.tv/g/lib/template/echo.html?s="+ec;fw_scope.getElementById("_fw_frame_'+t+'").src = fw_iframe_url;} else {trgtFrm.document.open();trgtFrm.document.write(fw_content);trgtFrm.document.close();}} else {trgtFrm.document.open();trgtFrm.document.write(fw_content);trgtFrm.document.close();}function fw_close(theFrame){theFrame.document.close();}</script>'},htmlLitToDocLit:function(e){return a.HTMLAdGenerator.log("htmlLitToDocLit"),'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html><head><title>Advertisement</title></head><body leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">'+e+"</body></html>"},wrapUnsafeHTML:function(e,t,i,n){return a.HTMLAdGenerator.htmlLitToHTMLDocLitMobile(a.HTMLAdGenerator.docLitToHTMLLit(a.HTMLAdGenerator.htmlLitToDocLit(e),t,i,n))},wrapJSCode:function(e,t,i,n){return a.HTMLAdGenerator.wrapUnsafeHTML('<script language="javascript" type="text/javascript">'+e+"</script>",t,i,n)},generateScriptHTML:function(e,t,i,n){return a.HTMLAdGenerator.log("generateScriptHTML"),a.HTMLAdGenerator.wrapUnsafeHTML('<script language="javascript" type="text/javascript" src="'+e+'"></script>',t,i,n)},htmlLitToHTMLDocLitMobile:function(e){return a.HTMLAdGenerator.log("htmlLitToHTMLDocLitMobile"),'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html><head><meta name = "viewport" content = "initial-scale = 1.0, target-densitydpi = device-dpi" /><title>Advertisement</title><script type="text/javascript">window._fw_page_url = "";</script></head><body style="margin:0px;background-color:transparent;">'+e+"</body></html>"}},a.NullRenderer=function(){},a.NullRenderer.prototype={start:function(e){e.setCapability(a.EVENT_AD_CLICK,a.CAPABILITY_STATUS_OFF),e.handleStateTransition(a.RENDERER_STATE_STARTED),e.handleStateTransition(a.RENDERER_STATE_COMPLETED)},info:function(){return{moduleType:a.MODULE_TYPE_RENDERER}},getPlayheadTime:function(){return-1},getDuration:function(){return-1}},a.NullRenderer.prototype.constructor=a.NullRenderer,a.PageSlotScanner=function(e){this.OPTION_INIT=1,this.OPTION_FCAI=2,this.OPTION_NIIC=4,this.OPTION_NOSA=8,this.OPTION_NSIT=16,this._knownSlots=[],this._slots={},this._candidateAds=[],this._slotOptionFound=!1,this._context=e},a.PageSlotScanner.prototype={isSlotDuplicate:function(e){for(var t=0;t<this._knownSlots.length;++t)if(this._knownSlots[t].id===e)return!0;return!1},findPageSlotByScope:function(e){var t=e.document;if(t){var i,n=/(^|\s)_fwph(\s|$)/,r=t.getElementsByTagName("span");for(e._fw_admanager||(e._fw_admanager={}),e._fw_admanager.pageScanState=!0,e=0;e<r.length;++e){var s;if(i=r[e],n.test(i.className)&&(i=i.getAttribute("id"),(s=t.getElementById("_fw_input_"+i))&&!this.isSlotDuplicate(i))&&(s=s.getAttribute("value"))){";"!==s.charAt(s.length-1)&&(s+=";"),s=s.split(";");var o=s[s.length-2],l=!1;-1!==o.search("lo=i")&&(l=!0);var d=!1;-1!==o.search("prct=")&&(d=!0),0>o.search("flag=")&&(o+="&flag="),0>o.search("ptgt=")&&(o="ptgt=s&"+o),s=[];for(var _,c,h,E=o.split("&"),o=!0,u=a.SLOT_OPTION_INITIAL_AD_STAND_ALONE,p=0;p<E.length;++p)if(_=E[p].split("="),2===_.length){if(_[1]=decodeURIComponent(_[1]),"ssct"===_[0]){if(d)continue;d=!0,_[0]="prct"}"flag"===_[0]?(-1===_[1].search(/[-\+]cmpn/)&&(_[1]+="+cmpn"),"+"!==_[1].charAt(0)&&"-"!==_[1].charAt(0)&&(_[1]="+"+_[1]),l&&-1===_[1].search("-init")&&(_[1]+="-init"),-1!==_[1].search("-nrpl")&&(_[1]=_[1].replace("-nrpl","+cmpn")),-1!==_[1].search("-cmpn")&&(o=!1),u=this._getInitialOption(_[1]),this._slotOptionFound||(u=l?a.SLOT_OPTION_INITIAL_AD_KEEP_ORIGINAL:a.SLOT_OPTION_INITIAL_AD_STAND_ALONE)):"w"===_[0]?c=Number(_[1]):"h"===_[0]?h=Number(_[1]):"cana"===_[0]&&this._addCandidateAds(_[1]),_=encodeURIComponent(_[0])+"="+encodeURIComponent(_[1]),s.push(_)}d||(l=this._context.getParameter(a.PARAMETER_PAGE_SLOT_CONTENT_TYPE)||"text/html_doc_lit_mobile,text/html_doc_ref",s.push("prct="+encodeURIComponent(l))),(l=t.getElementById("_fw_container_"+i))?(this._slots[i]=s.join("&")+";",this._knownSlots.push({id:i,width:c,height:h,element:l,acceptCompanion:o,initialAdOption:u})):a.warn("Failed to find container for slot "+i)}}}},scanPageSlots:function(){for(var e=0;e<window.frames.length;++e)try{a.debug("scanPageSlots in frame",e),this.findPageSlotByScope(window.frames[e])}catch(t){}try{window.parent&&window.parent!==window&&(a.debug("scanPageSlots in parent frame"),this.findPageSlotByScope(window.parent))}catch(i){}try{a.debug("scanPageSlots in current window"),this.findPageSlotByScope(window)}catch(n){}},slotsToTypeBStr:function(){var e,t="";for(e in this._slots)if(this._slots.hasOwnProperty(e)){var i=this._slots[e];-1===i.search("slid=")&&(i="slid="+encodeURIComponent(e)+"&"+i),t+=i,";"!==t.charAt(t.length-1)&&(t+=";")}return t&&(t=t.substring(0,t.length-1)),t},_addCandidateAds:function(e){for(var e=e.split(","),t=0;t<e.length;t++){var i=parseInt(e[t],10);i>0&&this._candidateAds.push(i)}},_parseFlags:function(e){for(var t=[],i=[],n="",a=!0,e=e+"+",r=0;r<e.length;++r){var s=e.charAt(r);switch(s){case"+":case"-":""!=n&&(a?t.push(n):i.push(n),n=""),a="+"==s;break;default:n+=s}}return[t,i]},_getInitialOption:function(e){for(var t=!1,i=0,e=this._parseFlags(e),n=a.SLOT_OPTION_INITIAL_AD_STAND_ALONE,r=0;r<e.length;++r)for(var s=0;s<e[r].length;++s)switch(e[r][s].toString().toLowerCase()){case"init":i=0==r?i&~this.OPTION_INIT:i|this.OPTION_INIT,t=!0;break;case"fcai":i=0==r?i|this.OPTION_FCAI:i&~this.OPTION_FCAI,t=!0;break;case"niic":i=0==r?i|this.OPTION_NIIC:i&~this.OPTION_NIIC,t=!0;break;case"nosa":i=0==r?i|this.OPTION_NOSA:i&~this.OPTION_NOSA,t=!0;break;case"nsit":i=0==r?i|this.OPTION_NSIT:i&~this.OPTION_NSIT,t=!0}switch(i){case 0:t&&(n=a.SLOT_OPTION_INITIAL_AD_STAND_ALONE);break;case 1:n=a.SLOT_OPTION_INITIAL_AD_KEEP_ORIGINAL;break;case 3:n=a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_ONLY;break;case 2:n=a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_OR_STAND_ALONE;break;case 6:n=a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_THEN_STAND_ALONE;break;case 8:n=a.SLOT_OPTION_INITIAL_AD_NO_STAND_ALONE;break;case 10:n=a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_OR_NO_STAND_ALONE;break;case 16:n=a.SLOT_OPTION_INITIAL_AD_NO_STAND_ALONE_IF_TEMPORAL;break;case 18:n=a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_OR_NO_STAND_ALONE_IF_TEMPORAL;break;default:n=a.SLOT_OPTION_INITIAL_AD_STAND_ALONE}return this._slotOptionFound=t,n}},a.PageSlotScanner.prototype.constructor=a.PageSlotScanner,a.RendererController=function(e,t){var i=null,n=null,r={},s=a.RendererInitState.instance,o={},l=[],d=0;return{getAdInstance:function(){return t},getContext:function(){return e},getRendererState:function(){return s},processEvent:function(e){var i=e.name;if(i===a.RENDERER_STATE_STARTED||i===a.RENDERER_STATE_COMPLETING||i===a.RENDERER_STATE_COMPLETED||i===a.RENDERER_STATE_FAILED)this.handleStateTransition(i,e.info);else{var n=this._inferEventType(i);n&&(n===a.EVENT_TYPE_CLICK&&e.info&&e.info[a.INFO_KEY_CUSTOM_EVENT_NAME]&&(i=e.info[a.INFO_KEY_CUSTOM_EVENT_NAME]),(i!==a.EVENT_AD_MEASUREMENT||e.info[a.INFO_KEY_CONCRETE_EVENT_ID])&&t.processEvent(i,n,e.info))}},handleStateTransition:function(e,i){switch(e){case a.RENDERER_STATE_STARTED:s.notifyStarted(this);break;case a.RENDERER_STATE_COMPLETING:s.complete(this);break;case a.RENDERER_STATE_COMPLETED:s.complete(this),s.notifyCompleted(this);break;case a.RENDERER_STATE_FAILED:t.getSlot()._clearScheduledAdInstance(),i||(i={}),a.warn("FAIL",i.errorModule,i.errorCode,i.errorInfo);var n=t.processEvent(a.EVENT_ERROR,a.EVENT_TYPE_ERROR,i);if(n||a.debug("No EVENT_ERROR callback found"),i)switch(i[a.INFO_KEY_ERROR_CODE]){case a.ERROR_NO_AD_AVAILABLE:case a.ERROR_3P_COMPONENT:case a.ERROR_PARSE:(n=t.processEvent(a.EVENT_RESELLER_NO_AD,a.EVENT_TYPE_IMPRESSION))||a.debug("No EVENT_RESELLER_NO_AD callback found.")}s.fail(this);break;default:a.debug("Unknown event received",e)}},setCapability:function(e,i){t.setMetr(e,i)},getVersion:function(){return e._adManager.getVersion()},getParameter:function(i){if(!i)return null;if(e._overrideLevelParameterDictionary.hasOwnProperty(i))return e._overrideLevelParameterDictionary[i];if(t.getActiveCreativeRendition()&&"undefined"!=typeof t.getActiveCreativeRendition().getParameter(i))return t.getActiveCreativeRendition().getParameter(i);var n=t._creative;return n&&"undefined"!=typeof n.getParameter(i)?n.getParameter(i):"undefined"!=typeof t.getSlot().getParameter(i)?t.getSlot().getParameter(i):e._adResponse._profileParameters.hasOwnProperty(i)?e._adResponse._profileParameters[i]:e._globalLevelParameterDictionary.hasOwnProperty(i)?e._globalLevelParameterDictionary[i]:r&&r.hasOwnProperty(i)?r[i]:null},getCompanionSlots:function(){for(var e=[],i=t._companionAdInstances,n=0;n<i.length;n++)i[n].isPlaceholder()&&e.push(i[n].getSlot());return e},createNullDrivingAdInstance:function(){var e=t.getSlot().scheduleAdInstance();return e.addCreativeRendition().setContentType("null/null"),e},scheduleAdInstances:function(e){var i,n=[],a=null,e=e||[];if(0===e.length)return n;for(i=0;i<e.length;i++)e[i].getCustomId()===t.getSlot().getCustomId()&&(a=t.getSlot().scheduleAdInstance());if(!a)if(this.isTranslator())a=this.createNullDrivingAdInstance();else{if(!this.isRenderer())return n;a=t}for(var r=0;r<e.length;r++){if(e[r].getCustomId()===t.getSlot().getCustomId())a!==t&&n.push(a);else for(var s=0,d=a._companionAdInstances;s<d.length;s++)if(i=d[s],e[r]===i.getSlot()){if(this.isTranslator())n.push(i);else if(this.isRenderer()&&i.isPlaceholder()){var _=i.cloneForTranslation();a===t&&(o[_]=i),d[s]=_,n.push(_),l.push(_)}break}n.length<=r&&n.push(null)}return n},commitAdInstance:function(){if(this.isRenderer()&&t.isStarted()){for(var e=0;e<l.length;e++){var i=l[e];i&&i.getSlot().playCompanionAds(i)}l=[]}else a.warn("Skipping RendererController.commitAdInstance when called with driving ad not started or completed.")},isRenderer:function(){return i&&a.MODULE_TYPE_RENDERER===i.info()[a.INFO_KEY_MODULE_TYPE]},isTranslator:function(){return i&&a.MODULE_TYPE_TRANSLATOR===i.info()[a.INFO_KEY_MODULE_TYPE]},playable:function(){return s===a.RendererInitState.instance},reset:function(){s=a.RendererInitState.instance},play:function(){for(var e=t.getAllCreativeRenditions()||[],i=null,n=0;n<e.length;n++){var a=e[n];if(i=this._matchRendererClassName(a)){t.setActiveCreativeRendition(a);break}}0===d&&this._actualPlay(i)},_actualPlay:function(e){(n=a.Util.getObject(e)||a.Util.getObject(u+"."+e))&&(i=new n),i?s.start(this):this.handleStateTransition(a.RENDERER_STATE_FAILED,{errorCode:a.ERROR_NO_RENDERER,errorInfo:"Renderer class <"+e+"> not found"})},dispatchEvent:function(t,i){e.dispatchEvent(t,i)},requestContentStateChange:function(e){e?this.dispatchEvent(a.EVENT_CONTENT_VIDEO_PAUSE_REQUEST):this.dispatchEvent(a.EVENT_CONTENT_VIDEO_RESUME_REQUEST)},getRenderer:function(){return i},setRenderer:function(e){i=e},setRendererState:function(e){s=e},getContentVideoElement:function(){return e.getContentVideoElement()},_restorePlaceholdersForHybrid:function(){if(o&&this.isRenderer()){for(var e=[],i=0;i<t._companionAdInstances.length;i++){var n=t._companionAdInstances[i],a=o[n];a?e.push(a):e.push(n)}t._companionAdInstances=e}0<l.length&&this.isRenderer()&&(l=[])},rendererMatch:function(e){return n?n===a.Util.getObject(this._matchRendererClassName(e)):!0},_matchRendererClassName:function(i){function n(e,t,i){if(a.debug("matching "+e+" within "+t),!t)return!0;if(t=t.split(","),t[t.length-1]||t.pop(),i){for(e=e.toLowerCase(),i=0;i<t.length;i++)if(e==t[i].toLowerCase())return!0;return a.debug("not match"),!1}return(t=0<=t.indexOf(e))||a.debug("not match"),t}var s=i.getPrimaryCreativeRenditionAsset().getContentType(),o=i.getContentType(),l=i.getWrapperType(),_=i.getCreativeApi(),c=i.getBaseUnit(),h=t.getSoAdUnit(),E=t.getSlot();if(E.getType(),E=E.getTimePositionClass(),a.debug("match renderer for creativeRendition:"+i.getId()),a.Util.isBlank(o)&&a.Util.isBlank(l))return a.warn("renderer not match due to both contentType and wrapperType are empty"),null;var p=e._rendererManifest["*"];if(p||(p=e._rendererManifest[l]),p||(p=e._rendererManifest[o]),!p)for(var T=e._overriddenAdRenderers.concat(e._adResponse._adRenderers),A=0;A<T.length;A++){var g=T[A],R=!g.contentType;if(R||(l?R=n(l,g.contentType,!0):(s&&(R=n(s,g.contentType,!0)),R||(R=n(o,g.contentType,!0)))),R)if((R=!g.creativeApi)||(R=n(_,g.creativeApi)),R){if(g.baseUnit&&!n(c,g.baseUnit))a.debug("can't match renderer "+g.url+" due to baseUnit not match for creativeRendition:"+i.getId());else if(g.soAdUnit&&!n(h,g.soAdUnit))a.debug("can't match renderer "+g.url+" due to soAdUnit not match for creativeRendition:"+i.getId());else if(g.slotType&&!n(E.toUpperCase(),g.slotType.toUpperCase()))a.debug("can't match renderer "+g.url+" due to slotType not match for creativeRendition:"+i.getId());else if(a.debug("renderer "+g.url+" matched for creativeRendition:"+i.getId()),g.url){p=g.url,i=p.indexOf("?"),-1!==i&&(p=p.substring(0,i)),i=p.lastIndexOf("/"),-1!==i&&(p=p.substring(i+1)),i=p.lastIndexOf(".js"),-1!==i&&(p=p.substring(0,i));var m={};if(g.parameter)for(i=[].concat(g.parameter),s=0;s<i.length;s++)if(i[s].hasOwnProperty("name"))m[i[s].name]=i[s].value;else for(var I in i[s])i[s].hasOwnProperty(I)&&(m[I]=i[s][I]);if(a.Util.getObject(u+"."+p)&&(p=u+"."+p),a.Util.getObject(p))r=m,d=0;else{if(d>0)break;var f=this;I=1*this.getContext().getParameter("moduleLoadTimeout")||6e4,d=window.setTimeout(function(){d=-1,f.handleStateTransition(a.RENDERER_STATE_FAILED,{errorCode:a.ERROR_NO_RENDERER,errorInfo:"Load renderer timeout, URL:"+g.url})},I),a.Util.lazyJavaScriptLoad(g.url,function(){a.log("async load renderer successful, URL:"+g.url),-1===d?a.debug("renderer loaded after timeout. WILL NOT PLAY."):(window.clearTimeout(d),d=0,r=m,f._actualPlay(p))})}break}}else a.debug("can't match renderer "+g.url+" due to creative api not match for creativeRendition:"+i.getId());else a.debug("can't match renderer "+g.url+" due to contentType not match for creativeRendition:"+i.getId())}return p?p:a.Util.isBlank(l)&&"null/null"===o?u+".NullRenderer":null},_inferEventType:function(e){return e===a.EVENT_ERROR?a.EVENT_TYPE_ERROR:e===a.EVENT_AD_CLICK?a.EVENT_TYPE_CLICK:e===a.EVENT_AD_IMPRESSION||e===a.EVENT_AD_FIRST_QUARTILE||e===a.EVENT_AD_MIDPOINT||e===a.EVENT_AD_THIRD_QUARTILE||e===a.EVENT_AD_COMPLETE||e===a.EVENT_RESELLER_NO_AD?a.EVENT_TYPE_IMPRESSION:e===a.EVENT_AD_PAUSE||e===a.EVENT_AD_RESUME||e===a.EVENT_AD_REWIND||e===a.EVENT_AD_MUTE||e===a.EVENT_AD_UNMUTE||e===a.EVENT_AD_COLLAPSE||e===a.EVENT_AD_EXPAND||e===a.EVENT_AD_MINIMIZE||e===a.EVENT_AD_CLOSE||e===a.EVENT_AD_ACCEPT_INVITATION?a.EVENT_TYPE_STANDARD:e===a.EVENT_AD_MEASUREMENT?a.EVENT_TYPE_GENERIC:null},stop:function(){a.log("RendererController.stop"),d>0&&(d=-1),s.stop(this)}}},a.RenditionSelector=function(e,t,i,n){this._targetByterate=e,this._arWeight=t,this._pxWeight=i,this._conversionFactor=n},a.RenditionSelector.prototype={getBestFitRendition:function(e,t,i){var n=this;if(e.reverse(),e=e.filter(function(e){return e&&e.getPrimaryCreativeRenditionAsset()&&(e.getPrimaryCreativeRenditionAsset().getUrl()||e.getPrimaryCreativeRenditionAsset().getContent())&&a.Util.canPlayVideoType(e.getPrimaryCreativeRenditionAsset().getMimeType())}).sort(function(e,t){return n.getBitrate(e)-n.getBitrate(t)}),!e.length)return null;var r=Number.MAX_VALUE,s=e.filter(function(e){return e=n.getBitrate(e),r=r>e?e:r,e<=n._targetByterate});return s.length||(s=e.filter(function(e){return n.getBitrate(e)<=r})),s.sort(function(e,a){return n.compareVisualMetrics(e,a,t,i)}).pop()},compareVisualMetrics:function(e,t,i,n){var a=this.calculateVisualRatios(e.getWidth(),e.getHeight(),i,n),n=this.calculateVisualRatios(t.getWidth(),t.getHeight(),i,n);if(!a&&n)return-1;if(a&&!n)return 1;if(a&&n){var i=this._conversionFactor*this._arWeight*Math.log(a.arRatio),r=this._pxWeight*Math.log(a.pixelation),a=this._conversionFactor*this._arWeight*Math.log(n.arRatio),n=this._pxWeight*Math.log(n.pixelation),i=this.findDistance(i,r,0,0),a=this.findDistance(a,n,0,0);if(a!=i)return a-i}return e.getPreference()-t.getPreference()},calculateVisualRatios:function(e,t,i,n){if(e>0&&t>0&&i>0&&n>0){var a=e/t,r=i/n;return a>r?n=i/a:i=n*a,{arRatio:a/r,pixelation:e*t/(i*n)}}return null},findDistance:function(e,t,i,n){return isNaN(e)||isNaN(i)||isNaN(t)||isNaN(n)?NaN:Math.sqrt(Math.pow(i-e,2)+Math.pow(n-t,2))},getBitrate:function(e){var t=e.getDuration();return(e=e.getPrimaryCreativeRenditionAsset().getBytes())&&t&&!isNaN(e)&&!isNaN(t)&&e>0&&t>0?8*e/1e3/t:-1}},a.RenditionSelector.prototype.constructor=a.RenditionSelector,a.Slot=function(e){var t,i,n,r,s,o,l,d,_="",c=null,h=null,E=null,u=null,p=[],T=[],A={},g=null,R=a.MediaInitState.instance,m=0,I=null,f=!1,S=!1,v=!0,C=[];return{getSlotProfile:function(){return h},setSlotProfile:function(e){h=e},setMediaState:function(e){R=e},setParameter:function(e,t){null===t?delete A[e]:A[e]=t},getParameter:function(e){return e&&A.hasOwnProperty(e)?A[e]:void 0},getAdCount:function(){return p.length},setCustomId:function(e){_=e},getCustomId:function(){return _},setAdUnit:function(e){s=e},getAdUnit:function(){return s},setType:function(e){c=e},getType:function(){return c},setTimePosition:function(e){i=e},getTimePosition:function(){return i},setTimePositionClass:function(e){I=e&&e.toUpperCase()},getTimePositionClass:function(){return I},setWidth:function(e){n=e},getWidth:function(){return I!==a.TIME_POSITION_CLASS_DISPLAY?n?n:e.getVideoDisplaySize().width:n},setHeight:function(e){r=1*e},getHeight:function(){return I!==a.TIME_POSITION_CLASS_DISPLAY?r?r:e.getVideoDisplaySize().height:r},setBase:function(e){t=e},getBase:function(){return t},setCuepointSequence:function(e){o=1*e?1*e:0},getCuepointSequence:function(){return o},getVideoDisplaySize:function(){return e.getVideoDisplaySize()},parse:function(t){if(t){_=t.customId,i=1*t.timePosition,I=t.timePositionClass&&t.timePositionClass.toUpperCase()||I,s=t.adUnit;for(var n,r=0,o=t.eventCallbacks||[];r<o.length;r++){n=o[r];var l=a.EventCallback.newEventCallback(e,n.name,n.type);l&&(l._slot=this,l.parse(n),T.push(l))}for(r=0,o=t.selectedAds||[];r<o.length;r++)n=o[r],t=[],l=new a.AdInstance(e),t.push(l),l._slot=this,l._slotCustomId=_,l._parentAdInstancesGroup=t,l.parse(n),p.push(t)}},getCurrentAdInstance:function(){return E},isPauseSlot:function(){return I===a.TIME_POSITION_CLASS_PAUSE_MIDROLL},play:function(e){I!==a.TIME_POSITION_CLASS_DISPLAY||v?(a.log("Slot.play",I),f=!1,I===a.TIME_POSITION_CLASS_DISPLAY&&1<p.length&&p.splice(0,p.length-1),this._play(e)):(a.log("Slot is invisible. Push the play operation to the queue."),C.push({operation:this.play,argument:e}))},stop:function(){a.log("Slot.stop",I),I===a.TIME_POSITION_CLASS_DISPLAY&&(C=[]),R===a.MediaInitState.instance||R===a.MediaEndState.instance?a.log("Slot.stop, not start or already end, ignore"):(f=!0,E?E.stop():a.warn("Slot.stop, no _currentAdInstance, ignore"))},setVisible:function(e){if(!I===a.TIME_POSITION_CLASS_DISPLAY)a.log("Slot.setVisible is only for display ads.");else if(a.log("Slot.setVisible",e),v!=e&&(v=e))for(;0<C.length;)op=C.pop(),op.operation&&op.operation.call(this,op.argument)},_play:function(e){g=g||e,R.play(this)},onStartPlaying:function(){this._onStartPlaying()},onStartReplaying:function(){this._onStartPlaying()},onCompletePlaying:function(){this._onCompletePlaying()},onCompleteReplaying:function(){this._onCompletePlaying()},playNextAdInstance:function(){a.log("Slot.playNextAdInstance ",I),this._playNextAdInstance()||R.complete(this)},scheduleAdInstance:function(){return u=E.cloneForTranslation()},_clearScheduledAdInstance:function(){u=null},_onStartPlaying:function(){var e=a.EventCallback.getEventCallback(T,a.EVENT_SLOT_IMPRESSION,a.EVENT_TYPE_IMPRESSION);e&&e.process(),this.dispatchSlotEvent(a.EVENT_SLOT_STARTED),this.playNextAdInstance()},dispatchSlotEvent:function(t){S||e.dispatchEvent(t,{slot:this})},_onCompletePlaying:function(){g&&g(),g=null,C=[];var e=a.EventCallback.getEventCallback(T,a.EVENT_SLOT_END,a.EVENT_TYPE_IMPRESSION);e&&e.process(),E=null,this.dispatchSlotEvent(a.EVENT_SLOT_ENDED)},_playNextAdInstance:function(){return f||R!==a.MediaPlayingState.instance&&R!==a.MediaReplayingState.instance?!1:(this._commitScheduledAdInstance(),(E=this._nextPlayableAdInstance())?(E.reset(),E.getRendererController().play(),!0):!1)},_commitScheduledAdInstance:function(){if(u){var e=E._parentAdInstancesGroup.indexOf(E);e>=0&&(u._parentAdInstancesGroup=E._parentAdInstancesGroup,E._parentAdInstancesGroup.splice(e,1,u),u=null)}},_nextPlayableAdInstance:function(){var e=-1;if(E){var t=E._parentAdInstancesGroup,i=t.indexOf(E),e=p.indexOf(t);e>=0&&i>=0&&(E._isImpressionSent||i==t.length-1)&&e++}else e=0;if(0>e||e>=p.length)return null;if(R===a.MediaPlayingState.instance)for(t=p[e],i=0;i<t.length;i++){var n=t[i];if(n.getRendererController().playable())return n}else if(R===a.MediaReplayingState.instance)for(;e<p.length;e++){for(t=p[e],i=0;i<t.length;i++)if(n=t[i],n._isImpressionSent)return n;for(i=0;i<t.length;i++)if(n=t[i],n.getRendererController().getRendererState()!==a.RendererFailedState.instance&&!n._translated)return n}return null},toString:function(){return"[Slot "+_+"]"},getAdInstances:function(){for(var e=[],t=0;t<p.length;++t)for(var i=p[t],n=0;n<i.length;++n){var a=i[n];if(a.isPlayable()){e.push(a);break}}return e},getPlayheadTime:function(){for(var e=0,t=this.getAdInstances(),i=0;i<t.length;++i){if(t[i]===E){t=E.getPlayheadTime(),t>-1&&(e+=t);break}var n=t[i].getDuration();n>-1&&(e+=n)}return m&&e>m&&(e=m),e},getTotalDuration:function(){for(var e=0,t=this.getAdInstances(),i=0;i<t.length;++i){var n=t[i].getDuration();n>-1&&(e+=n)}return m=e},playCompanionAds:function(e){a.log("Slot.playCompanionAds");var t=[];e._parentAdInstancesGroup=t,t.push(e),p.push(t),S=!0,E&&this.stop(),this.play()},getState:function(){return R},setAcceptCompanion:function(e){l=e},getAcceptCompanion:function(){return l},setInitialAdOption:function(e){d=e},getInitialAdOption:function(){return d}}},a.SurveyExtension=function(e){this._context=e,this._surveyPingedIds=[]},a.SurveyExtension.prototype={start:function(){a.log("SurveyExtension.start("+Array.prototype.slice.call(arguments).join(",")+")"),this._onAdStarted=a.Util.bind(this,function(t){if(this._parameters=this._getParameters(),this._parameters.enabled){a.log("SurveyExtension.onAdStarted()");var i=t.adInstance;if(-1<this._surveyPingedIds.indexOf(i.getAdId()))a.log("won't pingback survey since it has been pinged back");else{var n=i._creative.getParameter("_fw_survey_url");if(n)try{a.log("append"+n+" to head");var r=document.getElementsByTagName("head")[0],s=document.createElement("script");s.setAttribute("type","text/javascript"),s.setAttribute("src",n),r.appendChild(s),this._surveyPingedIds.push(i.getAdId())}catch(o){a.warn("Append survey to head",t.type,e)}}}}),this._context.addEventListener(a.EVENT_AD_IMPRESSION,this._onAdStarted)},dispose:function(){a.log("SurveyExtension.dispose()"),this._context.removeEventListener(a.EVENT_AD_IMPRESSION,this._onAdStarted),this._parameters=this._onAdStarted=null},_getParameters:function(){var e={};return e.enabled="false"!=this._context.getParameter(a.PARAMETER_EXTENSION_SURVEY_ENABLED),a.log(e),e}},a.SurveyExtension.prototype.constructor=a.SurveyExtension,a.Timer=function(e,t){this._lastTickDate=new Date,this._duration=e||-1,this._playheadTime=-1,this._callback=t,this._state=-1},a.Timer.prototype={},a.Timer.prototype.constructor=a.Timer,a.Util.mixin(a.Timer.prototype,{tick:function(){var e=new Date,t=Math.round((e.getTime()-this._lastTickDate.getTime())/1e3);return this._lastTickDate=e,t},start:function(){if(0!==this._state){2!==this._state&&-1!==this._playheadTime||(this._playheadTime=0),this._state=0,this._timeStamp=new Date,this._timeouter&&(window.clearTimeout(this._timeouter),this._timeouter=null);var e=this,t=1e3*(this._duration-this._playheadTime);0>t||(this._timeouter=window.setTimeout(function(){e.stop(),e._playheadTime=e._duration,e._callback&&e._callback()},t))}},pause:function(){0===this._state&&(this._state=1,this._timeouter&&(window.clearTimeout(this._timeouter),this._timeouter=null),this._playheadTime=(new Date-this._timeStamp)/1e3+this._playheadTime)},stop:function(){this._state=2,this._timeouter&&(window.clearTimeout(this._timeouter),this._timeouter=null),this._playheadTime=(new Date-this._timeStamp)/1e3+this._playheadTime},getPlayheadTime:function(){return 0===this._state?(new Date-this._timeStamp)/1e3+this._playheadTime:this._playheadTime},getCTValue:function(){return(new Date-this._timeStamp)/1e3},getDuration:function(){return this._duration}}),a.Url=function(e){this._session=this._base="",this._parameters=new a.Hash,this.setString(e)},a.Url.prototype={},a.Url.prototype.constructor=a.Url,a.Util.mixin(a.Url.prototype,{setString:function(e){if(this._string!==e&&e&&(this._string=e,e=e.split("?"),this._base=e[0],this._parameters=new a.Hash,e[1])){var t=e[1].indexOf(";"),i="";for(t>0&&0===e[1].indexOf("session=")?(this._session=e[1].substring(0,t+1),i=e[1].substring(t+1)):i=e[1],e=i.split("&"),i=0;i<e.length;i++){var n=e[i],t=n.indexOf("=");if(!(0>t)){var r=decodeURIComponent(n.substring(0,t)),t=decodeURIComponent(n.substring(t+1));this._parameters.setKeyValue(r,t)}}}},setParameter:function(e,t){this._parameters.setKeyValue(e,t,0),this._string=null},getParameter:function(e){return this._parameters.getValue(e)},toString:function(){if(this._string)return this._string;this._parameters.move("cr",-1);for(var e=this._parameters._keys,t=[],i=0;i<e.length;i++){var n=e[i],a=this._parameters.getValue(n);t.push(encodeURIComponent(n)+"="+encodeURIComponent(a))}return this._string=this._base+"?"+this._session+t.join("&")}}),a.VastTranslator=function(){},a.VastTranslator.prototype={start:function(e){function t(e){a.log("VastTranslator	"+e)}function i(e){a.warn("VastTranslator	"+e)}function n(e,t){if(e)if(e.length&&"string"!=typeof e)for(var i=0;i<e.length;i++)t(e[i].value);else e.value&&t(e.value)}function r(e,t){n(t,function(t){t&&e.push(t)})}function s(e){if(!e)return!1;for(var t=0;t<S.length;t++)if(a.Util.trim(S[t]).toLowerCase()===a.Util.trim(e).toLowerCase())return!0;return!1}function o(e){return e?("string"!=typeof e&&(e=e.toString()),e=a.Util.trim(e),-1<e.indexOf("://")?e:null):null}function l(e){this.code=this.url=null,this.height=this.width=NaN,this.resourceType=this.creativeType=null,this.bitrate=NaN,this.creativeApi=null,this.ad=e,this.clickThrough=null,this.clickTrackings=[],this.customClicks=[],this.creativeData=null}function d(){this.creativeView=[],this.start=[],this.firstQuartile=[],this.midpoint=[],this.thirdQuartile=[],this.complete=[],this.mute=[],this.unmute=[],this.pause=[],this.rewind=[],this.resume=[],this.replay=[],this.fullscreen=[],this.expand=[],this.collapse=[],this.acceptInvitation=[],this.stop=[]}function _(e){this._impressions=[],this.clickThrough=null,this.clickTrackings=[],this.customClicks=[],this.creativeData=null,this.sequence=-1,this.vastRenditions=[],this.duration=NaN,this.adp=e,this.isDrivingAd=!1}function c(e){_.call(this,e)}function h(e){_.call(this,e)}function E(e){_.call(this,e)}function u(){}function p(e,i,n,a){if(e&&a&&0<a.length){t("augmentCallbacks("+i+", "+n+", "+a+")");for(var r=e.getEventCallbackUrls(i,n),s=0;s<r.length;s++)-1<a.indexOf(r[s])&&(t("augmentCallbacks() url = "+r[s]),a.unshift(r[s]));e.addEventCallbackUrls(i,n,a)}else t("augmentCallbacks("+i+", "+n+", "+a+"), empty callbacks")}function T(e,i){if(t("initErrorTrackings()"),e&&i){for(var n=i.errorTrackings,r=0;r<n.length;r++)-1<n[r].search("[ERRORCODE]")&&(n[r]=n[r].replace("[ERRORCODE]","900"));p(e,a.EVENT_ERROR,a.EVENT_TYPE_ERROR,i.errorTrackings)}}function A(e,i){t("initTrackingEvents()"),i&&e&&(p(e,a.EVENT_AD_IMPRESSION,a.EVENT_TYPE_IMPRESSION,i.creativeView),p(e,a.EVENT_AD_IMPRESSION,a.EVENT_TYPE_IMPRESSION,i.start),p(e,a.EVENT_AD_FIRST_QUARTILE,a.EVENT_TYPE_IMPRESSION,i.firstQuartile),p(e,a.EVENT_AD_MIDPOINT,a.EVENT_TYPE_IMPRESSION,i.midpoint),p(e,a.EVENT_AD_THIRD_QUARTILE,a.EVENT_TYPE_IMPRESSION,i.thirdQuartile),p(e,a.EVENT_AD_COMPLETE,a.EVENT_TYPE_IMPRESSION,i.complete),p(e,a.EVENT_AD_MUTE,a.EVENT_TYPE_STANDARD,i.mute),p(e,a.EVENT_AD_UNMUTE,a.EVENT_TYPE_STANDARD,i.unmute),p(e,a.EVENT_AD_PAUSE,a.EVENT_TYPE_STANDARD,i.pause),p(e,a.EVENT_AD_RESUME,a.EVENT_TYPE_STANDARD,i.resume),p(e,a.EVENT_AD_REWIND,a.EVENT_TYPE_STANDARD,i.rewind),p(e,a.EVENT_AD_EXPAND,a.EVENT_TYPE_STANDARD,i.fullscreen),p(e,a.EVENT_AD_COLLAPSE,a.EVENT_TYPE_STANDARD,i.collapse),
        p(e,a.EVENT_AD_EXPAND,a.EVENT_TYPE_STANDARD,i.expand),p(e,a.EVENT_AD_CLOSE,a.EVENT_TYPE_STANDARD,i.stop),p(e,a.EVENT_AD_ACCEPT_INVITATION,a.EVENT_TYPE_STANDARD,i.acceptInvitation))}function g(e,i,n,r,s){if(t("initClickAndImpressionEvents"),e){if(i&&e.setClickThroughUrl(a.EVENT_AD_CLICK,i),n&&0<n.length&&p(e,a.EVENT_AD_CLICK,a.EVENT_TYPE_CLICK_TRACKING,n),r&&0<r.length)for(i=0;i<r.length;i++)r[i].url&&p(e,r[i].id,a.EVENT_TYPE_CLICK_TRACKING,[r[i].url]);s&&p(e,a.EVENT_AD_IMPRESSION,a.EVENT_TYPE_IMPRESSION,s)}}function R(e,n){if(t("initTemporalAdInstance"),e||i("initTemporalAdInstance: Invalid adInstance"),n.selectedDrivingAd){n.surveyUrl&&e._creative.setParameter("_fw_survey_url",n.surveyUrl);var a=n.selectedDrivingAd,r=n.selectedDrivingRenditions;t("vastRenditions:"+r);for(var o=O===v,l=0;l<r.length;l++){var d,_=r[l],c=e.addCreativeRendition(),h=c.addCreativeRenditionAsset("VAST_CRA",!0);e:switch(d=_.creativeType){case"video/mp4":d="video/mp4-h264";break e;case"video/3gp":d="video/3gpp"}if(t("initTemporalAdInstance() set rendition/asset [vastRd.creativeApi,vastAd.duration,vastRd.width,vastRd.height,vastRd.url,assetContentType,vastRd.creativeType] =  "+[_.creativeApi,a.duration,_.width,_.height,_.url,d,_.creativeType]),c.setCreativeApi(_.creativeApi),isNaN(a.duration)||c.setDuration(a.duration),_.width&&!isNaN(_.width)&&c.setWidth(_.width),_.height&&!isNaN(_.height)&&c.setHeight(_.height),_.url&&h.setUrl(_.url),_.code&&h.setContent(_.code),h.setMimeType(_.creativeType),"static"===_.resourceType&&"text/html"===_.creativeType?h.setContentType("text/html_doc_ref"):"application/x-javascript"===_.creativeType||"application/javascript"===_.creativeType?h.setContentType("text/js_ref"):"iframe"===_.resourceType?h.setContentType("text/html_doc_ref"):"text/html"===_.creativeType||"text/html_doc_ref"===_.creativeType?h.setContentType("text/html_doc_ref"):"text/html_doc_lit_mobile"===_.creativeType?h.setContentType("text/html_doc_lit_mobile"):o||s(d)?(h.setContentType("text/html_doc_lit_mobile"),h.setUrl(null),h.setContent(m(e,N.getCustomId(),a,_,"text/html_doc_lit_mobile"))):h.setContentType(d),a.creativeData&&0!==a.creativeData.length&&(t("initTemporalAdInstance(), set asset parameter VPAID_creativeData:"+a.creativeData),c.setParameter("VPAID_creativeData",a.creativeData)),o||s(d)||(_=_.bitrate,!isNaN(_)&&_>0&&h.setBytes(1e3*_*a.duration/8)),d=L,h=y,_=!1,c.getContentType()&&d){var E=c.getContentType().toLowerCase(),u=d.toLowerCase();E==u?_=!0:(0==E.indexOf("video/mp4")&&0==u.indexOf("video/mp4")||"application/javascript"==u&&"text/js_ref"==E)&&(c.setContentType(d),_=!0)}d=!1,c.getCreativeApi()&&h&&(E=c.getCreativeApi().toLowerCase(),u=h.toLowerCase(),E==u?d=!0:0==E.indexOf("mraid")&&0==u.indexOf("mraid")&&(d=!0,c.setCreativeApi(h))),_&&d?c.setPreference(10):d?c.setPreference(6):_?c.setPreference(5):c.setPreference(0),t("adjustMatchedRendition "+c.getId()+", contentType "+c.getContentType()+", creativeAPI "+c.getCreativeApi()+", preference "+c.getPreference())}A(e,a.trackingEvents),T(e,n),g(e,o?r[0].clickThrough:a.clickThrough,a.clickTrackings,a.customClicks,a.impressions)}else{var c=e.addCreativeRendition();c.setContentType("null/null");var h=c.addCreativeRenditionAsset("VAST_CRA",!0);h.setContentType("null/null")}}function m(e,i,n,r,s){return t("getCoadHTML, ad id = "+e.getAdId()),r.url&&0<r.url.length?((n=r.clickThrough)&&0<n.length&&e.setClickThroughUrl(a.EVENT_AD_CLICK,n),e=e.getEventCallbackUrls(a.EVENT_AD_CLICK,a.EVENT_TYPE_CLICK)[0],a.HTMLAdGenerator.generateAd(r.url,e,i,r.width,r.height,r.creativeType,s)):r.code&&0<r.code.length?"script"===r.resourceType||"text/javascript"===r.resourceType||"text/js_ref"===r.resourceType||"application/x-javascript"===r.resourceType?a.HTMLAdGenerator.wrapJSCode(r.code,i,r.width,r.height):a.HTMLAdGenerator.wrapUnsafeHTML(r.code,i,r.width,r.height):null}function I(e,i,n,r){t("initPageAdInstance ad:"+i.getAdId());var s=n.vastRenditions[0];if(s.url||s.code){var o=i.addCreativeRendition(),l=o.addCreativeRenditionAsset("VAST_CRA",!0);o.setCreativeApi(s.creativeApi),o.setWidth(s.width),o.setHeight(s.height),"static"===s.resourceType&&"text/html"===s.creativeType?(l.setContentType("text/html_doc_ref"),l.setUrl(s.url)):"iframe"===s.resourceType?(l.setContentType("text/html_doc_ref"),l.setUrl(s.url)):"HTML"===s.resourceType?(l.setContentType("text/html_doc_lit_mobile"),l.setContent(a.HTMLAdGenerator.wrapUnsafeHTML(s.code,e.getCustomId(),s.width,s.height))):(l.setContentType("text/html_doc_lit_mobile"),l.setContent(m(i,e.getCustomId(),n,s,"text/html_doc_lit_mobile"))),l.setMimeType("text/html")}else t("initPageAdInstance will add a tracking only companion ad");A(i,n.trackingEvents),T(i,r),g(i,s.clickThrough,s.clickTrackings,s.customClicks,n.impressions)}function f(i){if(200==i.status)if(i.responseXML){var n=(new u).parseAdData(i.responseXML);if(n){if(t("scheduleVastAds"),n&&0!==n.length)if(i=n[0].selectedPackage,n=n[0].redirectPackage,i||n){if(!i&&n){t("scheduleVastAds(), no ads scheduled, redirect to downstream Secondary Ad Server"),t("scheduleRedirect");var i=[],r=[];i.push(N),r.push({});for(var s=P,o=n.selectedCompanionAds,l=0;l<s.length;l++){var d=s[l];o&&o[d.getCustomId()]&&(i.push(d),r.push(o[d.getCustomId()]))}for((s=e.scheduleAdInstances(i))&&0<s.length&&(o=s[0],l=o.addCreativeRendition(),l.setWrapperUrl(n.tagUrl),l.setWrapperType(D),l.setContentType(L),l.setCreativeApi(y),A(o,n.getTrackingEventsOfWrapper()),T(o,n),g(o,n.getClickThroughOfWrapper(),n.getClickTrackingsOfWrapper(),n.getCustomClicksOfWrapper(),n.getImpressionOfWrapper())),t("scheduleRedirect, schedule companion for redirect ad ",n),l=1;l<s.length;l++)(o=s[l])&&(d=r[l],d instanceof E&&I(i[l],o,d,n))}else if(i){for(t("scheduleVastAds(), ads returned from vast response, going to schedule them"),i.selectedDrivingAd?(t("scheduleVastAds(), ads returned from vast response, going to schedule them with driving ad"),i.selectedDrivingAd.isDrivingAd=!0):t("scheduleVastAds(), ads returned from vast response, going to schedule them without driving ad"),t("scheduleAdPackage()"),n=[],r=[],n.push(N),i.selectedDrivingAd&&r.push(i.selectedDrivingAd),s=P,o=i.selectedCompanionAds,l=0;l<s.length;l++)d=s[l],o&&o[d.getCustomId()]&&(n.push(d),r.push(o[d.getCustomId()]));if(o=e.scheduleAdInstances(n),0<o.length){for(t("scheduleAdPackage, scheduled "+o.length+" ads"+i.selectedDrivingAd?"":", 1 of it is nullAd for pure companion ad schedule"),i.selectedDrivingAd||t("Driving ad is not selected, will create a dummy null ad."),i.selectedDrivingAd||(n.shift(),R(o.shift(),i)),l=0;l<o.length;l++)if(d=o[l]){var _=r[l];_ instanceof E?I(n[l],d,_,i):R(d,i)}!i.selectedDrivingAd&&0<s.length&&0<i.companionAds.length&&0===r.length&&(t("found empty companion slots and companion ads in package, but none of them matches slot size"),e.handleStateTransition(a.TRANSLATOR_STATE_FAILED,{errorModule:"VastTranslator",errorCode:a.ERROR_UNMATCHED_SLOT_SIZE}))}else t("scheduleAdPackage, no ad scheduled.")}}else t("scheduleVastAds(), no ads from vast response!!!"),e.handleStateTransition(a.TRANSLATOR_STATE_FAILED,{errorModule:"VastTranslator",errorCode:a.ERROR_NO_AD_AVAILABLE});else t("no ads for scheduleVastAds");e.handleStateTransition(a.TRANSLATOR_STATE_STARTED),e.handleStateTransition(a.TRANSLATOR_STATE_COMPLETED)}}else e.handleStateTransition(a.TRANSLATOR_STATE_FAILED,{errorModule:"VastTranslator",errorCode:a.ERROR_PARSE,errorInfo:V});else 400<=i.status&&e.handleStateTransition(a.TRANSLATOR_STATE_FAILED,{errorModule:"VastTranslator",errorCode:a.ERROR_IO,errorInfo:V})}var S="image/gif,image/jpeg,image/png,text/html,text/javascript,text/html_doc_ref,text/html_doc_lit_mobile,application/x-javascript,application/javascript".split(","),v=4,C=e.getAdInstance(),N=C.getSlot(),O=function(){if(!N)return 1;switch(N.getTimePositionClass()){case a.TIME_POSITION_CLASS_PREROLL:case a.TIME_POSITION_CLASS_MIDROLL:case a.TIME_POSITION_CLASS_POSTROLL:return 2;case a.TIME_POSITION_CLASS_OVERLAY:return v;case a.TIME_POSITION_CLASS_DISPLAY:return N&&!N.getBase()?8:1;default:return 1}}(),P=e.getCompanionSlots().filter(function(e){if(!e)return!1;switch(e.getTimePositionClass()){case a.TIME_POSITION_CLASS_PREROLL:case a.TIME_POSITION_CLASS_MIDROLL:case a.TIME_POSITION_CLASS_PAUSE_MIDROLL:case a.TIME_POSITION_CLASS_POSTROLL:return!1;default:return!0}});t("Checking CompanionSlots, length = "+P.length+", rendererController.getCompanionSlots().length = "+e.getCompanionSlots().length+", AdInstance.getCompanionSlots.length = "+C.getCompanionSlots().length);var L=C.getActiveCreativeRendition().getContentType(),y=C.getActiveCreativeRendition().getCreativeApi()||"None";this.log("ExpectedDrivingContentType:"+L+", ExpectedDrivingAPI:"+y);var D=C.getActiveCreativeRendition().getWrapperType();l.prototype={init:function(e,t,i,n,a,r,s,o){this.log("init("+[].slice.call(arguments,0).join(",")+")"),this.url=e,this.width=1*t,this.height=1*i,this.creativeType=n,this.resourceType=a,this.bitrate=r;var l;if(l=s,l&&0!==l.length){var d="";switch(l.toLowerCase()){case"flashvar":case"flashvars":d="clickTag";break;case"vpaid":d="VPAID";break;case"mraid":d="MRAID-1.0";break;default:d=l}l=d}else l="None";this.creativeApi=l,this.code=o||null},log:function(e){a.log("VastTranslator.VastRendition	"+e)},toString:function(){var e,t=[];for(e in this)this.hasOwnProperty(e)&&"function"!=typeof this[e]&&"ad"!==e&&t.push(e+":"+this[e]);return t.join(",")}},l.prototype.constructor=l,_.prototype={parse:function(e){if(this.log("parse()"),e.Duration)if(e.Duration.value){var t=/(\d+):(\d+):(\d+)/.exec(e.Duration.value);t?this.duration=3600*t[1]+60*t[2]+1*t[3]:this.warn("Failed to parse duration value for creative "+e)}else this.warn("No duration value set for creative "+e);e.VideoClicks&&(e.VideoClicks=[].concat(e.VideoClicks),a.Util.forEachOnArray(e.VideoClicks,function(e){if(e.ClickThrough&&e.ClickThrough.value&&(this.clickThrough=o(e.ClickThrough.value)),e.ClickTracking){e.ClickTracking=[].concat(e.ClickTracking);for(var t=0;t<e.ClickTracking.length;t++){var i=o(e.ClickTracking[t].value);i&&this.clickTrackings.push(i)}}if(e.CustomClick)for(e.CustomClick=[].concat(e.CustomClick),t=0;t<e.CustomClick.length;t++){var n=null;e.CustomClick[t]["@attributes"]&&(n=e.CustomClick[t]["@attributes"].id),(i=o(e.CustomClick[t].value))&&this.customClicks.push({id:n,url:i})}},this)),e.MediaFiles&&e.MediaFiles.MediaFile&&(e.MediaFiles.MediaFile=[].concat(e.MediaFiles.MediaFile),a.Util.forEachOnArray(e.MediaFiles.MediaFile,function(e){var t=o(e.value),i=NaN,n=NaN,a=null,r="None",s=NaN;e["@attributes"]&&(i=e["@attributes"].width||NaN,n=e["@attributes"].height||NaN,a=e["@attributes"].type,r=e["@attributes"].apiFramework||"None",s=e["@attributes"].bitrate||NaN),t&&-1!==t.indexOf(":")?(e=new l(this),e.init(t,i,n,a,"",s,r,null),e.clickThrough=this.clickThrough,this.vastRenditions.push(e),(isNaN(i)||isNaN(n))&&this.log("continue with missing [width,height]"+[i,n])):this.warn("will ignore this mediaFile because some required field is missing [url,width,height]:"+[t,i,n])},this)),e.TrackingEvents&&this.parseTrackingEvents(e.TrackingEvents,this.setTrackingEvents()),e.AdParameters&&(this.log("parse() get a AdParameters:"+e.AdParameters.value),this.creativeData=e.AdParameters.value),e.Companion&&(e.Companion=[].concat(e.Companion),a.Util.forEachOnArray(e.Companion,function(e){var t=null,i=null,n="",r="",d=null,_=null,c=!1;e.CompanionClickThrough&&(r=o(e.CompanionClickThrough.value)),e.StaticResource&&(t=o(e.StaticResource.value),e.StaticResource["@attributes"]&&(i=e.StaticResource["@attributes"].creativeType),n="static"),e.IFrameResource&&(t=o(e.IFrameResource.value))&&(i="text/html_doc_ref",n="iframe"),e.HTMLResource&&(d=e.HTMLResource["#cdata-section"]||"",d=a.Util.trim(d))&&(i="text/html_doc_lit_mobile",n="HTML"),e.TrackingEvents&&(_=e.TrackingEvents);var h=new E(this.adp);if(h.sequence=this.sequence,h.clickThrough=r,_&&h.parseTrackingEvents(_,h.setTrackingEvents()),e["@attributes"]){var _=e["@attributes"].width||NaN,u=e["@attributes"].height||NaN,e=e["@attributes"].apiFramework||"None";if((t&&-1!==t.indexOf(":")||d)&&!isNaN(_)&&!isNaN(u)&&s(i)||this.adp.isWrapper){var p=new l(h);p.init(t,_,u,i,n,NaN,e,d),p.clickThrough=r,h.vastRenditions.push(p)}else c=!0,this.warn("will ignore this rendition because some required fields is missing or incompatible [creativeType,url,code,width,height]:"+[i,t,d,_,u])}else this.adp.isWrapper||(c=!0,this.warn("for InLine ad package, No attributes found for the Companion ads:"+e));c?this.adp.isWrapper&&this.adp.companionAds.push(h):this.adp.companionAds.push(h)},this)),e.NonLinear&&(e.NonLinear=[].concat(e.NonLinear),a.Util.forEachOnArray(e.NonLinear,function(e){var t=null,i=null,n="",r="",d="",_=null,c=!1;e.AdParameters&&(d=e.AdParameters.value),e.NonLinearClickThrough&&(r=o(e.NonLinearClickThrough.value)),e.StaticResource&&(t=o(e.StaticResource.value),e.StaticResource["@attributes"]&&(i=e.StaticResource["@attributes"].creativeType),n="static"),e.IFrameResource&&(t=o(e.IFrameResource.value),i="text/html_doc_ref",n="iframe"),e.HTMLResource&&(_=e.HTMLResource["#cdata-section"]||"",_=a.Util.trim(_),i="text/html_doc_lit_mobile",n="HTML");var E=new h(this.adp);if(E.sequence=this.sequence,E.clickThrough=r,E._trackingEvents=this._trackingEvents,d&&(E.creativeData=d),e["@attributes"]){var d=e["@attributes"].width||NaN,u=e["@attributes"].height||NaN,e=e["@attributes"].apiFramework||"None";if(!t&&!_||isNaN(d)||isNaN(u)||!s(i))c=!0,this.warn("will ignore this rendition because some required fields is missing or incompatible:[creativeType,url,code,width,height]:"+[i,t,_,d,u]);else{var p=new l(E);p.init(t,d,u,i,n,NaN,e,_),p.clickThrough=r,E.vastRenditions.push(p)}}else this.adp.isWrapper||(c=!0,this.warn("for InLine ad package, No attributes found for the NonLinear ads:"+e));this.adp.nonLinearAds.push(E),c?this.adp.isWrapper&&this.adp.nonLinearAds.push(E):this.adp.nonLinearAds.push(E)},this))},parseLinears:function(e){2!=O?this.log("TargetAdType != TARGET_LINEAR, skipping parse"):this.parse(e)},parseNonLinears:function(e){O!==v?this.log("TargetAdType != TARGET_NONLINEAR, skipping parse"):this.parse(e)},parseCompanionAds:function(e){this.parse(e)},setTrackingEvents:function(){return this._trackingEvents||(this._trackingEvents=new d),this._trackingEvents},parseTrackingEvents:function(e,t){this.log("parseTrackingEvents"),e.Tracking&&(e.Tracking=[].concat(e.Tracking),a.Util.forEachOnArray(e.Tracking,function(e){var i=e["@attributes"].event;if(e=o(e.value))switch(i){case"creativeView":case"start":case"firstQuartile":case"midpoint":case"thirdQuartile":case"complete":case"mute":case"unmute":case"pause":case"resume":case"rewind":case"replay":case"fullscreen":case"expand":case"collapse":case"acceptInvitation":case"stop":t[i].push(e);break;case"close":t.stop.push(e)}},this))},toString:function(){return this.constructor.name+", renditions:"+this.vastRenditions},log:function(e){a.log("VastTranslator."+this.constructor.name+"	"+e)},warn:function(e){a.warn("VastTranslator."+this.constructor.name+"	"+e)}};var M=Object.defineProperty||function(e,t,i){i.get&&e.__defineGetter__(t,i.get),i.set&&e.__defineSetter__(t,i.set)};M(_.prototype,"trackingEvents",{get:function(){return this.log("get trackingEvents()"),this._trackingEvents?this._trackingEvents:this.isDrivingAd?this.adp.trackingEvents:null}}),M(_.prototype,"impressions",{set:function(e){this._impressions=e},get:function(){return this.isDrivingAd?this._impressions.concat(this.adp.impressions):this._impressions}}),_.prototype.constructor=_,c.prototype=new _,c.prototype.constructor=c,h.prototype=new _,h.prototype.constructor=h,E.prototype=new _,E.prototype.getPrimaryRendition=function(){return this.vastRenditions[0]||null},M(E.prototype,"impressions",{get:function(){return 8===O?this._impressions.concat(this.adp.impressions):this._impressions}}),E.prototype.constructor=E;var b=function(){this.impressions=[],this.errorTrackings=[],this.linearAds=[],this.nonLinearAds=[],this.companionAds=[],this.extensions=[],this.tagUrl="",this.isWrapper=!1,this.surveyUrl=null,this.selectedDrivingRenditions=[],this.selectedDrivingAd=null,this.selectedCompanionAds={}};b.prototype={parse:function(e){if(this.log("parse("+e+")"),e)if(e.Creatives&&(this.isWrapper||e.Creatives.Creative)){r(this.impressions,e.Impression),r(this.extensions,e.Extensions),r(this.errorTrackings,e.Error),this.isWrapper&&e.VASTAdTagURI&&(this.tagUrl=e.VASTAdTagURI.value||""),e.Survey&&e.Survey.value&&0<e.Survey.value.length&&(this.surveyUrl=e.Survey.value),e.Creatives.Creative=e.Creatives.Creative?[].concat(e.Creatives.Creative):[];for(var t=0;t<e.Creatives.Creative.length;t++){var i,n=e.Creatives.Creative[t],a=-1;n["@attributes"]&&(a=n["@attributes"].sequence||-1,a*=1),n.Linear?(i=new c(this),i.sequence=a,i.parseLinears(n.Linear),this.linearAds.push(i)):n.NonLinearAds?(i=new h(this),i.sequence=a,i.parseNonLinears(n.NonLinearAds)):n.CompanionAds&&(i=new E(this),i.sequence=a,i.parseCompanionAds(n.CompanionAds))}}else this.warn("parse(): no creative found");else this.warn("parse(): empty adpackage")},testAndUpdatePackageForTemporalSlot:function(e){if(this.log("testAndUpdatePackageForTemporalSlot("+e+")"),e=e?this.linearAds:this.nonLinearAds,1>e.length)return!1;this.log("testAndUpdatePackageForTemporalSlot(), ads.length = "+e.length);var t=!1;if(!t)for(var i=0;i<e.length;i++){var n=this.findRenditionGroupByContentType(e[i]);if(0<n.length){this.log("testAndUpdatePackageForTemporalSlot() : found driving ad and renditions group: "+n),this.selectedDrivingRenditions=n,this.selectedDrivingAd=e[i],t=!0;break}}return t},testAndUpdatePackageForPageSlots:function(e){var t=!1,i=this.companionAds,n=P.slice(0),a=null;if(this.log("testAndUpdatePackageForPageSlots("+e+"), ads are "+i.join(",")+", slots are "+n.join(",")),e){if(a=this.matchAdsToSlots(i,n),0<a.length)for(t=!0,e=0;e<a.length;e++)i=a[e],n=i.ad,this.selectedCompanionAds[i.slot.getCustomId()]=n}else a=this.matchAdsToSlots(i,[N]),1===a.length?(t=!0,this.selectedDrivingAd=a[0].ad):this.selectedDrivingAd=null;return t},renditionFitsInSlot:function(e,t){return e?e.width<=t.getWidth()&&e.height<=t.getHeight():!1},calcDeadSpaceRatio:function(e,t){var i=e.getPrimaryRendition();return i?(this.log("ad w,h  slot w,h"+[i.width,i.height,t.getWidth(),t.getHeight()]),this.renditionFitsInSlot(i,t)?1-i.width*i.height/t.getWidth()*t.getHeight():1):!1},matchAdsToSlots:function(e,t){this.log("matchAdsToSlots(ads="+e.join(",")+", slots="+t.join(",")+")");for(var i=[],n=null,a=null,r=1,s=0;s<e.length;s++)for(var o=e[s],l=0;l<t.length;l++){var d=t[l],_=this.calcDeadSpaceRatio(o,d);r>_&&(n=o,a=d,r=_)}return null!==n&&(i.push({ad:n,slot:a}),e.splice(e.indexOf(n),1),t.splice(t.indexOf(a),1),i=i.concat(this.matchAdsToSlots(e,t))),this.log("matchAdsToSlots: winningAd:"+n+" winningSlot:"+a+" ratio:"+r),i},getAllRenditions:function(e){return e.vastRenditions},findRenditionGroupByContentType:function(e){this.log("findRenditionGroupByContentType:"+e);var t=[];if(e instanceof c&&isNaN(e.duration))return this.warn("findRenditionGroupByContentType(), duration of linear ad is NaN, will not used for scheduling"),t;for(var i=this.getAllRenditions(e),n=0;n<i.length;n++){var r=i[n];if(e instanceof c){if(null==r.creativeType||""==a.Util.trim(r.creativeType)){this.warn("findRenditionGroupByContentType, the contentType "+r.creativeType+" not supported for linearAd");continue}}else if(!s(r.creativeType)){this.warn("findRenditionGroupByContentType, the contentType "+r.creativeType+" not supported for non-linearAd");continue}t.push(r)}return t},formalizeString:function(e){return e?a.Util.trim(e).toLowerCase():""},getAdsByTargetType:function(){this.log("getAdsByTargetType");var e=[];switch(O){case 8:e=this.companionAds;break;case 2:e=this.linearAds;break;case v:e=this.nonLinearAds}for(var t=0;t<e.length;t++)e[t].isDrivingAd=!0;return e},getImpressionOfWrapper:function(){this.log("getImpressionOfWrapper");for(var e=this.getAdsByTargetType(),t=null,i=0;i<e.length;i++){var n=e[i];if(n&&n._impressions&&0<n._impressions.length){t=n._impressions;break}}return t||(t=this.impressions),t},getTrackingEventsOfWrapper:function(){this.log("getTrackingEventsOfWrapper");for(var e=this.getAdsByTargetType(),t=null,i=0;i<e.length;i++){var n=e[i];if(n&&n._trackingEvents){t=n._trackingEvents;break}}return t},getClickThroughOfWrapper:function(){this.log("getClickThroughOfWrapper");for(var e=this.getAdsByTargetType(),t=null,i=0;i<e.length;i++){var n=e[i];if(n){n.clickThrough&&(t=n.clickThrough);for(var n=n.vastRenditions,a=0;a<n.length;a++){var r=n[a];if(r.clickThrough){t=r.clickThrough;break}}if(t)break}}return t},getClickTrackingsOfWrapper:function(){this.log("getClickTrackingsOfWrapper");for(var e=this.getAdsByTargetType(),t=null,i=0;i<e.length;i++){var n=e[i];if(n){n.clickTrackings&&0<n.clickTrackings.length&&(t=n.clickTrackings);for(var n=n.vastRenditions,a=0;a<n.length;a++){var r=n[a];if(r.clickTrackings&&0<r.clickTrackings.length){t=r.clickTrackings;break}}if(t)break}}return t},getCustomClicksOfWrapper:function(){this.log("getCustomClicksOfWrapper");for(var e=this.getAdsByTargetType(),t=null,i=0;i<e.length;i++){var n=e[i];if(n){n.customClicks&&0<n.customClicks.length&&(t=n.customClicks);for(var n=n.vastRenditions,a=0;a<n.length;a++){var r=n[a];if(r.customClicks&&0<r.customClicks.length){t=r.customClicks;break}}if(t)break}}return t},testWrapperForRedirect:function(){return this.log("testAndUpdateWrapperForRedirect()"),this.tagUrl&&0<this.tagUrl.length},log:function(e){a.log("VastTranslator.VastAdPackage	"+e)},warn:function(e){a.warn("VastTranslator.VastAdPackage	"+e)}},b.prototype.constructor=b,u.prototype={getVastVersion:function(e){return this.log("getVastVersion("+e+")"),e?0===e.indexOf("3.")?3:0===e.indexOf("2.")?2:0===e.indexOf("1.")?1:-1:-1},parseAdData:function(t){this.log("parseAdData()");var i,n={};n.selectedPackage=null,n.redirectPackage=null;var r=a.Util.xmlToJson(t);if(r&&r.VAST&&r.VAST["@attributes"]&&2===this.getVastVersion(r.VAST["@attributes"].version)){if(r.VAST.Ad){r.VAST.Ad=[].concat(r.VAST.Ad);var s,o=[],t=[];for(i=0;i<r.VAST.Ad.length;i++)s=new b,s.isWrapper=!!r.VAST.Ad[i].Wrapper,s.isWrapper?(s.parse(r.VAST.Ad[i].Wrapper),t.push(s)):(s.parse(r.VAST.Ad[i].InLine),o.push(s));if(r=!1,0===o.length&&0===t.length)return this.log("parseAdData(): no ads from vast response!!!"),[n];for(this.log("parseAdData(): "+o.length+"inline ads, "+t.length+" wrapper ads."),s=null,i=0;i<o.length;i++)if(this.selectUsableAdsForDrivingSlot(o[i])){this.log("parseAdData(): package for driving slot is found!!!"),s=o[i];break}if(i=0<P.length&&C.getSlot().getTimePositionClass()!==a.TIME_POSITION_CLASS_DISPLAY,s)i&&this.selectUsableAdsCompanionSlots(s)&&this.log("parseAdData(): companion ads are found for companion slots, with driving slot"),n.selectedPackage=s;else if(i){i=!1;for(var l=0;l<o.length;l++)s=o[l],this.selectUsableAdsCompanionSlots(s)&&(this.log("parseAdData(): companion ads are found for companion slots,without driving slot"),n.selectedPackage=s,i=!0);i||(this.log("parseAdData(): companion ads are not found for companion slots,without driving slot"),r=!0)}else this.log("parseAdData(): no usable ads found in vast response!!!"),r=!0;if(r&&0<t.length)for(o=0;o<t.length;o++)if(this.testWrapperForRedirect(t[o])){n.redirectPackage=t[o],this.selectUsableAdsCompanionSlots(t[o])&&this.log("parseAdData(): companion ads are found for wrapper ad");break}return[n]}e.handleStateTransition(a.TRANSLATOR_STATE_FAILED,{errorModule:"VastTranslator",errorCode:a.ERROR_NO_AD_AVAILABLE})}else e.handleStateTransition(a.TRANSLATOR_STATE_FAILED,{errorModule:"VastTranslator",errorCode:a.ERROR_PARSE})},selectUsableAdsForDrivingSlot:function(e){this.log("selectUsableAdsForDrivingSlot()");var t=!0;switch(O){case 2:t=this.testAndUpdatePackageForTemporalSlot(e,!0);break;case v:t=this.testAndUpdatePackageForTemporalSlot(e,!1);break;case 8:t=this.testAndUpdatePackageForPageSlots(e,!1);break;default:t=!1}return t},selectUsableAdsCompanionSlots:function(e){return this.log("selectUsableAdsCompanionSlots(pk)"),this.testAndUpdatePackageForPageSlots(e,!0)},testAndUpdatePackageForTemporalSlot:function(e,t){return this.log("testAndUpdatePackageForTemporalSlot(pk,isLinear), isLinear = "+t),e.testAndUpdatePackageForTemporalSlot(t)},testAndUpdatePackageForPageSlots:function(e,t){return this.log("testAndUpdatePackageForPageSlots(pk,isCompanion) isCompanion = "+t),e.testAndUpdatePackageForPageSlots(t)},testWrapperForRedirect:function(e){return this.log("testWrapperForRedirect(pk)"),e.testWrapperForRedirect()},log:function(e){a.log("VastTranslator.VastParser	"+e)},warn:function(e){a.warn("VastTranslator.VastParser	"+e)}};var V=C.getActiveCreativeRendition().getWrapperUrl(),M=C.getActiveCreativeRendition().getWrapperType();if(t("AdInstance.getActiveCreativeRendition().getWrapperUrl()="+V+", getWrapperType()="+M),"external/vast-2"!==M)e.handleStateTransition(a.TRANSLATOR_STATE_FAILED,{errorModule:"VastTranslator",errorCode:a.ERROR_NO_RENDERER,errorInfo:"wrapperType="+M});else if(V&&0!==V.length){M=e.getParameter("translator.vast.asyncLoad"),M=!0===a.Util.str2bool(M),t("will load vast xml, asyncAjax:"+M);var w=e.getParameter("translator.vast.loadWithCookie"),w=!0===a.Util.str2bool(w),U=null;try{window.XDomainRequest?(U=new XDomainRequest,M=!0):(U=new XMLHttpRequest,U.withCredentials=w),M?(U.open("GET",V),window.XDomainRequest?U.onload=function(){var e=new ActiveXObject("Microsoft.XMLDOM");e.async=!1,e.loadXML(U.responseText),U.responseXML=e,U.status=200,f(U)}:U.onreadystatechange=function(){4==U.readyState&&f(U)},U.onerror=function(){window.XDomainRequest&&(U.status=0),0==U.status?(i("CORS error"),e.handleStateTransition(a.TRANSLATOR_STATE_FAILED,{errorModule:"VastTranslator",errorCode:a.ERROR_SECURITY,errorInfo:V})):(i("exception:"+U.statusText),e.handleStateTransition(a.TRANSLATOR_STATE_FAILED,{errorModule:"VastTranslator",errorInfo:U.statusText}))},U.send()):(U.open("GET",V,!1),U.send(),f(U))}catch(x){if(M=!1,window.XMLHttpRequestException){if(x instanceof XMLHttpRequestException)switch(x.code){case XMLHttpRequestException.NETWORK_ERR:M=!0}}else x.code===DOMException.NETWORK_ERR&&(i("CORS in IE10"),M=!0);M?(i("CORS error:"+x),e.handleStateTransition(a.TRANSLATOR_STATE_FAILED,{errorModule:"VastTranslator",errorCode:a.ERROR_SECURITY,errorInfo:V})):(i("exception:"+x),e.handleStateTransition(a.TRANSLATOR_STATE_FAILED,{errorModule:"VastTranslator",errorInfo:x}))}}else e.handleStateTransition(a.TRANSLATOR_STATE_FAILED,{errorModule:"VastTranslator",errorCode:a.ERROR_NULL_ASSET,errorInfo:"wrapperUrl="+V})},info:function(){return{moduleType:a.MODULE_TYPE_TRANSLATOR}},log:function(e){a.log("VastTranslator	"+e)},warn:function(e){a.warn("VastTranslator	"+e)},getPlayheadTime:function(){return-1},getDuration:function(){return-1}},a.VastTranslator.prototype.constructor=a.VastTranslator,a.VideoAsset=function(e){this._defaultTimeouts=[5,10,15,30,60,120,180,300],this._context=e,this._internalState=a.MediaInitState.instance,this._eventCallback=this._state="",this._callbackTimer=null,this._requestedVideoViewUrl=this._videoPlayPending=!1,this._dummyInstanceId="",this._delay=0,this._location=this._networkId=this._duration=this._customId=this._id="",this._autoPlayType=a.VIDEO_ASSET_AUTO_PLAY_TYPE_ATTENDED,this._viewRandom=this._fallbackId=0},a.VideoAsset.prototype={setVideoAsset:function(e,t,i,n,r,s,o,l){if(e){var d=!1;switch(o){case a.ID_TYPE_FW:d=this._id!=e,this._id=e;break;case a.ID_TYPE_GROUP:d=this._id!="g"+e,this._id="g"+e;break;default:d=this._customId!=e,this._customId=e}d&&(this._eventCallback=""),"number"==typeof t&&(this._duration=Math.round(10*t)/10),1*i>0&&(this._networkId=1*i),"string"==typeof n&&(this._location=n),"number"==typeof r&&(this._autoPlayType=r),1*s>0&&(this._viewRandom=1*s),1*l>0&&(this._fallbackId=1*l),this._videoPlayPending&&this.play()}else a.warn("AdRequest.setVideoAsset","id is required.")},setVideoState:function(e){e===a.VIDEO_STATE_PLAYING?this.play():e===a.VIDEO_STATE_PAUSED||e===a.VIDEO_STATE_STOPPED?this.pause():e===a.VIDEO_STATE_COMPLETED&&this.complete(),this._state=e},callback:function(e){this._eventCallback?this._eventCallback.process():e=!0,e||((e=this._defaultTimeouts.shift())||(e=300),this._callbackTimer=new a.Timer(e,a.Util.bind(this,this.callback)),this._callbackTimer.start())},getPlayheadTime:function(){var e=this._delay;return this._delay=0,e+=this._callbackTimer?this._callbackTimer.getCTValue():0,Math.floor(e)},play:function(){this._context._adManager._serverURL&&this._context._adManager._networkId&&(this._id||this._customId)?this._eventCallback?(this._videoPlayPending=!1,this._internalState.play(this)):this._requestedVideoViewUrl||(this._requestedVideoViewUrl=!0,this.requestForVideoViewCallback(),this._callbackTimer)||(this._callbackTimer=new a.Timer,this._callbackTimer.tick()):(a.warn("Server URL or Network ID or Video Asset id/customId is not set, pend video asset play request."),this._videoPlayPending=!0,this._callbackTimer||(this._callbackTimer=new a.Timer,this._callbackTimer.tick()))},pause:function(){this._internalState.pause(this)},complete:function(){this._internalState.complete(this)},onStartPlaying:function(){this.callback()},onStartReplaying:function(){this.callback()},onPausePlaying:function(){this.callback(!0),this._callbackTimer.pause()},onResumePlaying:function(){this._callbackTimer.start()},onCompletePlaying:function(){this.callback(!0),this._callbackTimer.stop(),this._callbackTimer=null,this._eventCallback="",this._requestedVideoViewUrl=!1},onCompleteReplaying:function(){this.onCompletePlaying()},setMediaState:function(e){this._internalState=e},requestForVideoViewCallback:function(){var e=new a.Context(this._context._adManager);e._videoAsset=this,this._dummyInstanceId=e._instanceId;var e=this._context._adRequest.generateVideoViewRequestUrlWithDummyContextInstanceId(e._instanceId),t=this;a.PLATFORM_SEND_REQUEST_BY_FORM?(a.debug("Context.submitRequest:","use json2"),a.Util.pingURLWithForm(e,this._dummyInstanceId,!0),t._onMessagePosted=function(e){"object"==typeof e.data&&e.data.hasOwnProperty("cbfn")&&-1<e.data.cbfn.indexOf("['Context_"+this._dummyInstanceId+"']")&&t.requestComplete(e.data.response)},window.addEventListener("message",t._onMessagePosted,!1)):a.Util.pingURLWithScript(e)},requestComplete:function(e){if(this._delay=this._callbackTimer.tick(),this._callbackTimer=null,a.PLATFORM_SEND_REQUEST_BY_FORM){window.removeEventListener("message",this._onMessagePosted,!1);var t=document.getElementById("_fw_request_iframe_"+this._dummyInstanceId);document.body.removeChild(t)}null!==e?(a._instanceQueue["Context_"+this._dummyInstanceId]=null,this.parse(a.Util.getObject("siteSection.videoPlayer.videoAsset",e)||{}),this.play()):a.warn("Failed to get video view callback url.")},parse:function(e){if(e){this._customId=e.customId,this._networkId=parseInt(e.networkId);for(var t=0,i=e.eventCallbacks||[];t<i.length;t++){var e=i[t],n=a.EventCallback.newEventCallback(this._context,e.name,e.type);if(n&&e.name===a.EVENT_VIDEO_VIEW){n.parse(e),this._eventCallback=n,a.debug("Parsed video view url: "+this._eventCallback._url);break}}}}},a.VideoRenderer=function(){this._adVideo=null,this._duration=this._playheadTime=-1,this._dragging=this._stopInvoked=this._isEnded=!1},a.VideoRenderer.prototype={start:function(e){var t=e.getAdInstance(),i=t.getSlot(),n=this,r=!1;if(a.PLATFORM_NOT_SUPPORT_VIDEO_AD)e.handleStateTransition(a.RENDERER_STATE_FAILED,{errorModule:"VideoRenderer",errorCode:a.ERROR_DEVICE_LIMIT,errorInfo:i.getTimePositionClass()});else if(a.PLATFORM_NOT_SUPPORT_MIDROLL_AD&&i.getTimePositionClass()===a.TIME_POSITION_CLASS_MIDROLL)e.handleStateTransition(a.RENDERER_STATE_FAILED,{errorModule:"VideoRenderer",errorCode:a.ERROR_DEVICE_LIMIT,errorInfo:"midroll"});else{a.log("VideoRenderer.start",i.getTimePositionClass(),t);var s=e.getContentVideoElement(),o=i.getVideoDisplaySize().width,l=i.getVideoDisplaySize().height,d=t.getRenderableCreativeRenditions(),_=(o=new a.RenditionSelector(e.getParameter(a.PARAMETER_DESIRED_BITRATE)||1e3,e.getParameter("arWeight")||1,e.getParameter("pxWeight")||1,.2).getBestFitRendition(d,o,l))?o.getPrimaryCreativeRenditionAsset():null;
        if(!_&&d.length)e.handleStateTransition(a.RENDERER_STATE_FAILED,{errorModule:"VideoRenderer",errorCode:a.ERROR_DEVICE_LIMIT,errorInfo:"no compatible asset"});else if(_&&_.getUrl()){t.setActiveCreativeRendition(o),a.log("VideoRenderer.start selected rendition is:",_.getUrl()),e.setCapability(a.EVENT_AD_QUARTILE,a.CAPABILITY_STATUS_ON);var c=!a.PLATFORM_NOT_SUPPORT_CLICK_FOR_VIDEO;c||e.setCapability(a.EVENT_AD_CLICK,a.CAPABILITY_STATUS_OFF);var h=a.PLATFORM_EVENT_CLICK,E=a.MOBILE_EVENT_DRAG;a.debug("VideoRenderer","use content video element"),s.controls=!1,this._adVideo=s;var u,p,T=null,A=null,g=null,R=function(e){a.debug("VideoRenderer.checkTimeUpdate timeout"),L(e)},m=function(){A&&(clearTimeout(A),A=null)},I=a.Util.bind(this,function(t){a.debug("onAdVideoBufferEmpty(): Ad video event "+t.type),t=e.getParameter(a.PARAMETER_RENDERER_VIDEO_PLAY_AFTER_STALLED),null==t||"undefined"==typeof t||!1===a.Util.str2bool(t)||(a.debug("play the ad immediately after the stalled event"),s&&s._fw_videoAdPlaying&&s.play())}),f=a.Util.bind(this,function(t){if(s.paused&&a.PLATFORM_NOT_FIRE_CLICK_WHEN_AD_VIDEO_PAUSED)s.play();else if(!e.getParameter(a.PARAMETER_EXTENSION_AD_CONTROL_CLICK_ELEMENT)){var i=e.getParameter(a.PARAMETER_RENDERER_VIDEO_CLICK_DETECTION);null==i&&(i="true"),!1!==a.Util.str2bool(i)&&(a.debug("Ad video event "+t.type),this._dragging?this._dragging=!1:e.processEvent({name:a.EVENT_AD_CLICK}))}}),S=a.Util.bind(this,function(e){a.debug("Ad video event "+e.type),this._dragging=!0}),v=function(t){if(a.debug("Ad video event "+t.type+" ended: "+s.ended+" playing:"+s._fw_videoAdPlaying),s.ended&&.2>Math.abs(s.duration-s.currentTime)||!s._fw_videoAdPlaying)u=setTimeout(function(){a.warn("Force ad video end bc ad paused with ended = true"),t.type="ended",p(t)},200);else{var i=e.getParameter(a.PARAMETER_RENDERER_VIDEO_DISPLAY_CONTROLS_WHEN_PAUSE);null==i&&(i="true"),!1===a.Util.str2bool(i)?a.debug("Pause controls disabled"):s.controls=!0,m()}},C=function(e){a.debug("Ad video event "+e.type),s.controls=!1},N=!1,O=0,P=function(){if(m(),!s.paused){var t=e.getParameter(a.PARAMETER_RENDERER_VIDEO_PROGRESS_DETECT_TIMEOUT)||8e3;A=setTimeout(R,t,t+"ms timeout when playing")}N||(N=!0,n._playheadTime=s.currentTime,0>n._playheadTime&&(n._playheadTime=0),T&&(clearTimeout(T),T=null),n._quartileTimerId=setInterval(function(){var t=s.currentTime,i=s.duration;t>0&&(n._playheadTime=t),i>0&&(n._duration=i),"number"!=typeof t||"number"!=typeof i||g||(t>=.25*i&&1>O&&(e.processEvent({name:a.EVENT_AD_FIRST_QUARTILE}),O=1),t>=.5*i&&2>O&&(e.processEvent({name:a.EVENT_AD_MIDPOINT}),O=2),t>=.75*i&&3>O&&(clearInterval(n._quartileTimerId),n._quartileTimerId=null,e.processEvent({name:a.EVENT_AD_THIRD_QUARTILE}),O=3))},1e3),e.handleStateTransition(a.RENDERER_STATE_STARTED))};this.dispose=a.Util.bind(this,function(){p()}),p=function(t){var i=g;t&&t.type&&(a.debug("Ad video event "+t.type),"error"===t.type&&(a.warn(t.target.src),a.warn(t.target.currentSrc))),m(),T&&(clearTimeout(T),T=null),c&&(s.removeEventListener(h,f,!1),s.removeEventListener(E,S,!1)),u&&(clearTimeout(u),u=null),s.removeEventListener("ended",p,!1),s.removeEventListener("error",p,!0),s.removeEventListener("pause",v,!1),s.removeEventListener("playing",C,!1),s.removeEventListener("timeupdate",P,!1),s.removeEventListener("stalled",I,!1),s.paused||(a.debug("try pausing video before complete"),s.pause()),t&&"error"===t.type&&(i="video error",(t=s.error||t.target.error)&&(i="error:"+t+",code:"+t.code)),i||(n._isEnded=!0),a.log("VideoRenderer.complete"),r||(r=!0,delete s._fw_videoAdPlaying,n._adVideo=null,n._quartileTimerId&&(clearInterval(n._quartileTimerId),n._quartileTimerId=null),i?e.handleStateTransition(a.RENDERER_STATE_FAILED,{errorModule:"VideoRenderer",errorInfo:i}):(n._stopInvoked||(s.currentTime>=.25*s.duration&&1>O&&(e.processEvent({name:a.EVENT_AD_FIRST_QUARTILE}),O=1),s.currentTime>=.5*s.duration&&2>O&&(e.processEvent({name:a.EVENT_AD_MIDPOINT}),O=2),s.currentTime>=.75*s.duration&&3>O&&(e.processEvent({name:a.EVENT_AD_THIRD_QUARTILE}),O=3),s.currentTime>=s.duration-.5&&4>O&&(e.processEvent({name:a.EVENT_AD_COMPLETE}),O=4)),n._stopInvoked=!1,e.handleStateTransition(a.RENDERER_STATE_COMPLETED)))};var L=function(e){g=e,a.warn(g),a.PLATFORM_WAIT_WHEN_AD_VIDEO_TIMEOUT||p()};s._fw_videoAdPlaying=!0;var y=!1,D=function(){if(!y){if(y=!0,c&&(s.addEventListener(h,f,!1),s.addEventListener(E,S,!1)),s.addEventListener("ended",p,!1),s.addEventListener("error",p,!0),s.addEventListener("pause",v,!1),s.addEventListener("playing",C,!1),s.addEventListener("timeupdate",P,!1),s.addEventListener("stalled",I,!1),s.src=_.getUrl(),a.log("VideoRenderer play video ad "+s.src),s.load(),s._fw_fromVideoPool||a.PLATFORM_SUPPORT_VIDEO_START_DETECT_TIMEOUT){var t=e.getParameter(a.PARAMETER_RENDERER_VIDEO_START_DETECT_TIMEOUT)||5e3;T=setTimeout(L,t,t+"ms timeout before playing")}a.PLATFORM_VIDEO_DOESNOT_SUPPORT_TIMEUPDATE&&e.handleStateTransition(a.RENDERER_STATE_STARTED),0<a.PLATFORM_ANDROID_VERSION?(t=e.getParameter(a.PARAMETER_RENDERER_VIDEO_ANDROID_DELAY)||100,setTimeout(function(){s.play()},t)):setTimeout(function(){s.play()},100)}};a.VideoRenderer._fw_playedDummyVideo||i.getTimePositionClass()!==a.TIME_POSITION_CLASS_PREROLL||!a.PLATFORM_PLAY_DUMMY_VIDEO_FOR_PREROLL||/\.webm$/.test(_.getUrl())?D():(a.VideoRenderer._fw_playedDummyVideo=!0,a.debug("play dummy video for iOS 3.2-4.1"),s.src="http://127.0.0.1:1/404.mp4",s.load(),s.play(),s._fw_videoAdPlaying=!0,s.addEventListener("error",function(){event.target.removeEventListener("error",arguments.callee,!0),D()},!0),setTimeout(D,a.PLATFORM_NOT_WAIT_FOR_ERROR_WHEN_PLAY_DUMMY_VIDEO_FOR_PREROLL?500:5e3))}else e.handleStateTransition(a.RENDERER_STATE_FAILED,{errorModule:"VideoRenderer",errorCode:a.ERROR_NULL_ASSET})}},stop:function(){a.debug("VideoRenderer stop"),this._stopInvoked=!0,this._adVideo&&(this._adVideo._fw_videoAdPlaying=!1,this._adVideo.pause(),this.dispose())},info:function(){return{moduleType:a.MODULE_TYPE_RENDERER}},getPlayheadTime:function(){if(this._isEnded&&0<this._duration)return this._duration;if(this._adVideo){var e=this._adVideo.currentTime;if(e>0)return e}return this._playheadTime},getDuration:function(){return this._duration}},a.VideoRenderer.prototype.constructor=a.VideoRenderer,a.VideoStateExtension=function(e){this._context=e},a.VideoStateExtension.prototype={_enabled:function(){if(null==this._context)return!1;var e=this._context.getParameter(a.PARAMETER_EXTENSION_VIDEO_STATE_ENABLED);return null==e&&(e="false"),!0===a.Util.str2bool(e)},start:function(){this._enabled()?this._context.setVideoState(a.VIDEO_STATE_PLAYING):a.log("VideoStateExtension is disabled.")},dispose:function(){this._context=null}},a.VideoStateExtension.prototype.constructor=a.VideoStateExtension,a.VPAIDWrapper=function(){this._creative=null,this._timeoutInMs=0,this._eventHandlers={},this._loadIntervalTimer=this._timeoutTimer=null,this._timeoutOperation="",this.timeoutReached=!1,this._visibilityChangeListener=null},a.VPAIDWrapper.prototype={_isCreativeFunctionInvokable:function(e){return this._creative?!(!(e=this._creative[e])||"function"!=typeof e):!1},checkVPAIDInterface:function(e){for(var t={passed:!0,missingInterfaces:""},i=e.length-1;i>=0;i--)this._isCreativeFunctionInvokable(e[i])||(t.passed=!1,t.missingInterfaces+=e[i]+" ");return t},loadCreativeAsset:function(e){a.log("loadCreativeAsset("+e+")");var t=document.getElementById("vpaidFrame"),i=document.createElement("iframe");i.id="vpaidFrame",null==t?document.body.appendChild(i):document.body.replaceChild(i,t),i.width=0,i.height=0,i.style.display="none",i.contentWindow.document.open(),i.contentWindow.document.write('<script type="text/javascript" src="'+e+'"> </script>'),i.contentWindow.document.close(),this._timeoutOperation="loadCreativeAsset",this._waitForTimeout();var n=this;this._loadIntervalTimer=setInterval(function(){var e=document.getElementById("vpaidFrame").contentWindow.getVPAIDAd;e&&"function"==typeof e&&(clearInterval(n._loadIntervalTimer),e=e(),"undefined"==typeof e?a.debug("getVPAIDAd() returns undefined value"):null===e?a.debug("getVPAIDAd() returns null"):(n._creative=e,n._eventHandlers.CreativeAssetLoaded()))},200)},setCallbacksForCreative:function(e,t){for(var i in e)e.hasOwnProperty(i)&&this._creative.subscribe(e[i],i,t)},removeCallbacksForCreative:function(e){for(var t in e)e.hasOwnProperty(t)&&this._creative.unsubscribe(e[t],t)},handshakeVersion:function(e){return a.log("VPAID Creative: handshakeVersion("+e+")"),this._creative.handshakeVersion(e)},initAd:function(e,t,i,n,r,s){a.log("VPAID Creative: initAd()"),this._timeoutOperation="initAd",this._waitForTimeout(),this._creative.initAd(e,t,i,n,r,s)},startAd:function(){a.log("VPAID Creative: startAd()"),this._timeoutOperation="startAd",this._waitForTimeout(),this._creative.startAd()},stopAd:function(){a.log("VPAID Creative: stopAd()"),"startAd"===this._timeoutOperation?(clearTimeout(this._timeoutTimer),this._timeoutOperation="startAd and stopAd"):this._timeoutOperation+="stopAd",this._waitForTimeout(),this._creative.stopAd()},canPauseAd:function(){return this._isCreativeFunctionInvokable("pauseAd")},canResumeAd:function(){return this._isCreativeFunctionInvokable("resumeAd")},canResizeAd:function(){return this._isCreativeFunctionInvokable("resizeAd")},pauseAd:function(){this.canPauseAd()&&(a.log("VPAID Creative: pauseAd()"),this._creative.pauseAd())},resumeAd:function(){this.canResumeAd()&&(a.log("VPAID Creative: resumeAd()"),this._creative.resumeAd())},resizeAd:function(e,t,i){this.canResizeAd()?(a.log("VPAID Creative: resizeAd()"),this._creative.resizeAd(e,t,i)):a.log("The creative is not able to resize")},getAdVolume:function(){return this._isCreativeFunctionInvokable("getAdVolume")?this._creative.getAdVolume():-1},getAdExpanded:function(){return this._isCreativeFunctionInvokable("getAdExpanded")?this._creative.getAdExpanded():!1},getAdRemainingTime:function(){return this._isCreativeFunctionInvokable("getAdRemainingTime")?this._creative.getAdRemainingTime():-1},getAdDuration:function(){return this._isCreativeFunctionInvokable("getAdDuration")?this._creative.getAdDuration():-1},getAdLinear:function(){return this._creative.getAdLinear()},getAdCompanions:function(){return this._isCreativeFunctionInvokable("getAdCompanions")?this._creative.getAdCompanions():""},setTimeoutValueInMs:function(e){this._timeoutInMs=e},cancelTimeoutEvent:function(){var e="startAd and stopAd"!==this._timeoutOperation;if(clearTimeout(this._timeoutTimer),!e){this._timeoutOperation="startAd";var t=this;setTimeout(function(){t._eventHandlers.timeout.call()},500)}},addEventListener:function(e,t){this._eventHandlers[e]=t},removeEventListener:function(e){this._eventHandlers[e]=null},_waitForTimeout:function(){if(a.log("Wait for "+this._timeoutOperation+" for "+this._timeoutInMs+"ms"),this._eventHandlers.timeout){var e=this;this._timeoutTimer=setTimeout(function(){e.timeoutReached||(e.timeoutReached=!0),"startAd"===e._timeoutOperation?e.stopAd():("loadCreativeAsset"===e._timeoutOperation&&clearInterval(e._loadIntervalTimer),e._eventHandlers.timeout.call())},this._timeoutInMs)}},getTimeoutOperation:function(){return this._timeoutOperation}},a.VPAIDWrapper.prototype.constructor=a.VPAIDWrapper,a.VPAIDRenderer=function(){this.vpaidCreative=this.rendererController=null,this.vpaidVolume=this.vpaidDuration=-1,this.creativeEventCallbacks={},this.isMuted=!1,this.adPlaybackState="",this.creativeTimeoutDelayInMs=1e4,this.vpaidDesiredBitrate=268,this.vpaidViewmode="normal",this.playheadTime=0,this.videoBase=document.createElement("div"),this.videoParent=null,this.SUPPORTED_CREATIVE_VPAID_VERSION_MIN=this.PLAYER_VPAID_VERSION=2},a.VPAIDRenderer.prototype={},a.VPAIDRenderer.prototype.constructor=a.VPAIDRenderer,a.VPAIDRenderer.VastCompanion=function(e,t,i,n){this._width=e,this._height=t,this._apiFramework=i,this._xmlNode=n},a.VPAIDRenderer.VastCompanion.prototype={getWidth:function(){return this._width},getHeight:function(){return this._height},_isValidResource:function(e,t){return"StaticResource"===e&&t["@attributes"].creativeType||"IFrameResource"===e&&t.value||"HTMLResource"===e&&t.value},hasValidRendtions:function(){for(var e in this._xmlNode)if(this._xmlNode.hasOwnProperty(e)&&("StaticResource"===e||"IFrameResource"===e||"HTMLResource"===e))for(var t=[].concat(this._xmlNode[e]),i=t.length-1;i>=0;i--)if(this._isValidResource(e,t[i]))return!0;return!1},translateToAdInstance:function(e){if(this._xmlNode.CompanionClickThrough&&e.setClickThroughUrl(a.EVENT_AD_CLICK,this._xmlNode.CompanionClickThrough.value),this._xmlNode.TrackingEvents){var t=this._xmlNode.TrackingEvents;if(t.Tracking){for(var t=[].concat(t.Tracking),i=[],n=t.length-1;n>=0;n--)"creativeView"===t[n]["@attributes"].event&&i.push(t[n].value);0<i.length&&e.addEventCallbackUrls(a.EVENT_AD_IMPRESSION,a.EVENT_TYPE_IMPRESSION,i)}}for(var r in this._xmlNode)if(this._xmlNode.hasOwnProperty(r)&&("StaticResource"===r||"IFrameResource"===r||"HTMLResource"===r))for(t=[].concat(this._xmlNode[r]),n=t.length-1;n>=0;n--)if(this._isValidResource(r,t[n])){var i=t[n],s=e.addCreativeRendition();s.setWidth(this._width),s.setHeight(this._height),s.setCreativeApi("None");var o=s.addCreativeRenditionAsset("VPAIDAsset"+n,!0);o.setContentType("text/html_doc_lit_mobile"),o.setMimeType("text/html");var l=e.getEventCallbackUrls(a.EVENT_AD_CLICK,a.EVENT_TYPE_CLICK)[0],d=r;"HTMLResource"===d?o.setContent(a.HTMLAdGenerator.wrapUnsafeHTML(i.value,e.getSlot().getCustomId(),this._width,this._height)):("IFrameResource"===d?creativeType="iframe":"StaticResource"===d&&(creativeType=this._xmlNode.creativeType),o.setContent(a.HTMLAdGenerator.generateAd(i.value,l,e.getSlot().getCustomId(),this._width,this._height,creativeType,o.getContentType()))),a.debug("rendtion width: "+s.getWidth()+" height:"+s.getHeight()+" asset content:"+o.getContent())}}},a.VPAIDRenderer.VastCompanion.prototype.constructor=a.VPAIDRenderer.VastCompanion,a.VPAIDRenderer.VastAdSelect=function(){},a.VPAIDRenderer.VastAdSelect.prototype={_getDeadSpaceRatio:function(e,t){var i=e.getWidth(),n=e.getHeight(),r=t.getWidth(),s=t.getHeight(),o=1;return r>=i&&s>=n&&(o=1-i*n/(r*s)),a.debug("computing dead space ratio ("+o+") for slot "+r+"x"+s+" and ad "+i+"x"+n),o},matchAdsWithSlots:function(e,t){a.log("VPAIDRenderer: Matching ads with slots");for(var i=0;i<t.length;++i)t[i].matched=!1;for(var n=[],r=[],i=0;i<e.length;i++)for(var s=0;s<t.length;s++)r.push({ratio:this._getDeadSpaceRatio(e[i],t[s]),adIndex:i,slotIndex:s});for(r.sort(function(e,t){return e.ratio-t.ratio}),i=0;i<r.length&&1!=r[i].ratio;i++){var s=r[i],o=e[s.adIndex],l=t[s.slotIndex];o.matched||l.matched||(a.log("Winning ratio:"+s.ratio+" Winning ad:"+o.getWidth()+"x"+o.getHeight()+" for slot:"+l.getWidth()+"x"+l.getHeight()),n.push({ad:o,slot:l}),o.matched=!0,l.matched=!0)}return n}},a.VPAIDRenderer.VastAdSelect.prototype.constructor=a.VPAIDRenderer.VastAdSelect,a.Util.mixin(a.VPAIDRenderer.prototype,{_failWithError:function(e,t){this.rendererController.handleStateTransition(a.RENDERER_STATE_FAILED,{errorModule:"VPAIDRenderer",errorCode:e,errorInfo:t}),this.dispose()},onCreativeTimeout:function(){a.log("VPAIDRenderer: onCreativeTimeout()");var e=this.vpaidCreative.getTimeoutOperation();this._failWithError(a.ERROR_TIMEOUT,"loadCreativeAsset"!==e?"Creative function "+e+" timeout":"load creative asset timeout")},onAdVolumeChange:function(){a.log("VPAIDRenderer: onAdVolumeChange()");var e=this.vpaidCreative.getAdVolume();0>e||e>1?a.log("Invalid ad volume value"):this.isMuted&&100*e>2?(this.isMuted=!1,this.rendererController.processEvent({name:a.EVENT_AD_UNMUTE})):!this.isMuted&&2>100*e&&(this.isMuted=!0,this.rendererController.processEvent({name:a.EVENT_AD_MUTE}))},onAdExpandedChange:function(){a.log("VPAIDRenderer: onAdExpandedChange()"),this.vpaidCreative.getAdExpanded()?this.rendererController.processEvent({name:a.EVENT_AD_EXPAND}):this.rendererController.processEvent({name:a.EVENT_AD_COLLAPSE})},onAdDurationChange:function(){a.log("VPAIDRenderer: onAdDurationChange(): duration changed to "+this.vpaidCreative.getAdDuration())},onAdClickThru:function(e,t,i){a.log("VPAIDRenderer: onAdClickThru() with url:"+e+" id:"+t+" playerHandles:"+i),t={name:tv.freewheel.SDK.EVENT_AD_CLICK,info:{}},t.info[a.INFO_KEY_SHOW_BROWSER]=!0===i,!0===i?e?(a.log("onAdClickThru(): open window with overrided url"),t.info[a.INFO_KEY_URL]=e):a.log("onAdClickThru(): open window with url booked in MRM UI or VAST clickthru url"):a.log("onAdClickThru(): send click tracking"),this.rendererController.processEvent(t)},onCreativeAssetLoaded:function(){a.log("VPAIDRenderer: onCreativeAssetLoaded()"),this.vpaidCreative.cancelTimeoutEvent();var e=this,t=function(){var t=e.vpaidCreative.handshakeVersion(e.PLAYER_VPAID_VERSION.toFixed(1));return t?parseFloat(t)<e.SUPPORTED_CREATIVE_VPAID_VERSION_MIN?(e._failWithError(a.ERROR_INVALID_VALUE,"Only support creatives with VPAID version >= "+e.SUPPORTED_CREATIVE_VPAID_VERSION_MIN.toFixed(1)),!1):!0:(e._failWithError(a.ERROR_3P_COMPONENT,"Cannot get VPAID version from the creative"),!1)};if(function(){var t=e.vpaidCreative.checkVPAIDInterface("handshakeVersion,initAd,startAd,stopAd,subscribe,unsubscribe,getAdLinear".split(","));return t.passed||e._failWithError(a.ERROR_3P_COMPONENT,"Missing interfaces in the VPAID creative: "+t.missingInterfaces),t.passed}()&&t()){!function(){(param=e.rendererController.getParameter(a.PARAMETER_VPAID_CREATIVE_TIMEOUT_DELAY))&&0<Number(param)&&(e.creativeTimeoutDelayInMs=Number(param)),a.log("initParams(), creative timeout delay in miliseconds:"+e.creativeTimeoutDelayInMs);var t=parseFloat(e.rendererController.getParameter(a.PARAMETER_DESIRED_BITRATE));e.vpaidDesiredBitrate=t>0?t:e.vpaidDesiredBitrate,a.log("initParams(), desired bitrate: "+e.vpaidDesiredBitrate)}(),e.creativeEventCallbacks={AdStarted:e.onAdStarted,AdStopped:e.onAdStopped,AdSkipped:e.onAdSkipped,AdLoaded:e.onAdLoaded,AdLinearChange:e.onAdLinearChange,AdSizeChange:e.onAdSizeChange,AdExpandedChange:e.onAdExpandedChange,AdDurationChange:e.onAdDurationChange,AdVolumeChange:e.onAdVolumeChange,AdImpression:e.onAdImpression,AdClickThru:e.onAdClickThru,AdVideoFirstQuartile:e.onAdVideoFirstQuartile,AdVideoMidpoint:e.onAdVideoMidpoint,AdVideoThirdQuartile:e.onAdVideoThirdQuartile,AdVideoComplete:e.onAdVideoComplete,AdUserAcceptInvitation:e.onAdUserAcceptInvitation,AdUserMinimize:e.onAdUserMinimize,AdUserClose:e.onAdUserClose,AdPaused:e.onAdPaused,AdPlaying:e.onAdResumed,AdError:e.onAdError,AdLog:e.onAdLog},e.vpaidCreative.setCallbacksForCreative(e.creativeEventCallbacks,e),this.rendererController.setCapability(a.EVENT_AD_QUARTILE,a.CAPABILITY_STATUS_ON),this.rendererController.setCapability(a.EVENT_AD_MUTE,a.CAPABILITY_STATUS_ON),this.rendererController.setCapability(a.EVENT_AD_EXPAND,a.CAPABILITY_STATUS_ON),this.rendererController.setCapability(a.EVENT_AD_PAUSE,a.CAPABILITY_STATUS_ON),this.rendererController.setCapability(a.EVENT_AD_CLOSE,a.CAPABILITY_STATUS_ON),this.rendererController.setCapability(a.EVENT_AD_MINIMIZE,a.CAPABILITY_STATUS_ON),this.rendererController.setCapability(a.EVENT_AD_ACCEPT_INVITATION,a.CAPABILITY_STATUS_ON),(t=this.rendition?this.rendition.getParameter("VPAID_creativeData"):null)&&(t=a.Util.trim(t));var t={AdParameters:t},i=this.rendererController.getAdInstance().getSlot();this.videoBase.style.width="0px",this.videoBase.style.height="0px",this.videoBase.style.zIndex="100000",this.videoBase.style.position="absolute",this.videoBase.style.left=this.rendererController.getContentVideoElement().style.left,this.videoBase.style.top=this.rendererController.getContentVideoElement().style.top,this.videoParent=i.getBase();var n=this.rendererController.getContentVideoElement();if("nodeType"in n&&0<n.nodeType)try{this.videoParent.insertBefore(this.videoBase,this.rendererController.getContentVideoElement())}catch(r){this.videoParent.insertBefore(this.videoBase,this.videoParent.firstChild)}else this.videoParent.insertBefore(this.videoBase,this.videoParent.firstChild);var n={slot:this.videoBase,videoSlot:this.rendererController.getContentVideoElement(),videoSlotCanAutoPlay:!0},s=i.getWidth(),i=i.getHeight();s&&i||!this.rendition||(s=this.rendition.getWidth,i=this.rendition.getHeight),this.vpaidCreative.initAd(s,i,this.vpaidViewmode,this.vpaidDesiredBitrate,t,n)}},onAdLoaded:function(){a.log("VPAIDRenderer: onAdLoaded()"),this.vpaidCreative.cancelTimeoutEvent(),a.log("Ad duration:"+this.getDuration());var e=this,t=function(t,i){if(a.debug(i.length+" companion slots to fill."),0!==i.length&&0!==t.length){var n=(new a.VPAIDRenderer.VastAdSelect).matchAdsWithSlots(t,i);if(0!==n.length){for(var t=[],i=[],r=n.length-1;r>=0;r--)t.push(n[r].ad),i.push(n[r].slot);for(n=e.rendererController.scheduleAdInstances(i),r=n.length-1;r>=0;r--)t[r].translateToAdInstance(n[r])}}},i=function(e){if(!e)return a.log("The adCompanions property is empty."),null;if(a.log("parsing adCompanions: "+e),xmlDoc=null,window.DOMParser?xmlDoc=(new DOMParser).parseFromString(e,"text/xml"):(xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),xmlDoc.async=!1,xmlDoc.loadXML(e)),e=a.Util.xmlToJson(xmlDoc),!e||!e.CompanionAds||!e.CompanionAds.Companion)return a.log("No companion ads found in parsed xml"),[];for(var e=[].concat(e.CompanionAds.Companion),t=[],i=e.length-1;i>=0;i--){var n=e[i];if(n["@attributes"]){var r=n["@attributes"].width,s=n["@attributes"].height;if(!r||!s||0>r||0>s)a.log("Missing width/height for companion.");else{var o=n["@attributes"].apiFramework||"";a.debug("Companion "+r+"x"+s+" api:"+o),n=new a.VPAIDRenderer.VastCompanion(r,s,o,n),n.hasValidRendtions()&&t.push(n)}}}return t}(e.vpaidCreative.getAdCompanions());i&&0<i.length?t(i,this.rendererController.getCompanionSlots()):a.log("VPAIDAdRenderer: No companions from VPAID creative."),this.vpaidCreative.startAd()},onVisibilityChange:function(){a.log("onVisibilityChange:"+(document.hidden?"invisible":"visible")),a.log("Current playback state:"+this.adPlaybackState),document.hidden&&"playing"==this.adPlaybackState?(a.log("Pause the VPAID creative"),this.adPlaybackState="pausing",this.vpaidCreative.pauseAd()):!document.hidden&&("paused"==this.adPlaybackState||8>a.PLATFORM_IOS_VERSION)&&(a.log("Resume the VPAID creative"),this.adPlaybackState="resuming",this.vpaidCreative.resumeAd())},onAdStarted:function(){a.log("VPAIDRenderer: onAdStarted()"),this.vpaidCreative.timeoutReached?a.log("VPAID ad has already failed due to timeout. The AdStarted event will not be handled."):(this.vpaidCreative.cancelTimeoutEvent(),(7<=a.PLATFORM_IOS_VERSION||4.4<=a.PLATFORM_ANDROID_VERSION)&&(this._visibilityChangeListener=this.onVisibilityChange.bind(this),document.addEventListener("visibilitychange",this._visibilityChangeListener,!1)))},onAdStopped:function(){a.log("VPAIDRenderer: onAdStopped()"),this.vpaidCreative.cancelTimeoutEvent(),this.timePositionClass===a.TIME_POSITION_CLASS_OVERLAY&&this.vpaidCreative.getAdLinear()&&this.rendererController.requestContentStateChange(!1),this.vpaidCreative&&!this.vpaidCreative.timeoutReached&&(this.rendererController.handleStateTransition(a.RENDERER_STATE_COMPLETED),this.dispose())},onAdImpression:function(){if(a.log("VPAIDRenderer: onAdImpression()"),this.vpaidCreative.timeoutReached)a.log("VPAID ad has already failed due to timeout. The AdImpression event will not be handled.");else{var e=this.vpaidCreative.getAdVolume();this.isMuted=e>0&&2>=100*e,this.adPlaybackState="playing",this.rendererController.handleStateTransition(a.RENDERER_STATE_STARTED)}},onAdLinearChange:function(){a.log("VPAIDRenderer: onAdLinearChange()");var e=this.vpaidCreative.getAdLinear();e?a.log("onAdLinearChange(): non-linear click to linear -> request content video to pause"):a.log("onAdLinearChange(): linear back to non-linear -> request content video to resume"),this.rendererController.requestContentStateChange(e)},onAdSizeChange:function(){a.log("VPAIDRenderer: onAdSizeChange()")},onAdPaused:function(){a.log("VPAIDRenderer: onAdPaused()"),"playing"===this.adPlaybackState&&this.rendererController.processEvent({name:a.EVENT_AD_PAUSE}),this.adPlaybackState="paused"},onAdResumed:function(){a.log("VPAIDRenderer: onAdResumed()"),"paused"===this.adPlaybackState&&this.rendererController.processEvent({name:a.EVENT_AD_RESUME}),this.adPlaybackState="playing"},onAdSkipped:function(){a.log("VPAIDRenderer: onAdSkipped()"),this.dispose(),this.rendererController.handleStateTransition(a.RENDERER_STATE_COMPLETED)},onAdVideoFirstQuartile:function(){a.log("VPAIDRenderer: onAdVideoFirstQuartile()"),this.rendererController.processEvent({name:a.EVENT_AD_FIRST_QUARTILE})},onAdVideoMidpoint:function(){a.log("VPAIDRenderer: onAdVideoMidpoint()"),this.rendererController.processEvent({name:a.EVENT_AD_MIDPOINT})},onAdVideoThirdQuartile:function(){a.log("VPAIDRenderer: onAdVideoThirdQuartile()"),this.rendererController.processEvent({name:a.EVENT_AD_THIRD_QUARTILE})},onAdVideoComplete:function(){a.log("VPAIDRenderer: onAdVideoComplete"),this.rendererController.processEvent({name:a.EVENT_AD_COMPLETE})},onAdUserAcceptInvitation:function(){a.log("VPAIDRenderer: onAdUserAcceptInvitation()"),this.rendererController.processEvent({name:a.EVENT_AD_ACCEPT_INVITATION})},onAdUserClose:function(){a.log("VPAIDRenderer: onAdUserClose()"),this.rendererController.processEvent({name:a.EVENT_AD_CLOSE})},onAdUserMinimize:function(){a.log("VPAIDRenderer: onAdUserMinimize()"),this.rendererController.processEvent({name:a.EVENT_AD_MINIMIZE})},onAdLog:function(e){a.log("VPAIDRenderer: onAdLog: "+e)},onAdError:function(e){a.log("VPAIDRenderer: onAdError(): "+e),this._failWithError(a.ERROR_3P_COMPONENT,"AdError event:"+e)},start:function(e){var t;if(a.log("VPAIDRenderer start()"),this.rendererController=e,this.timePositionClass=e.getAdInstance().getSlot().getTimePositionClass(),t=(this.rendition=e.getAdInstance().getActiveCreativeRendition())?this.rendition.getPrimaryCreativeRenditionAsset():null,e=(e=t)?e.getUrl():null){this.vpaidCreative=new a.VPAIDWrapper,this.vpaidCreative.setTimeoutValueInMs(this.creativeTimeoutDelayInMs),this.vpaidCreative.addEventListener("timeout",this.onCreativeTimeout.bind(this)),this.vpaidCreative.addEventListener("CreativeAssetLoaded",this.onCreativeAssetLoaded.bind(this));try{this.vpaidCreative.loadCreativeAsset(e)}catch(i){this._failWithError(a.ERROR_IO,i)}}else this._failWithError(a.ERROR_NULL_ASSET,"Creative asset url cannot be null")},stop:function(){a.log("VPAIDRenderer stop()"),this.vpaidCreative.stopAd()},info:function(){return{moduleType:a.MODULE_TYPE_RENDERER}},getPlayheadTime:function(){var e=this.vpaidCreative.getAdDuration(),t=this.vpaidCreative.getAdRemainingTime();return e>=0&&t>=0&&(this.playheadTime=e-t),0>this.playheadTime&&(this.playheadTime=-1),this.playheadTime},getDuration:function(){var e=this.vpaidCreative.getAdDuration();return e>=0?e:-1},pause:function(){a.log("VPAIDRenderer pause()"),this.rendererController.processEvent({name:a.EVENT_AD_PAUSE}),this.vpaidCreative.canPauseAd()?"playing"==this.vpaidCreative.adPlaybackState&&(this.adPlaybackState="pausing",this.vpaidCreative.pauseAd()):a.log("The creative is not able to pause")},resume:function(){a.log("VPAIDRenderer resume()"),this.rendererController.processEvent({name:a.EVENT_AD_RESUME}),this.vpaidCreative.canResumeAd()?"paused"==this.vpaidCreative.adPlaybackState&&(this.adPlaybackState="resuming",this.vpaidCreative.resumeAd()):a.log("The creative is not able to resume")},dispose:function(){a.log("VPAIDRenderer dispose()"),this.vpaidCreative&&(this.videoParent&&(this.videoParent.removeChild(this.videoBase),this.videoParent=null),this._visibilityChangeListener&&(a.log("remove visibilitychange listener"),document.removeEventListener("visibilitychange",this._visibilityChangeListener,!1)),this.vpaidCreative.removeCallbacksForCreative(this.creativeEventCallbacks),this.vpaidCreative.removeEventListener("timeout"),this.vpaidCreative=null)},resize:function(){a.log("VPAIDAdRenderer resize()");var e=this.rendererController.getAdInstance().getSlot(),t=e.getWidth(),e=e.getHeight();a.log("VPAIDRenderer new size width:"+t+" height:"+e),this.vpaidCreative.resizeAd(t,e,this.vpaidViewmode)}}),a},u.tv.freewheel.SDK||(u.tv.freewheel.SDK=u.tv.freewheel[Q]("tv.freewheel.SDK")),u}();